<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>使用 docker-compose 搭建 clickhouse 集群 | johnpoint's blog</title>
<meta name=keywords content="clickhouse,笔记,docker,docker-compose"><meta name=description content="Docker Compose 配置
version: '3'
services:
  clickhouse-server-ck1:
    restart: on-failure:10 # 退出非0重启，尝试10次
    image: yandex/clickhouse-server
    container_name: ck1
    networks:
      - ck-network
    ports:
      - &#34;8124:8123&#34;
      - &#34;9001:9000&#34;
      - &#34;9010:9004&#34;
    volumes:
      - `pwd`/clickhouse/:/var/lib/clickhouse/
      - `pwd`/clickhouse-server/:/etc/clickhouse-server/
      - `pwd`/log/clickhouse-server/:/var/log/clickhouse-server/
    ulimits:
      nofile:
        soft: &#34;262144&#34;
        hard: &#34;262144&#34;
    depends_on:
      - zookeeper-1

  clickhouse-server-ck2:
    restart: on-failure:10 # 退出非0重启，尝试10次
    image: yandex/clickhouse-server
    container_name: ck2
    networks:
      - ck-network
    ports:
      - &#34;8125:8123&#34;
      - &#34;9002:9000&#34;
      - &#34;9011:9004&#34;
    volumes:
      - `pwd`/clickhouse2/:/var/lib/clickhouse/
      - `pwd`/clickhouse-server2/:/etc/clickhouse-server/
      - `pwd`/log/clickhouse-server2/:/var/log/clickhouse-server/
    ulimits:
      nofile:
        soft: &#34;262144&#34;
        hard: &#34;262144&#34;
    depends_on:
      - zookeeper-1

  clickhouse-server-ck3:
    restart: on-failure:10 # 退出非0重启，尝试10次
    image: yandex/clickhouse-server
    container_name: ck3
    networks:
      - ck-network
    ports:
      - &#34;8126:8123&#34;
      - &#34;9003:9000&#34;
      - &#34;9012:9004&#34;
    volumes:
      - `pwd`/clickhouse3/:/var/lib/clickhouse/
      - `pwd`/clickhouse-server3/:/etc/clickhouse-server/
      - `pwd`/log/clickhouse-server3/:/var/log/clickhouse-server/
    ulimits:
      nofile:
        soft: &#34;262144&#34;
        hard: &#34;262144&#34;
    depends_on:
      - zookeeper-1

  zookeeper-1:
    restart: on-failure:10 # 退出非0重启，尝试10次
    image: zookeeper:3.8.0
    container_name: zookeeper1
    networks:
      - ck-network
    ports:
      - &#34;2181:2181&#34;
    volumes:
      - `pwd`/zookeeper/conf/:/apache-zookeeper-3.8.0-bin/conf/
      - `pwd`/zookeeper/data/:/data
      - `pwd`/zookeeper/datalog/:/datalog
      - `pwd`/zookeeper/logs/:/logs
    ulimits:
      nofile:
        soft: &#34;262144&#34;
        hard: &#34;262144&#34;

networks:
  ck-network:
Clickhouse 配置文件
<?xml version=&#34;1.0&#34;?>
<!--
  NOTE: User and query level settings are set up in &#34;users.xml&#34; file.
  If you have accidentally specified user-level settings here, server won't start.
  You can either move the settings to the right place inside &#34;users.xml&#34; file
   or add <skip_check_for_incorrect_settings>1</skip_check_for_incorrect_settings> here.
-->
<clickhouse>
    <logger>
        <!-- Possible levels [1]:

          - none (turns off logging)
          - fatal
          - critical
          - error
          - warning
          - notice
          - information
          - debug
          - trace
          - test (not for production usage)

            [1]: https://github.com/pocoproject/poco/blob/poco-1.9.4-release/Foundation/include/Poco/Logger.h#L105-L114
        -->
        <level>trace</level>
        <log>/var/log/clickhouse-server/clickhouse-server.log</log>
        <errorlog>/var/log/clickhouse-server/clickhouse-server.err.log</errorlog>
        <!-- Rotation policy
             See https://github.com/pocoproject/poco/blob/poco-1.9.4-release/Foundation/include/Poco/FileChannel.h#L54-L85
          -->
        <size>1000M</size>
        <count>10</count>
        <!-- <console>1</console> --> <!-- Default behavior is autodetection (log to console if not daemon mode and is tty) -->

        <!-- Per level overrides (legacy):

        For example to suppress logging of the ConfigReloader you can use:
        NOTE: levels.logger is reserved, see below.
        -->
        <!--
        <levels>
          <ConfigReloader>none</ConfigReloader>
        </levels>
        -->

        <!-- Per level overrides:

        For example to suppress logging of the RBAC for default user you can use:
        (But please note that the logger name maybe changed from version to version, even after minor upgrade)
        -->
        <!--
        <levels>
          <logger>
            <name>ContextAccess (default)</name>
            <level>none</level>
          </logger>
          <logger>
            <name>DatabaseOrdinary (test)</name>
            <level>none</level>
          </logger>
        </levels>
        -->
    </logger>

    <!-- Add headers to response in options request. OPTIONS method is used in CORS preflight requests. -->
    <!-- It is off by default. Next headers are obligate for CORS.-->
    <!-- http_options_response>
        <header>
            <name>Access-Control-Allow-Origin</name>
            <value>*</value>
        </header>
        <header>
            <name>Access-Control-Allow-Headers</name>
            <value>origin, x-requested-with</value>
        </header>
        <header>
            <name>Access-Control-Allow-Methods</name>
            <value>POST, GET, OPTIONS</value>
        </header>
        <header>
            <name>Access-Control-Max-Age</name>
            <value>86400</value>
        </header>
    </http_options_response -->

    <!-- It is the name that will be shown in the clickhouse-client.
         By default, anything with &#34;production&#34; will be highlighted in red in query prompt.
    -->
    <!--display_name>production</display_name-->

    <!-- Port for HTTP API. See also 'https_port' for secure connections.
         This interface is also used by ODBC and JDBC drivers (DataGrip, Dbeaver, ...)
         and by most of web interfaces (embedded UI, Grafana, Redash, ...).
      -->
    <http_port>8123</http_port>

    <!-- Port for interaction by native protocol with:
         - clickhouse-client and other native ClickHouse tools (clickhouse-benchmark, clickhouse-copier);
         - clickhouse-server with other clickhouse-servers for distributed query processing;
         - ClickHouse drivers and applications supporting native protocol
         (this protocol is also informally called as &#34;the TCP protocol&#34;);
         See also 'tcp_port_secure' for secure connections.
    -->
    <tcp_port>9000</tcp_port>

    <!-- Compatibility with MySQL protocol.
         ClickHouse will pretend to be MySQL for applications connecting to this port.
    -->
    <mysql_port>9004</mysql_port>

    <!-- Compatibility with PostgreSQL protocol.
         ClickHouse will pretend to be PostgreSQL for applications connecting to this port.
    -->
    <postgresql_port>9005</postgresql_port>

    <!-- HTTP API with TLS (HTTPS).
         You have to configure certificate to enable this interface.
         See the openSSL section below.
    -->
    <!-- <https_port>8443</https_port> -->

    <!-- Native interface with TLS.
         You have to configure certificate to enable this interface.
         See the openSSL section below.
    -->
    <!-- <tcp_port_secure>9440</tcp_port_secure> -->

    <!-- Native interface wrapped with PROXYv1 protocol
         PROXYv1 header sent for every connection.
         ClickHouse will extract information about proxy-forwarded client address from the header.
    -->
    <!-- <tcp_with_proxy_port>9011</tcp_with_proxy_port> -->

    <!-- Port for communication between replicas. Used for data exchange.
         It provides low-level data access between servers.
         This port should not be accessible from untrusted networks.
         See also 'interserver_http_credentials'.
         Data transferred over connections to this port should not go through untrusted networks.
         See also 'interserver_https_port'.
      -->
    <interserver_http_port>9009</interserver_http_port>

    <!-- Port for communication between replicas with TLS.
         You have to configure certificate to enable this interface.
         See the openSSL section below.
         See also 'interserver_http_credentials'.
      -->
    <!-- <interserver_https_port>9010</interserver_https_port> -->

    <!-- Hostname that is used by other replicas to request this server.
         If not specified, than it is determined analogous to 'hostname -f' command.
         This setting could be used to switch replication to another network interface
         (the server may be connected to multiple networks via multiple addresses)
      -->

    <interserver_http_host>0.0.0.0</interserver_http_host>

    <!-- You can specify credentials for authenthication between replicas.
         This is required when interserver_https_port is accessible from untrusted networks,
         and also recommended to avoid SSRF attacks from possibly compromised services in your network.
      -->
    <!--<interserver_http_credentials>
        <user>interserver</user>
        <password></password>
    </interserver_http_credentials>-->

    <!-- Listen specified address.
         Use :: (wildcard IPv6 address), if you want to accept connections both with IPv4 and IPv6 from everywhere.
         Notes:
         If you open connections from wildcard address, make sure that at least one of the following measures applied:
         - server is protected by firewall and not accessible from untrusted networks;
         - all users are restricted to subset of network addresses (see users.xml);
         - all users have strong passwords, only secure (TLS) interfaces are accessible, or connections are only made via TLS interfaces.
         - users without password have readonly access.
         See also: https://www.shodan.io/search?query=clickhouse
      -->
    <!-- <listen_host>::</listen_host> -->


    <!-- Same for hosts without support for IPv6: -->
    <listen_host>0.0.0.0</listen_host>

    <!-- Default values - try listen localhost on IPv4 and IPv6. -->
    <!--
    <listen_host>::1</listen_host>
    <listen_host>127.0.0.1</listen_host>
    -->

    <!-- Don't exit if IPv6 or IPv4 networks are unavailable while trying to listen. -->
    <!-- <listen_try>0</listen_try> -->

    <!-- Allow multiple servers to listen on the same address:port. This is not recommended.
      -->
    <!-- <listen_reuse_port>0</listen_reuse_port> -->

    <!-- <listen_backlog>4096</listen_backlog> -->

    <max_connections>4096</max_connections>

    <!-- For 'Connection: keep-alive' in HTTP 1.1 -->
    <keep_alive_timeout>3</keep_alive_timeout>

    <!-- gRPC protocol (see src/Server/grpc_protos/clickhouse_grpc.proto for the API) -->
    <!-- <grpc_port>9100</grpc_port> -->
    <grpc>
        <enable_ssl>false</enable_ssl>

        <!-- The following two files are used only if enable_ssl=1 -->
        <ssl_cert_file>/path/to/ssl_cert_file</ssl_cert_file>
        <ssl_key_file>/path/to/ssl_key_file</ssl_key_file>

        <!-- Whether server will request client for a certificate -->
        <ssl_require_client_auth>false</ssl_require_client_auth>

        <!-- The following file is used only if ssl_require_client_auth=1 -->
        <ssl_ca_cert_file>/path/to/ssl_ca_cert_file</ssl_ca_cert_file>

        <!-- Default compression algorithm (applied if client doesn't specify another algorithm, see result_compression in QueryInfo).
             Supported algorithms: none, deflate, gzip, stream_gzip -->
        <compression>deflate</compression>

        <!-- Default compression level (applied if client doesn't specify another level, see result_compression in QueryInfo).
             Supported levels: none, low, medium, high -->
        <compression_level>medium</compression_level>

        <!-- Send/receive message size limits in bytes. -1 means unlimited -->
        <max_send_message_size>-1</max_send_message_size>
        <max_receive_message_size>-1</max_receive_message_size>

        <!-- Enable if you want very detailed logs -->
        <verbose_logs>false</verbose_logs>
    </grpc>

    <!-- Used with https_port and tcp_port_secure. Full ssl options list: https://github.com/ClickHouse-Extras/poco/blob/master/NetSSL_OpenSSL/include/Poco/Net/SSLManager.h#L71 -->
    <openSSL>
        <server> <!-- Used for https server AND secure tcp port -->
            <!-- openssl req -subj &#34;/CN=localhost&#34; -new -newkey rsa:2048 -days 365 -nodes -x509 -keyout /etc/clickhouse-server/server.key -out /etc/clickhouse-server/server.crt -->
            <certificateFile>/etc/clickhouse-server/server.crt</certificateFile>
            <privateKeyFile>/etc/clickhouse-server/server.key</privateKeyFile>
            <!-- dhparams are optional. You can delete the <dhParamsFile> element.
                 To generate dhparams, use the following command:
                  openssl dhparam -out /etc/clickhouse-server/dhparam.pem 4096
                 Only file format with BEGIN DH PARAMETERS is supported.
              -->
            <dhParamsFile>/etc/clickhouse-server/dhparam.pem</dhParamsFile>
            <verificationMode>none</verificationMode>
            <loadDefaultCAFile>true</loadDefaultCAFile>
            <cacheSessions>true</cacheSessions>
            <disableProtocols>sslv2,sslv3</disableProtocols>
            <preferServerCiphers>true</preferServerCiphers>
        </server>

        <client> <!-- Used for connecting to https dictionary source and secured Zookeeper communication -->
            <loadDefaultCAFile>true</loadDefaultCAFile>
            <cacheSessions>true</cacheSessions>
            <disableProtocols>sslv2,sslv3</disableProtocols>
            <preferServerCiphers>true</preferServerCiphers>
            <!-- Use for self-signed: <verificationMode>none</verificationMode> -->
            <invalidCertificateHandler>
                <!-- Use for self-signed: <name>AcceptCertificateHandler</name> -->
                <name>RejectCertificateHandler</name>
            </invalidCertificateHandler>
        </client>
    </openSSL>

    <!-- Default root page on http[s] server. For example load UI from https://tabix.io/ when opening http://localhost:8123 -->
    <!--
    <http_server_default_response><![CDATA[<html ng-app=&#34;SMI2&#34;><head><base href=&#34;http://ui.tabix.io/&#34;></head><body><div ui-view=&#34;&#34; class=&#34;content-ui&#34;></div><script src=&#34;http://loader.tabix.io/master.js&#34;></script></body></html>]]></http_server_default_response>
    -->

    <!-- Maximum number of concurrent queries. -->
    <max_concurrent_queries>100</max_concurrent_queries>

    <!-- Maximum memory usage (resident set size) for server process.
         Zero value or unset means default. Default is &#34;max_server_memory_usage_to_ram_ratio&#34; of available physical RAM.
         If the value is larger than &#34;max_server_memory_usage_to_ram_ratio&#34; of available physical RAM, it will be cut down.

         The constraint is checked on query execution time.
         If a query tries to allocate memory and the current memory usage plus allocation is greater
          than specified threshold, exception will be thrown.

         It is not practical to set this constraint to small values like just a few gigabytes,
          because memory allocator will keep this amount of memory in caches and the server will deny service of queries.
      -->
    <max_server_memory_usage>0</max_server_memory_usage>

    <!-- Maximum number of threads in the Global thread pool.
    This will default to a maximum of 10000 threads if not specified.
    This setting will be useful in scenarios where there are a large number
    of distributed queries that are running concurrently but are idling most
    of the time, in which case a higher number of threads might be required.
    -->

    <max_thread_pool_size>10000</max_thread_pool_size>

    <!-- Number of workers to recycle connections in background (see also drain_timeout).
         If the pool is full, connection will be drained synchronously. -->
    <!-- <max_threads_for_connection_collector>10</max_threads_for_connection_collector> -->

    <!-- On memory constrained environments you may have to set this to value larger than 1.
      -->
    <max_server_memory_usage_to_ram_ratio>0.9</max_server_memory_usage_to_ram_ratio>

    <!-- Simple server-wide memory profiler. Collect a stack trace at every peak allocation step (in bytes).
         Data will be stored in system.trace_log table with query_id = empty string.
         Zero means disabled.
      -->
    <total_memory_profiler_step>4194304</total_memory_profiler_step>

    <!-- Collect random allocations and deallocations and write them into system.trace_log with 'MemorySample' trace_type.
         The probability is for every alloc/free regardless to the size of the allocation.
         Note that sampling happens only when the amount of untracked memory exceeds the untracked memory limit,
          which is 4 MiB by default but can be lowered if 'total_memory_profiler_step' is lowered.
         You may want to set 'total_memory_profiler_step' to 1 for extra fine grained sampling.
      -->
    <total_memory_tracker_sample_probability>0</total_memory_tracker_sample_probability>

    <!-- Set limit on number of open files (default: maximum). This setting makes sense on Mac OS X because getrlimit() fails to retrieve
         correct maximum value. -->
    <!-- <max_open_files>262144</max_open_files> -->

    <!-- Size of cache of uncompressed blocks of data, used in tables of MergeTree family.
         In bytes. Cache is single for server. Memory is allocated only on demand.
         Cache is used when 'use_uncompressed_cache' user setting turned on (off by default).
         Uncompressed cache is advantageous only for very short queries and in rare cases.

         Note: uncompressed cache can be pointless for lz4, because memory bandwidth
         is slower than multi-core decompression on some server configurations.
         Enabling it can sometimes paradoxically make queries slower.
      -->
    <uncompressed_cache_size>8589934592</uncompressed_cache_size>

    <!-- Approximate size of mark cache, used in tables of MergeTree family.
         In bytes. Cache is single for server. Memory is allocated only on demand.
         You should not lower this value.
      -->
    <mark_cache_size>5368709120</mark_cache_size>


    <!-- If you enable the `min_bytes_to_use_mmap_io` setting,
         the data in MergeTree tables can be read with mmap to avoid copying from kernel to userspace.
         It makes sense only for large files and helps only if data reside in page cache.
         To avoid frequent open/mmap/munmap/close calls (which are very expensive due to consequent page faults)
         and to reuse mappings from several threads and queries,
         the cache of mapped files is maintained. Its size is the number of mapped regions (usually equal to the number of mapped files).
         The amount of data in mapped files can be monitored
         in system.metrics, system.metric_log by the MMappedFiles, MMappedFileBytes metrics
         and in system.asynchronous_metrics, system.asynchronous_metrics_log by the MMapCacheCells metric,
         and also in system.events, system.processes, system.query_log, system.query_thread_log, system.query_views_log by the
         CreatedReadBufferMMap, CreatedReadBufferMMapFailed, MMappedFileCacheHits, MMappedFileCacheMisses events.
         Note that the amount of data in mapped files does not consume memory directly and is not accounted
         in query or server memory usage - because this memory can be discarded similar to OS page cache.
         The cache is dropped (the files are closed) automatically on removal of old parts in MergeTree,
         also it can be dropped manually by the SYSTEM DROP MMAP CACHE query.
      -->
    <mmap_cache_size>1000</mmap_cache_size>

    <!-- Cache size in bytes for compiled expressions.-->
    <compiled_expression_cache_size>134217728</compiled_expression_cache_size>

    <!-- Cache size in elements for compiled expressions.-->
    <compiled_expression_cache_elements_size>10000</compiled_expression_cache_elements_size>

    <!-- Path to data directory, with trailing slash. -->
    <path>/var/lib/clickhouse/</path>

    <!-- Path to temporary data for processing hard queries. -->
    <tmp_path>/var/lib/clickhouse/tmp/</tmp_path>

    <!-- Policy from the <storage_configuration> for the temporary files.
         If not set <tmp_path> is used, otherwise <tmp_path> is ignored.

         Notes:
         - move_factor              is ignored
         - keep_free_space_bytes    is ignored
         - max_data_part_size_bytes is ignored
         - you must have exactly one volume in that policy
    -->
    <!-- <tmp_policy>tmp</tmp_policy> -->

    <!-- Directory with user provided files that are accessible by 'file' table function. -->
    <user_files_path>/var/lib/clickhouse/user_files/</user_files_path>

    <!-- LDAP server definitions. -->
    <ldap_servers>
        <!-- List LDAP servers with their connection parameters here to later 1) use them as authenticators for dedicated local users,
              who have 'ldap' authentication mechanism specified instead of 'password', or to 2) use them as remote user directories.
             Parameters:
                host - LDAP server hostname or IP, this parameter is mandatory and cannot be empty.
                port - LDAP server port, default is 636 if enable_tls is set to true, 389 otherwise.
                bind_dn - template used to construct the DN to bind to.
                        The resulting DN will be constructed by replacing all '{user_name}' substrings of the template with the actual
                         user name during each authentication attempt.
                user_dn_detection - section with LDAP search parameters for detecting the actual user DN of the bound user.
                        This is mainly used in search filters for further role mapping when the server is Active Directory. The
                         resulting user DN will be used when replacing '{user_dn}' substrings wherever they are allowed. By default,
                         user DN is set equal to bind DN, but once search is performed, it will be updated with to the actual detected
                         user DN value.
                    base_dn - template used to construct the base DN for the LDAP search.
                            The resulting DN will be constructed by replacing all '{user_name}' and '{bind_dn}' substrings
                             of the template with the actual user name and bind DN during the LDAP search.
                    scope - scope of the LDAP search.
                            Accepted values are: 'base', 'one_level', 'children', 'subtree' (the default).
                    search_filter - template used to construct the search filter for the LDAP search.
                            The resulting filter will be constructed by replacing all '{user_name}', '{bind_dn}', and '{base_dn}'
                             substrings of the template with the actual user name, bind DN, and base DN during the LDAP search.
                            Note, that the special characters must be escaped properly in XML.
                verification_cooldown - a period of time, in seconds, after a successful bind attempt, during which a user will be assumed
                         to be successfully authenticated for all consecutive requests without contacting the LDAP server.
                        Specify 0 (the default) to disable caching and force contacting the LDAP server for each authentication request.
                enable_tls - flag to trigger use of secure connection to the LDAP server.
                        Specify 'no' for plain text (ldap://) protocol (not recommended).
                        Specify 'yes' for LDAP over SSL/TLS (ldaps://) protocol (recommended, the default).
                        Specify 'starttls' for legacy StartTLS protocol (plain text (ldap://) protocol, upgraded to TLS).
                tls_minimum_protocol_version - the minimum protocol version of SSL/TLS.
                        Accepted values are: 'ssl2', 'ssl3', 'tls1.0', 'tls1.1', 'tls1.2' (the default).
                tls_require_cert - SSL/TLS peer certificate verification behavior.
                        Accepted values are: 'never', 'allow', 'try', 'demand' (the default).
                tls_cert_file - path to certificate file.
                tls_key_file - path to certificate key file.
                tls_ca_cert_file - path to CA certificate file.
                tls_ca_cert_dir - path to the directory containing CA certificates.
                tls_cipher_suite - allowed cipher suite (in OpenSSL notation).
             Example:
                <my_ldap_server>
                    <host>localhost</host>
                    <port>636</port>
                    <bind_dn>uid={user_name},ou=users,dc=example,dc=com</bind_dn>
                    <verification_cooldown>300</verification_cooldown>
                    <enable_tls>yes</enable_tls>
                    <tls_minimum_protocol_version>tls1.2</tls_minimum_protocol_version>
                    <tls_require_cert>demand</tls_require_cert>
                    <tls_cert_file>/path/to/tls_cert_file</tls_cert_file>
                    <tls_key_file>/path/to/tls_key_file</tls_key_file>
                    <tls_ca_cert_file>/path/to/tls_ca_cert_file</tls_ca_cert_file>
                    <tls_ca_cert_dir>/path/to/tls_ca_cert_dir</tls_ca_cert_dir>
                    <tls_cipher_suite>ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:AES256-GCM-SHA384</tls_cipher_suite>
                </my_ldap_server>
             Example (typical Active Directory with configured user DN detection for further role mapping):
                <my_ad_server>
                    <host>localhost</host>
                    <port>389</port>
                    <bind_dn>EXAMPLE\{user_name}</bind_dn>
                    <user_dn_detection>
                        <base_dn>CN=Users,DC=example,DC=com</base_dn>
                        <search_filter>(&amp;amp;(objectClass=user)(sAMAccountName={user_name}))</search_filter>
                    </user_dn_detection>
                    <enable_tls>no</enable_tls>
                </my_ad_server>
        -->
    </ldap_servers>

    <!-- To enable Kerberos authentication support for HTTP requests (GSS-SPNEGO), for those users who are explicitly configured
          to authenticate via Kerberos, define a single 'kerberos' section here.
         Parameters:
            principal - canonical service principal name, that will be acquired and used when accepting security contexts.
                    This parameter is optional, if omitted, the default principal will be used.
                    This parameter cannot be specified together with 'realm' parameter.
            realm - a realm, that will be used to restrict authentication to only those requests whose initiator's realm matches it.
                    This parameter is optional, if omitted, no additional filtering by realm will be applied.
                    This parameter cannot be specified together with 'principal' parameter.
         Example:
            <kerberos />
         Example:
            <kerberos>
                <principal>HTTP/clickhouse.example.com@EXAMPLE.COM</principal>
            </kerberos>
         Example:
            <kerberos>
                <realm>EXAMPLE.COM</realm>
            </kerberos>
    -->

    <!-- Sources to read users, roles, access rights, profiles of settings, quotas. -->
    <user_directories>
        <users_xml>
            <!-- Path to configuration file with predefined users. -->
            <path>users.xml</path>
        </users_xml>
        <local_directory>
            <!-- Path to folder where users created by SQL commands are stored. -->
            <path>/var/lib/clickhouse/access/</path>
        </local_directory>

        <!-- To add an LDAP server as a remote user directory of users that are not defined locally, define a single 'ldap' section
              with the following parameters:
                server - one of LDAP server names defined in 'ldap_servers' config section above.
                        This parameter is mandatory and cannot be empty.
                roles - section with a list of locally defined roles that will be assigned to each user retrieved from the LDAP server.
                        If no roles are specified here or assigned during role mapping (below), user will not be able to perform any
                         actions after authentication.
                role_mapping - section with LDAP search parameters and mapping rules.
                        When a user authenticates, while still bound to LDAP, an LDAP search is performed using search_filter and the
                         name of the logged in user. For each entry found during that search, the value of the specified attribute is
                         extracted. For each attribute value that has the specified prefix, the prefix is removed, and the rest of the
                         value becomes the name of a local role defined in ClickHouse, which is expected to be created beforehand by
                         CREATE ROLE command.
                        There can be multiple 'role_mapping' sections defined inside the same 'ldap' section. All of them will be
                         applied.
                    base_dn - template used to construct the base DN for the LDAP search.
                            The resulting DN will be constructed by replacing all '{user_name}', '{bind_dn}', and '{user_dn}'
                             substrings of the template with the actual user name, bind DN, and user DN during each LDAP search.
                    scope - scope of the LDAP search.
                            Accepted values are: 'base', 'one_level', 'children', 'subtree' (the default).
                    search_filter - template used to construct the search filter for the LDAP search.
                            The resulting filter will be constructed by replacing all '{user_name}', '{bind_dn}', '{user_dn}', and
                             '{base_dn}' substrings of the template with the actual user name, bind DN, user DN, and base DN during
                             each LDAP search.
                            Note, that the special characters must be escaped properly in XML.
                    attribute - attribute name whose values will be returned by the LDAP search. 'cn', by default.
                    prefix - prefix, that will be expected to be in front of each string in the original list of strings returned by
                             the LDAP search. Prefix will be removed from the original strings and resulting strings will be treated
                             as local role names. Empty, by default.
             Example:
                <ldap>
                    <server>my_ldap_server</server>
                    <roles>
                        <my_local_role1 />
                        <my_local_role2 />
                    </roles>
                    <role_mapping>
                        <base_dn>ou=groups,dc=example,dc=com</base_dn>
                        <scope>subtree</scope>
                        <search_filter>(&amp;amp;(objectClass=groupOfNames)(member={bind_dn}))</search_filter>
                        <attribute>cn</attribute>
                        <prefix>clickhouse_</prefix>
                    </role_mapping>
                </ldap>
             Example (typical Active Directory with role mapping that relies on the detected user DN):
                <ldap>
                    <server>my_ad_server</server>
                    <role_mapping>
                        <base_dn>CN=Users,DC=example,DC=com</base_dn>
                        <attribute>CN</attribute>
                        <scope>subtree</scope>
                        <search_filter>(&amp;amp;(objectClass=group)(member={user_dn}))</search_filter>
                        <prefix>clickhouse_</prefix>
                    </role_mapping>
                </ldap>
        -->
    </user_directories>

    <!-- Default profile of settings. -->
    <default_profile>default</default_profile>

    <!-- Comma-separated list of prefixes for user-defined settings. -->
    <custom_settings_prefixes></custom_settings_prefixes>

    <!-- System profile of settings. This settings are used by internal processes (Distributed DDL worker and so on). -->
    <!-- <system_profile>default</system_profile> -->

    <!-- Buffer profile of settings.
         This settings are used by Buffer storage to flush data to the underlying table.
         Default: used from system_profile directive.
    -->
    <!-- <buffer_profile>default</buffer_profile> -->

    <!-- Default database. -->
    <default_database>default</default_database>

    <!-- Server time zone could be set here.

         Time zone is used when converting between String and DateTime types,
          when printing DateTime in text formats and parsing DateTime from text,
          it is used in date and time related functions, if specific time zone was not passed as an argument.

         Time zone is specified as identifier from IANA time zone database, like UTC or Africa/Abidjan.
         If not specified, system time zone at server startup is used.

         Please note, that server could display time zone alias instead of specified name.
         Example: W-SU is an alias for Europe/Moscow and Zulu is an alias for UTC.
    -->
    <!-- <timezone>Europe/Moscow</timezone> -->

    <!-- You can specify umask here (see &#34;man umask&#34;). Server will apply it on startup.
         Number is always parsed as octal. Default umask is 027 (other users cannot read logs, data files, etc; group can only read).
    -->
    <!-- <umask>022</umask> -->

    <!-- Perform mlockall after startup to lower first queries latency
          and to prevent clickhouse executable from being paged out under high IO load.
         Enabling this option is recommended but will lead to increased startup time for up to a few seconds.
    -->
    <mlock_executable>true</mlock_executable>

    <!-- Reallocate memory for machine code (&#34;text&#34;) using huge pages. Highly experimental. -->
    <remap_executable>false</remap_executable>

    <![CDATA[
         Uncomment below in order to use JDBC table engine and function.

         To install and run JDBC bridge in background:
         * [Debian/Ubuntu]
           export MVN_URL=https://repo1.maven.org/maven2/ru/yandex/clickhouse/clickhouse-jdbc-bridge
           export PKG_VER=$(curl -sL $MVN_URL/maven-metadata.xml | grep '<release>' | sed -e 's|.*>\(.*\)<.*|\1|')
           wget https://github.com/ClickHouse/clickhouse-jdbc-bridge/releases/download/v$PKG_VER/clickhouse-jdbc-bridge_$PKG_VER-1_all.deb
           apt install --no-install-recommends -f ./clickhouse-jdbc-bridge_$PKG_VER-1_all.deb
           clickhouse-jdbc-bridge &

         * [CentOS/RHEL]
           export MVN_URL=https://repo1.maven.org/maven2/ru/yandex/clickhouse/clickhouse-jdbc-bridge
           export PKG_VER=$(curl -sL $MVN_URL/maven-metadata.xml | grep '<release>' | sed -e 's|.*>\(.*\)<.*|\1|')
           wget https://github.com/ClickHouse/clickhouse-jdbc-bridge/releases/download/v$PKG_VER/clickhouse-jdbc-bridge-$PKG_VER-1.noarch.rpm
           yum localinstall -y clickhouse-jdbc-bridge-$PKG_VER-1.noarch.rpm
           clickhouse-jdbc-bridge &

         Please refer to https://github.com/ClickHouse/clickhouse-jdbc-bridge#usage for more information.
    ]]>
    <!--
    <jdbc_bridge>
        <host>127.0.0.1</host>
        <port>9019</port>
    </jdbc_bridge>
    -->

    <!-- Configuration of clusters that could be used in Distributed tables.
         https://clickhouse.com/docs/en/operations/table_engines/distributed/
      -->
    <remote_servers>
        <default_cluster>
            <shard>
                <weight>1</weight>
                <internal_replication>false</internal_replication>
                <replica>
                    <host>ck1</host>
                    <port>9000</port>
                </replica>
            </shard>
            <shard>
                <weight>1</weight>
                <internal_replication>false</internal_replication>
                <replica>
                    <host>ck2</host>
                    <port>9000</port>
                </replica>
            </shard>
            <shard>
                <weight>1</weight>
                <internal_replication>false</internal_replication>
                <replica>
                    <host>ck3</host>
                    <port>9000</port>
                </replica>
            </shard>
        </default_cluster>
    </remote_servers>

    <macros>
        <replica>ck1</replica>
        <shard>01</shard>
        <layer>01</layer>
    </macros>


    <!-- The list of hosts allowed to use in URL-related storage engines and table functions.
        If this section is not present in configuration, all hosts are allowed.
    -->
    <!--<remote_url_allow_hosts>-->
    <!-- Host should be specified exactly as in URL. The name is checked before DNS resolution.
        Example: &#34;yandex.ru&#34;, &#34;yandex.ru.&#34; and &#34;www.yandex.ru&#34; are different hosts.
                If port is explicitly specified in URL, the host:port is checked as a whole.
                If host specified here without port, any port with this host allowed.
                &#34;yandex.ru&#34; -> &#34;yandex.ru:443&#34;, &#34;yandex.ru:80&#34; etc. is allowed, but &#34;yandex.ru:80&#34; -> only &#34;yandex.ru:80&#34; is allowed.
        If the host is specified as IP address, it is checked as specified in URL. Example: &#34;[2a02:6b8:a::a]&#34;.
        If there are redirects and support for redirects is enabled, every redirect (the Location field) is checked.
        Host should be specified using the host xml tag:
                <host>yandex.ru</host>
    -->

    <!-- Regular expression can be specified. RE2 engine is used for regexps.
        Regexps are not aligned: don't forget to add ^ and $. Also don't forget to escape dot (.) metacharacter
        (forgetting to do so is a common source of error).
    -->
    <!--</remote_url_allow_hosts>-->

    <!-- If element has 'incl' attribute, then for it's value will be used corresponding substitution from another file.
         By default, path to file with substitutions is /etc/metrika.xml. It could be changed in config in 'include_from' element.
         Values for substitutions are specified in /clickhouse/name_of_substitution elements in that file.
      -->

    <!-- ZooKeeper is used to store metadata about replicas, when using Replicated tables.
         Optional. If you don't use replicated tables, you could omit that.

         See https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replication/
      -->

    <zookeeper>
        <node>
            <host>zookeeper1</host>
            <port>2181</port>
        </node>
    </zookeeper>

    <!-- Substitutions for parameters of replicated tables.
          Optional. If you don't use replicated tables, you could omit that.

         See https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replication/#creating-replicated-tables
      -->
    <!--
    <macros>
        <shard>01</shard>
        <replica>example01-01-1</replica>
    </macros>
    -->


    <!-- Reloading interval for embedded dictionaries, in seconds. Default: 3600. -->
    <builtin_dictionaries_reload_interval>3600</builtin_dictionaries_reload_interval>


    <!-- Maximum session timeout, in seconds. Default: 3600. -->
    <max_session_timeout>3600</max_session_timeout>

    <!-- Default session timeout, in seconds. Default: 60. -->
    <default_session_timeout>60</default_session_timeout>

    <!-- Sending data to Graphite for monitoring. Several sections can be defined. -->
    <!--
        interval - send every X second
        root_path - prefix for keys
        hostname_in_path - append hostname to root_path (default = true)
        metrics - send data from table system.metrics
        events - send data from table system.events
        asynchronous_metrics - send data from table system.asynchronous_metrics
    -->
    <!--
    <graphite>
        <host>localhost</host>
        <port>42000</port>
        <timeout>0.1</timeout>
        <interval>60</interval>
        <root_path>one_min</root_path>
        <hostname_in_path>true</hostname_in_path>

        <metrics>true</metrics>
        <events>true</events>
        <events_cumulative>false</events_cumulative>
        <asynchronous_metrics>true</asynchronous_metrics>
    </graphite>
    <graphite>
        <host>localhost</host>
        <port>42000</port>
        <timeout>0.1</timeout>
        <interval>1</interval>
        <root_path>one_sec</root_path>

        <metrics>true</metrics>
        <events>true</events>
        <events_cumulative>false</events_cumulative>
        <asynchronous_metrics>false</asynchronous_metrics>
    </graphite>
    -->

    <!-- Serve endpoint for Prometheus monitoring. -->
    <!--
        endpoint - mertics path (relative to root, statring with &#34;/&#34;)
        port - port to setup server. If not defined or 0 than http_port used
        metrics - send data from table system.metrics
        events - send data from table system.events
        asynchronous_metrics - send data from table system.asynchronous_metrics
        status_info - send data from different component from CH, ex: Dictionaries status
    -->
    <!--
    <prometheus>
        <endpoint>/metrics</endpoint>
        <port>9363</port>

        <metrics>true</metrics>
        <events>true</events>
        <asynchronous_metrics>true</asynchronous_metrics>
        <status_info>true</status_info>
    </prometheus>
    -->

    <!-- Query log. Used only for queries with setting log_queries = 1. -->
    <query_log>
        <!-- What table to insert data. If table is not exist, it will be created.
             When query log structure is changed after system update,
              then old table will be renamed and new table will be created automatically.
        -->
        <database>system</database>
        <table>query_log</table>
        <!--
            PARTITION BY expr: https://clickhouse.com/docs/en/table_engines/mergetree-family/custom_partitioning_key/
            Example:
                event_date
                toMonday(event_date)
                toYYYYMM(event_date)
                toStartOfHour(event_time)
        -->
        <partition_by>toYYYYMM(event_date)</partition_by>
        <!--
            Table TTL specification: https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree/#mergetree-table-ttl
            Example:
                event_date + INTERVAL 1 WEEK
                event_date + INTERVAL 7 DAY DELETE
                event_date + INTERVAL 2 WEEK TO DISK 'bbb'

        <ttl>event_date + INTERVAL 30 DAY DELETE</ttl>
        -->

        <!-- Instead of partition_by, you can provide full engine expression (starting with ENGINE = ) with parameters,
             Example: <engine>ENGINE = MergeTree PARTITION BY toYYYYMM(event_date) ORDER BY (event_date, event_time) SETTINGS index_granularity = 1024</engine>
          -->

        <!-- Interval of flushing data. -->
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </query_log>

    <!-- Trace log. Stores stack traces collected by query profilers.
         See query_profiler_real_time_period_ns and query_profiler_cpu_time_period_ns settings. -->
    <trace_log>
        <database>system</database>
        <table>trace_log</table>

        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </trace_log>

    <!-- Query thread log. Has information about all threads participated in query execution.
         Used only for queries with setting log_query_threads = 1. -->
    <query_thread_log>
        <database>system</database>
        <table>query_thread_log</table>
        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </query_thread_log>

    <!-- Query views log. Has information about all dependent views associated with a query.
         Used only for queries with setting log_query_views = 1. -->
    <query_views_log>
        <database>system</database>
        <table>query_views_log</table>
        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </query_views_log>

    <!-- Uncomment if use part log.
         Part log contains information about all actions with parts in MergeTree tables (creation, deletion, merges, downloads).-->
    <part_log>
        <database>system</database>
        <table>part_log</table>
        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </part_log>

    <!-- Uncomment to write text log into table.
         Text log contains all information from usual server log but stores it in structured and efficient way.
         The level of the messages that goes to the table can be limited (<level>), if not specified all messages will go to the table.
    <text_log>
        <database>system</database>
        <table>text_log</table>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
        <level></level>
    </text_log>
    -->

    <!-- Metric log contains rows with current values of ProfileEvents, CurrentMetrics collected with &#34;collect_interval_milliseconds&#34; interval. -->
    <metric_log>
        <database>system</database>
        <table>metric_log</table>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
        <collect_interval_milliseconds>1000</collect_interval_milliseconds>
    </metric_log>

    <!--
        Asynchronous metric log contains values of metrics from
        system.asynchronous_metrics.
    -->
    <asynchronous_metric_log>
        <database>system</database>
        <table>asynchronous_metric_log</table>
        <!--
            Asynchronous metrics are updated once a minute, so there is
            no need to flush more often.
        -->
        <flush_interval_milliseconds>7000</flush_interval_milliseconds>
    </asynchronous_metric_log>

    <!--
        OpenTelemetry log contains OpenTelemetry trace spans.
    -->
    <opentelemetry_span_log>
        <!--
            The default table creation code is insufficient, this <engine> spec
            is a workaround. There is no 'event_time' for this log, but two times,
            start and finish. It is sorted by finish time, to avoid inserting
            data too far away in the past (probably we can sometimes insert a span
            that is seconds earlier than the last span in the table, due to a race
            between several spans inserted in parallel). This gives the spans a
            global order that we can use to e.g. retry insertion into some external
            system.
        -->
        <engine>
            engine MergeTree
            partition by toYYYYMM(finish_date)
            order by (finish_date, finish_time_us, trace_id)
        </engine>
        <database>system</database>
        <table>opentelemetry_span_log</table>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </opentelemetry_span_log>


    <!-- Crash log. Stores stack traces for fatal errors.
         This table is normally empty. -->
    <crash_log>
        <database>system</database>
        <table>crash_log</table>

        <partition_by/>
        <flush_interval_milliseconds>1000</flush_interval_milliseconds>
    </crash_log>

    <!-- Session log. Stores user log in (successful or not) and log out events. -->
    <session_log>
        <database>system</database>
        <table>session_log</table>

        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </session_log>

    <!-- Parameters for embedded dictionaries, used in Yandex.Metrica.
         See https://clickhouse.com/docs/en/dicts/internal_dicts/
    -->

    <!-- Path to file with region hierarchy. -->
    <!-- <path_to_regions_hierarchy_file>/opt/geo/regions_hierarchy.txt</path_to_regions_hierarchy_file> -->

    <!-- Path to directory with files containing names of regions -->
    <!-- <path_to_regions_names_files>/opt/geo/</path_to_regions_names_files> -->


    <!-- <top_level_domains_path>/var/lib/clickhouse/top_level_domains/</top_level_domains_path> -->
    <!-- Custom TLD lists.
         Format: <name>/path/to/file</name>

         Changes will not be applied w/o server restart.
         Path to the list is under top_level_domains_path (see above).
    -->
    <top_level_domains_lists>
        <!--
        <public_suffix_list>/path/to/public_suffix_list.dat</public_suffix_list>
        -->
    </top_level_domains_lists>

    <!-- Configuration of external dictionaries. See:
         https://clickhouse.com/docs/en/sql-reference/dictionaries/external-dictionaries/external-dicts
    -->
    <dictionaries_config>*_dictionary.xml</dictionaries_config>

    <!-- Configuration of user defined executable functions -->
    <user_defined_executable_functions_config>*_function.xml</user_defined_executable_functions_config>

    <!-- Uncomment if you want data to be compressed 30-100% better.
         Don't do that if you just started using ClickHouse.
      -->
    <!--
    <compression>
        <!- - Set of variants. Checked in order. Last matching case wins. If nothing matches, lz4 will be used. - ->
        <case>

            <!- - Conditions. All must be satisfied. Some conditions may be omitted. - ->
            <min_part_size>10000000000</min_part_size>        <!- - Min part size in bytes. - ->
            <min_part_size_ratio>0.01</min_part_size_ratio>   <!- - Min size of part relative to whole table size. - ->

            <!- - What compression method to use. - ->
            <method>zstd</method>
        </case>
    </compression>
    -->

    <!-- Configuration of encryption. The server executes a command to
         obtain an encryption key at startup if such a command is
         defined, or encryption codecs will be disabled otherwise. The
         command is executed through /bin/sh and is expected to write
         a Base64-encoded key to the stdout. -->
    <encryption_codecs>
        <!-- aes_128_gcm_siv -->
        <!-- Example of getting hex key from env -->
        <!-- the code should use this key and throw an exception if its length is not 16 bytes -->
        <!--key_hex from_env=&#34;...&#34;></key_hex -->

        <!-- Example of multiple hex keys. They can be imported from env or be written down in config-->
        <!-- the code should use these keys and throw an exception if their length is not 16 bytes -->
        <!-- key_hex id=&#34;0&#34;>...</key_hex -->
        <!-- key_hex id=&#34;1&#34; from_env=&#34;..&#34;></key_hex -->
        <!-- key_hex id=&#34;2&#34;>...</key_hex -->
        <!-- current_key_id>2</current_key_id -->

        <!-- Example of getting hex key from config -->
        <!-- the code should use this key and throw an exception if its length is not 16 bytes -->
        <!-- key>...</key -->

        <!-- example of adding nonce -->
        <!-- nonce>...</nonce -->

        <!-- /aes_128_gcm_siv -->
    </encryption_codecs>

    <!-- Allow to execute distributed DDL queries (CREATE, DROP, ALTER, RENAME) on cluster.
         Works only if ZooKeeper is enabled. Comment it if such functionality isn't required. -->
    <distributed_ddl>
        <!-- Path in ZooKeeper to queue with DDL queries -->
        <path>/clickhouse/task_queue/ddl</path>

        <!-- Settings from this profile will be used to execute DDL queries -->
        <!-- <profile>default</profile> -->

        <!-- Controls how much ON CLUSTER queries can be run simultaneously. -->
        <!-- <pool_size>1</pool_size> -->

        <!--
             Cleanup settings (active tasks will not be removed)
        -->

        <!-- Controls task TTL (default 1 week) -->
        <!-- <task_max_lifetime>604800</task_max_lifetime> -->

        <!-- Controls how often cleanup should be performed (in seconds) -->
        <!-- <cleanup_delay_period>60</cleanup_delay_period> -->

        <!-- Controls how many tasks could be in the queue -->
        <!-- <max_tasks_in_queue>1000</max_tasks_in_queue> -->
    </distributed_ddl>

    <!-- Settings to fine tune MergeTree tables. See documentation in source code, in MergeTreeSettings.h -->
    <!--
    <merge_tree>
        <max_suspicious_broken_parts>5</max_suspicious_broken_parts>
    </merge_tree>
    -->

    <!-- Protection from accidental DROP.
         If size of a MergeTree table is greater than max_table_size_to_drop (in bytes) than table could not be dropped with any DROP query.
         If you want do delete one table and don't want to change clickhouse-server config, you could create special file <clickhouse-path>/flags/force_drop_table and make DROP once.
         By default max_table_size_to_drop is 50GB; max_table_size_to_drop=0 allows to DROP any tables.
         The same for max_partition_size_to_drop.
         Uncomment to disable protection.
    -->
    <!-- <max_table_size_to_drop>0</max_table_size_to_drop> -->
    <!-- <max_partition_size_to_drop>0</max_partition_size_to_drop> -->

    <!-- Example of parameters for GraphiteMergeTree table engine -->
    <graphite_rollup_example>
        <pattern>
            <regexp>click_cost</regexp>
            <function>any</function>
            <retention>
                <age>0</age>
                <precision>3600</precision>
            </retention>
            <retention>
                <age>86400</age>
                <precision>60</precision>
            </retention>
        </pattern>
        <default>
            <function>max</function>
            <retention>
                <age>0</age>
                <precision>60</precision>
            </retention>
            <retention>
                <age>3600</age>
                <precision>300</precision>
            </retention>
            <retention>
                <age>86400</age>
                <precision>3600</precision>
            </retention>
        </default>
    </graphite_rollup_example>

    <!-- Directory in <clickhouse-path> containing schema files for various input formats.
         The directory will be created if it doesn't exist.
      -->
    <format_schema_path>/var/lib/clickhouse/format_schemas/</format_schema_path>

    <!-- Default query masking rules, matching lines would be replaced with something else in the logs
        (both text logs and system.query_log).
        name - name for the rule (optional)
        regexp - RE2 compatible regular expression (mandatory)
        replace - substitution string for sensitive data (optional, by default - six asterisks)
    -->
    <query_masking_rules>
        <rule>
            <name>hide encrypt/decrypt arguments</name>
            <regexp>((?:aes_)?(?:encrypt|decrypt)(?:_mysql)?)\s*\(\s*(?:'(?:\\'|.)+'|.*?)\s*\)</regexp>
            <!-- or more secure, but also more invasive:
                (aes_\w+)\s*\(.*\)
            -->
            <replace>\1(???)</replace>
        </rule>
    </query_masking_rules>

    <!-- Uncomment to use custom http handlers.
        rules are checked from top to bottom, first match runs the handler
            url - to match request URL, you can use 'regex:' prefix to use regex match(optional)
            methods - to match request method, you can use commas to separate multiple method matches(optional)
            headers - to match request headers, match each child element(child element name is header name), you can use 'regex:' prefix to use regex match(optional)
        handler is request handler
            type - supported types: static, dynamic_query_handler, predefined_query_handler
            query - use with predefined_query_handler type, executes query when the handler is called
            query_param_name - use with dynamic_query_handler type, extracts and executes the value corresponding to the <query_param_name> value in HTTP request params
            status - use with static type, response status code
            content_type - use with static type, response content-type
            response_content - use with static type, Response content sent to client, when using the prefix 'file://' or 'config://', find the content from the file or configuration send to client.

    <http_handlers>
        <rule>
            <url>/</url>
            <methods>POST,GET</methods>
            <headers><pragma>no-cache</pragma></headers>
            <handler>
                <type>dynamic_query_handler</type>
                <query_param_name>query</query_param_name>
            </handler>
        </rule>

        <rule>
            <url>/predefined_query</url>
            <methods>POST,GET</methods>
            <handler>
                <type>predefined_query_handler</type>
                <query>SELECT * FROM system.settings</query>
            </handler>
        </rule>

        <rule>
            <handler>
                <type>static</type>
                <status>200</status>
                <content_type>text/plain; charset=UTF-8</content_type>
                <response_content>config://http_server_default_response</response_content>
            </handler>
        </rule>
    </http_handlers>
    -->

    <send_crash_reports>
        <!-- Changing <enabled> to true allows sending crash reports to -->
        <!-- the ClickHouse core developers team via Sentry https://sentry.io -->
        <!-- Doing so at least in pre-production environments is highly appreciated -->
        <enabled>false</enabled>
        <!-- Change <anonymize> to true if you don't feel comfortable attaching the server hostname to the crash report -->
        <anonymize>false</anonymize>
        <!-- Default endpoint s hould be changed to different Sentry DSN only if you have -->
        <!-- some in-house engineers or hired consultants who're going to debug ClickHouse issues for you -->
        <endpoint></endpoint>
    </send_crash_reports>

    <!-- Uncomment to disable ClickHouse internal DNS caching. -->
    <!-- <disable_internal_dns_cache>1</disable_internal_dns_cache> -->

    <!-- You can also configure rocksdb like this: -->
    <!--
    <rocksdb>
        <options>
            <max_background_jobs>8</max_background_jobs>
        </options>
        <column_family_options>
            <num_levels>2</num_levels>
        </column_family_options>
        <tables>
            <table>
                <name>TABLE</name>
                <options>
                    <max_background_jobs>8</max_background_jobs>
                </options>
                <column_family_options>
                    <num_levels>2</num_levels>
                </column_family_options>
            </table>
        </tables>
    </rocksdb>
    -->
    <timezone>Asia/Shanghai</timezone>
</clickhouse>
启动命令
docker-compose up -d
TODO
现在配置的 zookeeper 还是单机部署的，有空看看部署个zookeeper集群怎么配置"><meta name=author content="johnpoint"><link rel=canonical href=https://blog.lvcshu.com/2022/08/12/deploy-clickhouse-by-docker-compose/><link crossorigin=anonymous href=/assets/css/stylesheet.9a07b9c81cbc95fa741d61ca6489dcdb8491591c19dca31d14a124a4ba95ec80.css integrity="sha256-mge5yBy8lfp0HWHKZInc24SRWRwZ3KMdFKEkpLqV7IA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://blog.lvcshu.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.lvcshu.com/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://blog.lvcshu.com/favicon.ico><link rel=apple-touch-icon href=https://blog.lvcshu.com/favicon.ico><link rel=mask-icon href=https://blog.lvcshu.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.lvcshu.com/2022/08/12/deploy-clickhouse-by-docker-compose/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="使用 docker-compose 搭建 clickhouse 集群"><meta property="og:description" content="Docker Compose 配置
version: '3'
services:
  clickhouse-server-ck1:
    restart: on-failure:10 # 退出非0重启，尝试10次
    image: yandex/clickhouse-server
    container_name: ck1
    networks:
      - ck-network
    ports:
      - &#34;8124:8123&#34;
      - &#34;9001:9000&#34;
      - &#34;9010:9004&#34;
    volumes:
      - `pwd`/clickhouse/:/var/lib/clickhouse/
      - `pwd`/clickhouse-server/:/etc/clickhouse-server/
      - `pwd`/log/clickhouse-server/:/var/log/clickhouse-server/
    ulimits:
      nofile:
        soft: &#34;262144&#34;
        hard: &#34;262144&#34;
    depends_on:
      - zookeeper-1

  clickhouse-server-ck2:
    restart: on-failure:10 # 退出非0重启，尝试10次
    image: yandex/clickhouse-server
    container_name: ck2
    networks:
      - ck-network
    ports:
      - &#34;8125:8123&#34;
      - &#34;9002:9000&#34;
      - &#34;9011:9004&#34;
    volumes:
      - `pwd`/clickhouse2/:/var/lib/clickhouse/
      - `pwd`/clickhouse-server2/:/etc/clickhouse-server/
      - `pwd`/log/clickhouse-server2/:/var/log/clickhouse-server/
    ulimits:
      nofile:
        soft: &#34;262144&#34;
        hard: &#34;262144&#34;
    depends_on:
      - zookeeper-1

  clickhouse-server-ck3:
    restart: on-failure:10 # 退出非0重启，尝试10次
    image: yandex/clickhouse-server
    container_name: ck3
    networks:
      - ck-network
    ports:
      - &#34;8126:8123&#34;
      - &#34;9003:9000&#34;
      - &#34;9012:9004&#34;
    volumes:
      - `pwd`/clickhouse3/:/var/lib/clickhouse/
      - `pwd`/clickhouse-server3/:/etc/clickhouse-server/
      - `pwd`/log/clickhouse-server3/:/var/log/clickhouse-server/
    ulimits:
      nofile:
        soft: &#34;262144&#34;
        hard: &#34;262144&#34;
    depends_on:
      - zookeeper-1

  zookeeper-1:
    restart: on-failure:10 # 退出非0重启，尝试10次
    image: zookeeper:3.8.0
    container_name: zookeeper1
    networks:
      - ck-network
    ports:
      - &#34;2181:2181&#34;
    volumes:
      - `pwd`/zookeeper/conf/:/apache-zookeeper-3.8.0-bin/conf/
      - `pwd`/zookeeper/data/:/data
      - `pwd`/zookeeper/datalog/:/datalog
      - `pwd`/zookeeper/logs/:/logs
    ulimits:
      nofile:
        soft: &#34;262144&#34;
        hard: &#34;262144&#34;

networks:
  ck-network:
Clickhouse 配置文件
<?xml version=&#34;1.0&#34;?>
<!--
  NOTE: User and query level settings are set up in &#34;users.xml&#34; file.
  If you have accidentally specified user-level settings here, server won't start.
  You can either move the settings to the right place inside &#34;users.xml&#34; file
   or add <skip_check_for_incorrect_settings>1</skip_check_for_incorrect_settings> here.
-->
<clickhouse>
    <logger>
        <!-- Possible levels [1]:

          - none (turns off logging)
          - fatal
          - critical
          - error
          - warning
          - notice
          - information
          - debug
          - trace
          - test (not for production usage)

            [1]: https://github.com/pocoproject/poco/blob/poco-1.9.4-release/Foundation/include/Poco/Logger.h#L105-L114
        -->
        <level>trace</level>
        <log>/var/log/clickhouse-server/clickhouse-server.log</log>
        <errorlog>/var/log/clickhouse-server/clickhouse-server.err.log</errorlog>
        <!-- Rotation policy
             See https://github.com/pocoproject/poco/blob/poco-1.9.4-release/Foundation/include/Poco/FileChannel.h#L54-L85
          -->
        <size>1000M</size>
        <count>10</count>
        <!-- <console>1</console> --> <!-- Default behavior is autodetection (log to console if not daemon mode and is tty) -->

        <!-- Per level overrides (legacy):

        For example to suppress logging of the ConfigReloader you can use:
        NOTE: levels.logger is reserved, see below.
        -->
        <!--
        <levels>
          <ConfigReloader>none</ConfigReloader>
        </levels>
        -->

        <!-- Per level overrides:

        For example to suppress logging of the RBAC for default user you can use:
        (But please note that the logger name maybe changed from version to version, even after minor upgrade)
        -->
        <!--
        <levels>
          <logger>
            <name>ContextAccess (default)</name>
            <level>none</level>
          </logger>
          <logger>
            <name>DatabaseOrdinary (test)</name>
            <level>none</level>
          </logger>
        </levels>
        -->
    </logger>

    <!-- Add headers to response in options request. OPTIONS method is used in CORS preflight requests. -->
    <!-- It is off by default. Next headers are obligate for CORS.-->
    <!-- http_options_response>
        <header>
            <name>Access-Control-Allow-Origin</name>
            <value>*</value>
        </header>
        <header>
            <name>Access-Control-Allow-Headers</name>
            <value>origin, x-requested-with</value>
        </header>
        <header>
            <name>Access-Control-Allow-Methods</name>
            <value>POST, GET, OPTIONS</value>
        </header>
        <header>
            <name>Access-Control-Max-Age</name>
            <value>86400</value>
        </header>
    </http_options_response -->

    <!-- It is the name that will be shown in the clickhouse-client.
         By default, anything with &#34;production&#34; will be highlighted in red in query prompt.
    -->
    <!--display_name>production</display_name-->

    <!-- Port for HTTP API. See also 'https_port' for secure connections.
         This interface is also used by ODBC and JDBC drivers (DataGrip, Dbeaver, ...)
         and by most of web interfaces (embedded UI, Grafana, Redash, ...).
      -->
    <http_port>8123</http_port>

    <!-- Port for interaction by native protocol with:
         - clickhouse-client and other native ClickHouse tools (clickhouse-benchmark, clickhouse-copier);
         - clickhouse-server with other clickhouse-servers for distributed query processing;
         - ClickHouse drivers and applications supporting native protocol
         (this protocol is also informally called as &#34;the TCP protocol&#34;);
         See also 'tcp_port_secure' for secure connections.
    -->
    <tcp_port>9000</tcp_port>

    <!-- Compatibility with MySQL protocol.
         ClickHouse will pretend to be MySQL for applications connecting to this port.
    -->
    <mysql_port>9004</mysql_port>

    <!-- Compatibility with PostgreSQL protocol.
         ClickHouse will pretend to be PostgreSQL for applications connecting to this port.
    -->
    <postgresql_port>9005</postgresql_port>

    <!-- HTTP API with TLS (HTTPS).
         You have to configure certificate to enable this interface.
         See the openSSL section below.
    -->
    <!-- <https_port>8443</https_port> -->

    <!-- Native interface with TLS.
         You have to configure certificate to enable this interface.
         See the openSSL section below.
    -->
    <!-- <tcp_port_secure>9440</tcp_port_secure> -->

    <!-- Native interface wrapped with PROXYv1 protocol
         PROXYv1 header sent for every connection.
         ClickHouse will extract information about proxy-forwarded client address from the header.
    -->
    <!-- <tcp_with_proxy_port>9011</tcp_with_proxy_port> -->

    <!-- Port for communication between replicas. Used for data exchange.
         It provides low-level data access between servers.
         This port should not be accessible from untrusted networks.
         See also 'interserver_http_credentials'.
         Data transferred over connections to this port should not go through untrusted networks.
         See also 'interserver_https_port'.
      -->
    <interserver_http_port>9009</interserver_http_port>

    <!-- Port for communication between replicas with TLS.
         You have to configure certificate to enable this interface.
         See the openSSL section below.
         See also 'interserver_http_credentials'.
      -->
    <!-- <interserver_https_port>9010</interserver_https_port> -->

    <!-- Hostname that is used by other replicas to request this server.
         If not specified, than it is determined analogous to 'hostname -f' command.
         This setting could be used to switch replication to another network interface
         (the server may be connected to multiple networks via multiple addresses)
      -->

    <interserver_http_host>0.0.0.0</interserver_http_host>

    <!-- You can specify credentials for authenthication between replicas.
         This is required when interserver_https_port is accessible from untrusted networks,
         and also recommended to avoid SSRF attacks from possibly compromised services in your network.
      -->
    <!--<interserver_http_credentials>
        <user>interserver</user>
        <password></password>
    </interserver_http_credentials>-->

    <!-- Listen specified address.
         Use :: (wildcard IPv6 address), if you want to accept connections both with IPv4 and IPv6 from everywhere.
         Notes:
         If you open connections from wildcard address, make sure that at least one of the following measures applied:
         - server is protected by firewall and not accessible from untrusted networks;
         - all users are restricted to subset of network addresses (see users.xml);
         - all users have strong passwords, only secure (TLS) interfaces are accessible, or connections are only made via TLS interfaces.
         - users without password have readonly access.
         See also: https://www.shodan.io/search?query=clickhouse
      -->
    <!-- <listen_host>::</listen_host> -->


    <!-- Same for hosts without support for IPv6: -->
    <listen_host>0.0.0.0</listen_host>

    <!-- Default values - try listen localhost on IPv4 and IPv6. -->
    <!--
    <listen_host>::1</listen_host>
    <listen_host>127.0.0.1</listen_host>
    -->

    <!-- Don't exit if IPv6 or IPv4 networks are unavailable while trying to listen. -->
    <!-- <listen_try>0</listen_try> -->

    <!-- Allow multiple servers to listen on the same address:port. This is not recommended.
      -->
    <!-- <listen_reuse_port>0</listen_reuse_port> -->

    <!-- <listen_backlog>4096</listen_backlog> -->

    <max_connections>4096</max_connections>

    <!-- For 'Connection: keep-alive' in HTTP 1.1 -->
    <keep_alive_timeout>3</keep_alive_timeout>

    <!-- gRPC protocol (see src/Server/grpc_protos/clickhouse_grpc.proto for the API) -->
    <!-- <grpc_port>9100</grpc_port> -->
    <grpc>
        <enable_ssl>false</enable_ssl>

        <!-- The following two files are used only if enable_ssl=1 -->
        <ssl_cert_file>/path/to/ssl_cert_file</ssl_cert_file>
        <ssl_key_file>/path/to/ssl_key_file</ssl_key_file>

        <!-- Whether server will request client for a certificate -->
        <ssl_require_client_auth>false</ssl_require_client_auth>

        <!-- The following file is used only if ssl_require_client_auth=1 -->
        <ssl_ca_cert_file>/path/to/ssl_ca_cert_file</ssl_ca_cert_file>

        <!-- Default compression algorithm (applied if client doesn't specify another algorithm, see result_compression in QueryInfo).
             Supported algorithms: none, deflate, gzip, stream_gzip -->
        <compression>deflate</compression>

        <!-- Default compression level (applied if client doesn't specify another level, see result_compression in QueryInfo).
             Supported levels: none, low, medium, high -->
        <compression_level>medium</compression_level>

        <!-- Send/receive message size limits in bytes. -1 means unlimited -->
        <max_send_message_size>-1</max_send_message_size>
        <max_receive_message_size>-1</max_receive_message_size>

        <!-- Enable if you want very detailed logs -->
        <verbose_logs>false</verbose_logs>
    </grpc>

    <!-- Used with https_port and tcp_port_secure. Full ssl options list: https://github.com/ClickHouse-Extras/poco/blob/master/NetSSL_OpenSSL/include/Poco/Net/SSLManager.h#L71 -->
    <openSSL>
        <server> <!-- Used for https server AND secure tcp port -->
            <!-- openssl req -subj &#34;/CN=localhost&#34; -new -newkey rsa:2048 -days 365 -nodes -x509 -keyout /etc/clickhouse-server/server.key -out /etc/clickhouse-server/server.crt -->
            <certificateFile>/etc/clickhouse-server/server.crt</certificateFile>
            <privateKeyFile>/etc/clickhouse-server/server.key</privateKeyFile>
            <!-- dhparams are optional. You can delete the <dhParamsFile> element.
                 To generate dhparams, use the following command:
                  openssl dhparam -out /etc/clickhouse-server/dhparam.pem 4096
                 Only file format with BEGIN DH PARAMETERS is supported.
              -->
            <dhParamsFile>/etc/clickhouse-server/dhparam.pem</dhParamsFile>
            <verificationMode>none</verificationMode>
            <loadDefaultCAFile>true</loadDefaultCAFile>
            <cacheSessions>true</cacheSessions>
            <disableProtocols>sslv2,sslv3</disableProtocols>
            <preferServerCiphers>true</preferServerCiphers>
        </server>

        <client> <!-- Used for connecting to https dictionary source and secured Zookeeper communication -->
            <loadDefaultCAFile>true</loadDefaultCAFile>
            <cacheSessions>true</cacheSessions>
            <disableProtocols>sslv2,sslv3</disableProtocols>
            <preferServerCiphers>true</preferServerCiphers>
            <!-- Use for self-signed: <verificationMode>none</verificationMode> -->
            <invalidCertificateHandler>
                <!-- Use for self-signed: <name>AcceptCertificateHandler</name> -->
                <name>RejectCertificateHandler</name>
            </invalidCertificateHandler>
        </client>
    </openSSL>

    <!-- Default root page on http[s] server. For example load UI from https://tabix.io/ when opening http://localhost:8123 -->
    <!--
    <http_server_default_response><![CDATA[<html ng-app=&#34;SMI2&#34;><head><base href=&#34;http://ui.tabix.io/&#34;></head><body><div ui-view=&#34;&#34; class=&#34;content-ui&#34;></div><script src=&#34;http://loader.tabix.io/master.js&#34;></script></body></html>]]></http_server_default_response>
    -->

    <!-- Maximum number of concurrent queries. -->
    <max_concurrent_queries>100</max_concurrent_queries>

    <!-- Maximum memory usage (resident set size) for server process.
         Zero value or unset means default. Default is &#34;max_server_memory_usage_to_ram_ratio&#34; of available physical RAM.
         If the value is larger than &#34;max_server_memory_usage_to_ram_ratio&#34; of available physical RAM, it will be cut down.

         The constraint is checked on query execution time.
         If a query tries to allocate memory and the current memory usage plus allocation is greater
          than specified threshold, exception will be thrown.

         It is not practical to set this constraint to small values like just a few gigabytes,
          because memory allocator will keep this amount of memory in caches and the server will deny service of queries.
      -->
    <max_server_memory_usage>0</max_server_memory_usage>

    <!-- Maximum number of threads in the Global thread pool.
    This will default to a maximum of 10000 threads if not specified.
    This setting will be useful in scenarios where there are a large number
    of distributed queries that are running concurrently but are idling most
    of the time, in which case a higher number of threads might be required.
    -->

    <max_thread_pool_size>10000</max_thread_pool_size>

    <!-- Number of workers to recycle connections in background (see also drain_timeout).
         If the pool is full, connection will be drained synchronously. -->
    <!-- <max_threads_for_connection_collector>10</max_threads_for_connection_collector> -->

    <!-- On memory constrained environments you may have to set this to value larger than 1.
      -->
    <max_server_memory_usage_to_ram_ratio>0.9</max_server_memory_usage_to_ram_ratio>

    <!-- Simple server-wide memory profiler. Collect a stack trace at every peak allocation step (in bytes).
         Data will be stored in system.trace_log table with query_id = empty string.
         Zero means disabled.
      -->
    <total_memory_profiler_step>4194304</total_memory_profiler_step>

    <!-- Collect random allocations and deallocations and write them into system.trace_log with 'MemorySample' trace_type.
         The probability is for every alloc/free regardless to the size of the allocation.
         Note that sampling happens only when the amount of untracked memory exceeds the untracked memory limit,
          which is 4 MiB by default but can be lowered if 'total_memory_profiler_step' is lowered.
         You may want to set 'total_memory_profiler_step' to 1 for extra fine grained sampling.
      -->
    <total_memory_tracker_sample_probability>0</total_memory_tracker_sample_probability>

    <!-- Set limit on number of open files (default: maximum). This setting makes sense on Mac OS X because getrlimit() fails to retrieve
         correct maximum value. -->
    <!-- <max_open_files>262144</max_open_files> -->

    <!-- Size of cache of uncompressed blocks of data, used in tables of MergeTree family.
         In bytes. Cache is single for server. Memory is allocated only on demand.
         Cache is used when 'use_uncompressed_cache' user setting turned on (off by default).
         Uncompressed cache is advantageous only for very short queries and in rare cases.

         Note: uncompressed cache can be pointless for lz4, because memory bandwidth
         is slower than multi-core decompression on some server configurations.
         Enabling it can sometimes paradoxically make queries slower.
      -->
    <uncompressed_cache_size>8589934592</uncompressed_cache_size>

    <!-- Approximate size of mark cache, used in tables of MergeTree family.
         In bytes. Cache is single for server. Memory is allocated only on demand.
         You should not lower this value.
      -->
    <mark_cache_size>5368709120</mark_cache_size>


    <!-- If you enable the `min_bytes_to_use_mmap_io` setting,
         the data in MergeTree tables can be read with mmap to avoid copying from kernel to userspace.
         It makes sense only for large files and helps only if data reside in page cache.
         To avoid frequent open/mmap/munmap/close calls (which are very expensive due to consequent page faults)
         and to reuse mappings from several threads and queries,
         the cache of mapped files is maintained. Its size is the number of mapped regions (usually equal to the number of mapped files).
         The amount of data in mapped files can be monitored
         in system.metrics, system.metric_log by the MMappedFiles, MMappedFileBytes metrics
         and in system.asynchronous_metrics, system.asynchronous_metrics_log by the MMapCacheCells metric,
         and also in system.events, system.processes, system.query_log, system.query_thread_log, system.query_views_log by the
         CreatedReadBufferMMap, CreatedReadBufferMMapFailed, MMappedFileCacheHits, MMappedFileCacheMisses events.
         Note that the amount of data in mapped files does not consume memory directly and is not accounted
         in query or server memory usage - because this memory can be discarded similar to OS page cache.
         The cache is dropped (the files are closed) automatically on removal of old parts in MergeTree,
         also it can be dropped manually by the SYSTEM DROP MMAP CACHE query.
      -->
    <mmap_cache_size>1000</mmap_cache_size>

    <!-- Cache size in bytes for compiled expressions.-->
    <compiled_expression_cache_size>134217728</compiled_expression_cache_size>

    <!-- Cache size in elements for compiled expressions.-->
    <compiled_expression_cache_elements_size>10000</compiled_expression_cache_elements_size>

    <!-- Path to data directory, with trailing slash. -->
    <path>/var/lib/clickhouse/</path>

    <!-- Path to temporary data for processing hard queries. -->
    <tmp_path>/var/lib/clickhouse/tmp/</tmp_path>

    <!-- Policy from the <storage_configuration> for the temporary files.
         If not set <tmp_path> is used, otherwise <tmp_path> is ignored.

         Notes:
         - move_factor              is ignored
         - keep_free_space_bytes    is ignored
         - max_data_part_size_bytes is ignored
         - you must have exactly one volume in that policy
    -->
    <!-- <tmp_policy>tmp</tmp_policy> -->

    <!-- Directory with user provided files that are accessible by 'file' table function. -->
    <user_files_path>/var/lib/clickhouse/user_files/</user_files_path>

    <!-- LDAP server definitions. -->
    <ldap_servers>
        <!-- List LDAP servers with their connection parameters here to later 1) use them as authenticators for dedicated local users,
              who have 'ldap' authentication mechanism specified instead of 'password', or to 2) use them as remote user directories.
             Parameters:
                host - LDAP server hostname or IP, this parameter is mandatory and cannot be empty.
                port - LDAP server port, default is 636 if enable_tls is set to true, 389 otherwise.
                bind_dn - template used to construct the DN to bind to.
                        The resulting DN will be constructed by replacing all '{user_name}' substrings of the template with the actual
                         user name during each authentication attempt.
                user_dn_detection - section with LDAP search parameters for detecting the actual user DN of the bound user.
                        This is mainly used in search filters for further role mapping when the server is Active Directory. The
                         resulting user DN will be used when replacing '{user_dn}' substrings wherever they are allowed. By default,
                         user DN is set equal to bind DN, but once search is performed, it will be updated with to the actual detected
                         user DN value.
                    base_dn - template used to construct the base DN for the LDAP search.
                            The resulting DN will be constructed by replacing all '{user_name}' and '{bind_dn}' substrings
                             of the template with the actual user name and bind DN during the LDAP search.
                    scope - scope of the LDAP search.
                            Accepted values are: 'base', 'one_level', 'children', 'subtree' (the default).
                    search_filter - template used to construct the search filter for the LDAP search.
                            The resulting filter will be constructed by replacing all '{user_name}', '{bind_dn}', and '{base_dn}'
                             substrings of the template with the actual user name, bind DN, and base DN during the LDAP search.
                            Note, that the special characters must be escaped properly in XML.
                verification_cooldown - a period of time, in seconds, after a successful bind attempt, during which a user will be assumed
                         to be successfully authenticated for all consecutive requests without contacting the LDAP server.
                        Specify 0 (the default) to disable caching and force contacting the LDAP server for each authentication request.
                enable_tls - flag to trigger use of secure connection to the LDAP server.
                        Specify 'no' for plain text (ldap://) protocol (not recommended).
                        Specify 'yes' for LDAP over SSL/TLS (ldaps://) protocol (recommended, the default).
                        Specify 'starttls' for legacy StartTLS protocol (plain text (ldap://) protocol, upgraded to TLS).
                tls_minimum_protocol_version - the minimum protocol version of SSL/TLS.
                        Accepted values are: 'ssl2', 'ssl3', 'tls1.0', 'tls1.1', 'tls1.2' (the default).
                tls_require_cert - SSL/TLS peer certificate verification behavior.
                        Accepted values are: 'never', 'allow', 'try', 'demand' (the default).
                tls_cert_file - path to certificate file.
                tls_key_file - path to certificate key file.
                tls_ca_cert_file - path to CA certificate file.
                tls_ca_cert_dir - path to the directory containing CA certificates.
                tls_cipher_suite - allowed cipher suite (in OpenSSL notation).
             Example:
                <my_ldap_server>
                    <host>localhost</host>
                    <port>636</port>
                    <bind_dn>uid={user_name},ou=users,dc=example,dc=com</bind_dn>
                    <verification_cooldown>300</verification_cooldown>
                    <enable_tls>yes</enable_tls>
                    <tls_minimum_protocol_version>tls1.2</tls_minimum_protocol_version>
                    <tls_require_cert>demand</tls_require_cert>
                    <tls_cert_file>/path/to/tls_cert_file</tls_cert_file>
                    <tls_key_file>/path/to/tls_key_file</tls_key_file>
                    <tls_ca_cert_file>/path/to/tls_ca_cert_file</tls_ca_cert_file>
                    <tls_ca_cert_dir>/path/to/tls_ca_cert_dir</tls_ca_cert_dir>
                    <tls_cipher_suite>ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:AES256-GCM-SHA384</tls_cipher_suite>
                </my_ldap_server>
             Example (typical Active Directory with configured user DN detection for further role mapping):
                <my_ad_server>
                    <host>localhost</host>
                    <port>389</port>
                    <bind_dn>EXAMPLE\{user_name}</bind_dn>
                    <user_dn_detection>
                        <base_dn>CN=Users,DC=example,DC=com</base_dn>
                        <search_filter>(&amp;amp;(objectClass=user)(sAMAccountName={user_name}))</search_filter>
                    </user_dn_detection>
                    <enable_tls>no</enable_tls>
                </my_ad_server>
        -->
    </ldap_servers>

    <!-- To enable Kerberos authentication support for HTTP requests (GSS-SPNEGO), for those users who are explicitly configured
          to authenticate via Kerberos, define a single 'kerberos' section here.
         Parameters:
            principal - canonical service principal name, that will be acquired and used when accepting security contexts.
                    This parameter is optional, if omitted, the default principal will be used.
                    This parameter cannot be specified together with 'realm' parameter.
            realm - a realm, that will be used to restrict authentication to only those requests whose initiator's realm matches it.
                    This parameter is optional, if omitted, no additional filtering by realm will be applied.
                    This parameter cannot be specified together with 'principal' parameter.
         Example:
            <kerberos />
         Example:
            <kerberos>
                <principal>HTTP/clickhouse.example.com@EXAMPLE.COM</principal>
            </kerberos>
         Example:
            <kerberos>
                <realm>EXAMPLE.COM</realm>
            </kerberos>
    -->

    <!-- Sources to read users, roles, access rights, profiles of settings, quotas. -->
    <user_directories>
        <users_xml>
            <!-- Path to configuration file with predefined users. -->
            <path>users.xml</path>
        </users_xml>
        <local_directory>
            <!-- Path to folder where users created by SQL commands are stored. -->
            <path>/var/lib/clickhouse/access/</path>
        </local_directory>

        <!-- To add an LDAP server as a remote user directory of users that are not defined locally, define a single 'ldap' section
              with the following parameters:
                server - one of LDAP server names defined in 'ldap_servers' config section above.
                        This parameter is mandatory and cannot be empty.
                roles - section with a list of locally defined roles that will be assigned to each user retrieved from the LDAP server.
                        If no roles are specified here or assigned during role mapping (below), user will not be able to perform any
                         actions after authentication.
                role_mapping - section with LDAP search parameters and mapping rules.
                        When a user authenticates, while still bound to LDAP, an LDAP search is performed using search_filter and the
                         name of the logged in user. For each entry found during that search, the value of the specified attribute is
                         extracted. For each attribute value that has the specified prefix, the prefix is removed, and the rest of the
                         value becomes the name of a local role defined in ClickHouse, which is expected to be created beforehand by
                         CREATE ROLE command.
                        There can be multiple 'role_mapping' sections defined inside the same 'ldap' section. All of them will be
                         applied.
                    base_dn - template used to construct the base DN for the LDAP search.
                            The resulting DN will be constructed by replacing all '{user_name}', '{bind_dn}', and '{user_dn}'
                             substrings of the template with the actual user name, bind DN, and user DN during each LDAP search.
                    scope - scope of the LDAP search.
                            Accepted values are: 'base', 'one_level', 'children', 'subtree' (the default).
                    search_filter - template used to construct the search filter for the LDAP search.
                            The resulting filter will be constructed by replacing all '{user_name}', '{bind_dn}', '{user_dn}', and
                             '{base_dn}' substrings of the template with the actual user name, bind DN, user DN, and base DN during
                             each LDAP search.
                            Note, that the special characters must be escaped properly in XML.
                    attribute - attribute name whose values will be returned by the LDAP search. 'cn', by default.
                    prefix - prefix, that will be expected to be in front of each string in the original list of strings returned by
                             the LDAP search. Prefix will be removed from the original strings and resulting strings will be treated
                             as local role names. Empty, by default.
             Example:
                <ldap>
                    <server>my_ldap_server</server>
                    <roles>
                        <my_local_role1 />
                        <my_local_role2 />
                    </roles>
                    <role_mapping>
                        <base_dn>ou=groups,dc=example,dc=com</base_dn>
                        <scope>subtree</scope>
                        <search_filter>(&amp;amp;(objectClass=groupOfNames)(member={bind_dn}))</search_filter>
                        <attribute>cn</attribute>
                        <prefix>clickhouse_</prefix>
                    </role_mapping>
                </ldap>
             Example (typical Active Directory with role mapping that relies on the detected user DN):
                <ldap>
                    <server>my_ad_server</server>
                    <role_mapping>
                        <base_dn>CN=Users,DC=example,DC=com</base_dn>
                        <attribute>CN</attribute>
                        <scope>subtree</scope>
                        <search_filter>(&amp;amp;(objectClass=group)(member={user_dn}))</search_filter>
                        <prefix>clickhouse_</prefix>
                    </role_mapping>
                </ldap>
        -->
    </user_directories>

    <!-- Default profile of settings. -->
    <default_profile>default</default_profile>

    <!-- Comma-separated list of prefixes for user-defined settings. -->
    <custom_settings_prefixes></custom_settings_prefixes>

    <!-- System profile of settings. This settings are used by internal processes (Distributed DDL worker and so on). -->
    <!-- <system_profile>default</system_profile> -->

    <!-- Buffer profile of settings.
         This settings are used by Buffer storage to flush data to the underlying table.
         Default: used from system_profile directive.
    -->
    <!-- <buffer_profile>default</buffer_profile> -->

    <!-- Default database. -->
    <default_database>default</default_database>

    <!-- Server time zone could be set here.

         Time zone is used when converting between String and DateTime types,
          when printing DateTime in text formats and parsing DateTime from text,
          it is used in date and time related functions, if specific time zone was not passed as an argument.

         Time zone is specified as identifier from IANA time zone database, like UTC or Africa/Abidjan.
         If not specified, system time zone at server startup is used.

         Please note, that server could display time zone alias instead of specified name.
         Example: W-SU is an alias for Europe/Moscow and Zulu is an alias for UTC.
    -->
    <!-- <timezone>Europe/Moscow</timezone> -->

    <!-- You can specify umask here (see &#34;man umask&#34;). Server will apply it on startup.
         Number is always parsed as octal. Default umask is 027 (other users cannot read logs, data files, etc; group can only read).
    -->
    <!-- <umask>022</umask> -->

    <!-- Perform mlockall after startup to lower first queries latency
          and to prevent clickhouse executable from being paged out under high IO load.
         Enabling this option is recommended but will lead to increased startup time for up to a few seconds.
    -->
    <mlock_executable>true</mlock_executable>

    <!-- Reallocate memory for machine code (&#34;text&#34;) using huge pages. Highly experimental. -->
    <remap_executable>false</remap_executable>

    <![CDATA[
         Uncomment below in order to use JDBC table engine and function.

         To install and run JDBC bridge in background:
         * [Debian/Ubuntu]
           export MVN_URL=https://repo1.maven.org/maven2/ru/yandex/clickhouse/clickhouse-jdbc-bridge
           export PKG_VER=$(curl -sL $MVN_URL/maven-metadata.xml | grep '<release>' | sed -e 's|.*>\(.*\)<.*|\1|')
           wget https://github.com/ClickHouse/clickhouse-jdbc-bridge/releases/download/v$PKG_VER/clickhouse-jdbc-bridge_$PKG_VER-1_all.deb
           apt install --no-install-recommends -f ./clickhouse-jdbc-bridge_$PKG_VER-1_all.deb
           clickhouse-jdbc-bridge &

         * [CentOS/RHEL]
           export MVN_URL=https://repo1.maven.org/maven2/ru/yandex/clickhouse/clickhouse-jdbc-bridge
           export PKG_VER=$(curl -sL $MVN_URL/maven-metadata.xml | grep '<release>' | sed -e 's|.*>\(.*\)<.*|\1|')
           wget https://github.com/ClickHouse/clickhouse-jdbc-bridge/releases/download/v$PKG_VER/clickhouse-jdbc-bridge-$PKG_VER-1.noarch.rpm
           yum localinstall -y clickhouse-jdbc-bridge-$PKG_VER-1.noarch.rpm
           clickhouse-jdbc-bridge &

         Please refer to https://github.com/ClickHouse/clickhouse-jdbc-bridge#usage for more information.
    ]]>
    <!--
    <jdbc_bridge>
        <host>127.0.0.1</host>
        <port>9019</port>
    </jdbc_bridge>
    -->

    <!-- Configuration of clusters that could be used in Distributed tables.
         https://clickhouse.com/docs/en/operations/table_engines/distributed/
      -->
    <remote_servers>
        <default_cluster>
            <shard>
                <weight>1</weight>
                <internal_replication>false</internal_replication>
                <replica>
                    <host>ck1</host>
                    <port>9000</port>
                </replica>
            </shard>
            <shard>
                <weight>1</weight>
                <internal_replication>false</internal_replication>
                <replica>
                    <host>ck2</host>
                    <port>9000</port>
                </replica>
            </shard>
            <shard>
                <weight>1</weight>
                <internal_replication>false</internal_replication>
                <replica>
                    <host>ck3</host>
                    <port>9000</port>
                </replica>
            </shard>
        </default_cluster>
    </remote_servers>

    <macros>
        <replica>ck1</replica>
        <shard>01</shard>
        <layer>01</layer>
    </macros>


    <!-- The list of hosts allowed to use in URL-related storage engines and table functions.
        If this section is not present in configuration, all hosts are allowed.
    -->
    <!--<remote_url_allow_hosts>-->
    <!-- Host should be specified exactly as in URL. The name is checked before DNS resolution.
        Example: &#34;yandex.ru&#34;, &#34;yandex.ru.&#34; and &#34;www.yandex.ru&#34; are different hosts.
                If port is explicitly specified in URL, the host:port is checked as a whole.
                If host specified here without port, any port with this host allowed.
                &#34;yandex.ru&#34; -> &#34;yandex.ru:443&#34;, &#34;yandex.ru:80&#34; etc. is allowed, but &#34;yandex.ru:80&#34; -> only &#34;yandex.ru:80&#34; is allowed.
        If the host is specified as IP address, it is checked as specified in URL. Example: &#34;[2a02:6b8:a::a]&#34;.
        If there are redirects and support for redirects is enabled, every redirect (the Location field) is checked.
        Host should be specified using the host xml tag:
                <host>yandex.ru</host>
    -->

    <!-- Regular expression can be specified. RE2 engine is used for regexps.
        Regexps are not aligned: don't forget to add ^ and $. Also don't forget to escape dot (.) metacharacter
        (forgetting to do so is a common source of error).
    -->
    <!--</remote_url_allow_hosts>-->

    <!-- If element has 'incl' attribute, then for it's value will be used corresponding substitution from another file.
         By default, path to file with substitutions is /etc/metrika.xml. It could be changed in config in 'include_from' element.
         Values for substitutions are specified in /clickhouse/name_of_substitution elements in that file.
      -->

    <!-- ZooKeeper is used to store metadata about replicas, when using Replicated tables.
         Optional. If you don't use replicated tables, you could omit that.

         See https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replication/
      -->

    <zookeeper>
        <node>
            <host>zookeeper1</host>
            <port>2181</port>
        </node>
    </zookeeper>

    <!-- Substitutions for parameters of replicated tables.
          Optional. If you don't use replicated tables, you could omit that.

         See https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replication/#creating-replicated-tables
      -->
    <!--
    <macros>
        <shard>01</shard>
        <replica>example01-01-1</replica>
    </macros>
    -->


    <!-- Reloading interval for embedded dictionaries, in seconds. Default: 3600. -->
    <builtin_dictionaries_reload_interval>3600</builtin_dictionaries_reload_interval>


    <!-- Maximum session timeout, in seconds. Default: 3600. -->
    <max_session_timeout>3600</max_session_timeout>

    <!-- Default session timeout, in seconds. Default: 60. -->
    <default_session_timeout>60</default_session_timeout>

    <!-- Sending data to Graphite for monitoring. Several sections can be defined. -->
    <!--
        interval - send every X second
        root_path - prefix for keys
        hostname_in_path - append hostname to root_path (default = true)
        metrics - send data from table system.metrics
        events - send data from table system.events
        asynchronous_metrics - send data from table system.asynchronous_metrics
    -->
    <!--
    <graphite>
        <host>localhost</host>
        <port>42000</port>
        <timeout>0.1</timeout>
        <interval>60</interval>
        <root_path>one_min</root_path>
        <hostname_in_path>true</hostname_in_path>

        <metrics>true</metrics>
        <events>true</events>
        <events_cumulative>false</events_cumulative>
        <asynchronous_metrics>true</asynchronous_metrics>
    </graphite>
    <graphite>
        <host>localhost</host>
        <port>42000</port>
        <timeout>0.1</timeout>
        <interval>1</interval>
        <root_path>one_sec</root_path>

        <metrics>true</metrics>
        <events>true</events>
        <events_cumulative>false</events_cumulative>
        <asynchronous_metrics>false</asynchronous_metrics>
    </graphite>
    -->

    <!-- Serve endpoint for Prometheus monitoring. -->
    <!--
        endpoint - mertics path (relative to root, statring with &#34;/&#34;)
        port - port to setup server. If not defined or 0 than http_port used
        metrics - send data from table system.metrics
        events - send data from table system.events
        asynchronous_metrics - send data from table system.asynchronous_metrics
        status_info - send data from different component from CH, ex: Dictionaries status
    -->
    <!--
    <prometheus>
        <endpoint>/metrics</endpoint>
        <port>9363</port>

        <metrics>true</metrics>
        <events>true</events>
        <asynchronous_metrics>true</asynchronous_metrics>
        <status_info>true</status_info>
    </prometheus>
    -->

    <!-- Query log. Used only for queries with setting log_queries = 1. -->
    <query_log>
        <!-- What table to insert data. If table is not exist, it will be created.
             When query log structure is changed after system update,
              then old table will be renamed and new table will be created automatically.
        -->
        <database>system</database>
        <table>query_log</table>
        <!--
            PARTITION BY expr: https://clickhouse.com/docs/en/table_engines/mergetree-family/custom_partitioning_key/
            Example:
                event_date
                toMonday(event_date)
                toYYYYMM(event_date)
                toStartOfHour(event_time)
        -->
        <partition_by>toYYYYMM(event_date)</partition_by>
        <!--
            Table TTL specification: https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree/#mergetree-table-ttl
            Example:
                event_date + INTERVAL 1 WEEK
                event_date + INTERVAL 7 DAY DELETE
                event_date + INTERVAL 2 WEEK TO DISK 'bbb'

        <ttl>event_date + INTERVAL 30 DAY DELETE</ttl>
        -->

        <!-- Instead of partition_by, you can provide full engine expression (starting with ENGINE = ) with parameters,
             Example: <engine>ENGINE = MergeTree PARTITION BY toYYYYMM(event_date) ORDER BY (event_date, event_time) SETTINGS index_granularity = 1024</engine>
          -->

        <!-- Interval of flushing data. -->
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </query_log>

    <!-- Trace log. Stores stack traces collected by query profilers.
         See query_profiler_real_time_period_ns and query_profiler_cpu_time_period_ns settings. -->
    <trace_log>
        <database>system</database>
        <table>trace_log</table>

        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </trace_log>

    <!-- Query thread log. Has information about all threads participated in query execution.
         Used only for queries with setting log_query_threads = 1. -->
    <query_thread_log>
        <database>system</database>
        <table>query_thread_log</table>
        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </query_thread_log>

    <!-- Query views log. Has information about all dependent views associated with a query.
         Used only for queries with setting log_query_views = 1. -->
    <query_views_log>
        <database>system</database>
        <table>query_views_log</table>
        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </query_views_log>

    <!-- Uncomment if use part log.
         Part log contains information about all actions with parts in MergeTree tables (creation, deletion, merges, downloads).-->
    <part_log>
        <database>system</database>
        <table>part_log</table>
        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </part_log>

    <!-- Uncomment to write text log into table.
         Text log contains all information from usual server log but stores it in structured and efficient way.
         The level of the messages that goes to the table can be limited (<level>), if not specified all messages will go to the table.
    <text_log>
        <database>system</database>
        <table>text_log</table>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
        <level></level>
    </text_log>
    -->

    <!-- Metric log contains rows with current values of ProfileEvents, CurrentMetrics collected with &#34;collect_interval_milliseconds&#34; interval. -->
    <metric_log>
        <database>system</database>
        <table>metric_log</table>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
        <collect_interval_milliseconds>1000</collect_interval_milliseconds>
    </metric_log>

    <!--
        Asynchronous metric log contains values of metrics from
        system.asynchronous_metrics.
    -->
    <asynchronous_metric_log>
        <database>system</database>
        <table>asynchronous_metric_log</table>
        <!--
            Asynchronous metrics are updated once a minute, so there is
            no need to flush more often.
        -->
        <flush_interval_milliseconds>7000</flush_interval_milliseconds>
    </asynchronous_metric_log>

    <!--
        OpenTelemetry log contains OpenTelemetry trace spans.
    -->
    <opentelemetry_span_log>
        <!--
            The default table creation code is insufficient, this <engine> spec
            is a workaround. There is no 'event_time' for this log, but two times,
            start and finish. It is sorted by finish time, to avoid inserting
            data too far away in the past (probably we can sometimes insert a span
            that is seconds earlier than the last span in the table, due to a race
            between several spans inserted in parallel). This gives the spans a
            global order that we can use to e.g. retry insertion into some external
            system.
        -->
        <engine>
            engine MergeTree
            partition by toYYYYMM(finish_date)
            order by (finish_date, finish_time_us, trace_id)
        </engine>
        <database>system</database>
        <table>opentelemetry_span_log</table>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </opentelemetry_span_log>


    <!-- Crash log. Stores stack traces for fatal errors.
         This table is normally empty. -->
    <crash_log>
        <database>system</database>
        <table>crash_log</table>

        <partition_by/>
        <flush_interval_milliseconds>1000</flush_interval_milliseconds>
    </crash_log>

    <!-- Session log. Stores user log in (successful or not) and log out events. -->
    <session_log>
        <database>system</database>
        <table>session_log</table>

        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </session_log>

    <!-- Parameters for embedded dictionaries, used in Yandex.Metrica.
         See https://clickhouse.com/docs/en/dicts/internal_dicts/
    -->

    <!-- Path to file with region hierarchy. -->
    <!-- <path_to_regions_hierarchy_file>/opt/geo/regions_hierarchy.txt</path_to_regions_hierarchy_file> -->

    <!-- Path to directory with files containing names of regions -->
    <!-- <path_to_regions_names_files>/opt/geo/</path_to_regions_names_files> -->


    <!-- <top_level_domains_path>/var/lib/clickhouse/top_level_domains/</top_level_domains_path> -->
    <!-- Custom TLD lists.
         Format: <name>/path/to/file</name>

         Changes will not be applied w/o server restart.
         Path to the list is under top_level_domains_path (see above).
    -->
    <top_level_domains_lists>
        <!--
        <public_suffix_list>/path/to/public_suffix_list.dat</public_suffix_list>
        -->
    </top_level_domains_lists>

    <!-- Configuration of external dictionaries. See:
         https://clickhouse.com/docs/en/sql-reference/dictionaries/external-dictionaries/external-dicts
    -->
    <dictionaries_config>*_dictionary.xml</dictionaries_config>

    <!-- Configuration of user defined executable functions -->
    <user_defined_executable_functions_config>*_function.xml</user_defined_executable_functions_config>

    <!-- Uncomment if you want data to be compressed 30-100% better.
         Don't do that if you just started using ClickHouse.
      -->
    <!--
    <compression>
        <!- - Set of variants. Checked in order. Last matching case wins. If nothing matches, lz4 will be used. - ->
        <case>

            <!- - Conditions. All must be satisfied. Some conditions may be omitted. - ->
            <min_part_size>10000000000</min_part_size>        <!- - Min part size in bytes. - ->
            <min_part_size_ratio>0.01</min_part_size_ratio>   <!- - Min size of part relative to whole table size. - ->

            <!- - What compression method to use. - ->
            <method>zstd</method>
        </case>
    </compression>
    -->

    <!-- Configuration of encryption. The server executes a command to
         obtain an encryption key at startup if such a command is
         defined, or encryption codecs will be disabled otherwise. The
         command is executed through /bin/sh and is expected to write
         a Base64-encoded key to the stdout. -->
    <encryption_codecs>
        <!-- aes_128_gcm_siv -->
        <!-- Example of getting hex key from env -->
        <!-- the code should use this key and throw an exception if its length is not 16 bytes -->
        <!--key_hex from_env=&#34;...&#34;></key_hex -->

        <!-- Example of multiple hex keys. They can be imported from env or be written down in config-->
        <!-- the code should use these keys and throw an exception if their length is not 16 bytes -->
        <!-- key_hex id=&#34;0&#34;>...</key_hex -->
        <!-- key_hex id=&#34;1&#34; from_env=&#34;..&#34;></key_hex -->
        <!-- key_hex id=&#34;2&#34;>...</key_hex -->
        <!-- current_key_id>2</current_key_id -->

        <!-- Example of getting hex key from config -->
        <!-- the code should use this key and throw an exception if its length is not 16 bytes -->
        <!-- key>...</key -->

        <!-- example of adding nonce -->
        <!-- nonce>...</nonce -->

        <!-- /aes_128_gcm_siv -->
    </encryption_codecs>

    <!-- Allow to execute distributed DDL queries (CREATE, DROP, ALTER, RENAME) on cluster.
         Works only if ZooKeeper is enabled. Comment it if such functionality isn't required. -->
    <distributed_ddl>
        <!-- Path in ZooKeeper to queue with DDL queries -->
        <path>/clickhouse/task_queue/ddl</path>

        <!-- Settings from this profile will be used to execute DDL queries -->
        <!-- <profile>default</profile> -->

        <!-- Controls how much ON CLUSTER queries can be run simultaneously. -->
        <!-- <pool_size>1</pool_size> -->

        <!--
             Cleanup settings (active tasks will not be removed)
        -->

        <!-- Controls task TTL (default 1 week) -->
        <!-- <task_max_lifetime>604800</task_max_lifetime> -->

        <!-- Controls how often cleanup should be performed (in seconds) -->
        <!-- <cleanup_delay_period>60</cleanup_delay_period> -->

        <!-- Controls how many tasks could be in the queue -->
        <!-- <max_tasks_in_queue>1000</max_tasks_in_queue> -->
    </distributed_ddl>

    <!-- Settings to fine tune MergeTree tables. See documentation in source code, in MergeTreeSettings.h -->
    <!--
    <merge_tree>
        <max_suspicious_broken_parts>5</max_suspicious_broken_parts>
    </merge_tree>
    -->

    <!-- Protection from accidental DROP.
         If size of a MergeTree table is greater than max_table_size_to_drop (in bytes) than table could not be dropped with any DROP query.
         If you want do delete one table and don't want to change clickhouse-server config, you could create special file <clickhouse-path>/flags/force_drop_table and make DROP once.
         By default max_table_size_to_drop is 50GB; max_table_size_to_drop=0 allows to DROP any tables.
         The same for max_partition_size_to_drop.
         Uncomment to disable protection.
    -->
    <!-- <max_table_size_to_drop>0</max_table_size_to_drop> -->
    <!-- <max_partition_size_to_drop>0</max_partition_size_to_drop> -->

    <!-- Example of parameters for GraphiteMergeTree table engine -->
    <graphite_rollup_example>
        <pattern>
            <regexp>click_cost</regexp>
            <function>any</function>
            <retention>
                <age>0</age>
                <precision>3600</precision>
            </retention>
            <retention>
                <age>86400</age>
                <precision>60</precision>
            </retention>
        </pattern>
        <default>
            <function>max</function>
            <retention>
                <age>0</age>
                <precision>60</precision>
            </retention>
            <retention>
                <age>3600</age>
                <precision>300</precision>
            </retention>
            <retention>
                <age>86400</age>
                <precision>3600</precision>
            </retention>
        </default>
    </graphite_rollup_example>

    <!-- Directory in <clickhouse-path> containing schema files for various input formats.
         The directory will be created if it doesn't exist.
      -->
    <format_schema_path>/var/lib/clickhouse/format_schemas/</format_schema_path>

    <!-- Default query masking rules, matching lines would be replaced with something else in the logs
        (both text logs and system.query_log).
        name - name for the rule (optional)
        regexp - RE2 compatible regular expression (mandatory)
        replace - substitution string for sensitive data (optional, by default - six asterisks)
    -->
    <query_masking_rules>
        <rule>
            <name>hide encrypt/decrypt arguments</name>
            <regexp>((?:aes_)?(?:encrypt|decrypt)(?:_mysql)?)\s*\(\s*(?:'(?:\\'|.)+'|.*?)\s*\)</regexp>
            <!-- or more secure, but also more invasive:
                (aes_\w+)\s*\(.*\)
            -->
            <replace>\1(???)</replace>
        </rule>
    </query_masking_rules>

    <!-- Uncomment to use custom http handlers.
        rules are checked from top to bottom, first match runs the handler
            url - to match request URL, you can use 'regex:' prefix to use regex match(optional)
            methods - to match request method, you can use commas to separate multiple method matches(optional)
            headers - to match request headers, match each child element(child element name is header name), you can use 'regex:' prefix to use regex match(optional)
        handler is request handler
            type - supported types: static, dynamic_query_handler, predefined_query_handler
            query - use with predefined_query_handler type, executes query when the handler is called
            query_param_name - use with dynamic_query_handler type, extracts and executes the value corresponding to the <query_param_name> value in HTTP request params
            status - use with static type, response status code
            content_type - use with static type, response content-type
            response_content - use with static type, Response content sent to client, when using the prefix 'file://' or 'config://', find the content from the file or configuration send to client.

    <http_handlers>
        <rule>
            <url>/</url>
            <methods>POST,GET</methods>
            <headers><pragma>no-cache</pragma></headers>
            <handler>
                <type>dynamic_query_handler</type>
                <query_param_name>query</query_param_name>
            </handler>
        </rule>

        <rule>
            <url>/predefined_query</url>
            <methods>POST,GET</methods>
            <handler>
                <type>predefined_query_handler</type>
                <query>SELECT * FROM system.settings</query>
            </handler>
        </rule>

        <rule>
            <handler>
                <type>static</type>
                <status>200</status>
                <content_type>text/plain; charset=UTF-8</content_type>
                <response_content>config://http_server_default_response</response_content>
            </handler>
        </rule>
    </http_handlers>
    -->

    <send_crash_reports>
        <!-- Changing <enabled> to true allows sending crash reports to -->
        <!-- the ClickHouse core developers team via Sentry https://sentry.io -->
        <!-- Doing so at least in pre-production environments is highly appreciated -->
        <enabled>false</enabled>
        <!-- Change <anonymize> to true if you don't feel comfortable attaching the server hostname to the crash report -->
        <anonymize>false</anonymize>
        <!-- Default endpoint s hould be changed to different Sentry DSN only if you have -->
        <!-- some in-house engineers or hired consultants who're going to debug ClickHouse issues for you -->
        <endpoint></endpoint>
    </send_crash_reports>

    <!-- Uncomment to disable ClickHouse internal DNS caching. -->
    <!-- <disable_internal_dns_cache>1</disable_internal_dns_cache> -->

    <!-- You can also configure rocksdb like this: -->
    <!--
    <rocksdb>
        <options>
            <max_background_jobs>8</max_background_jobs>
        </options>
        <column_family_options>
            <num_levels>2</num_levels>
        </column_family_options>
        <tables>
            <table>
                <name>TABLE</name>
                <options>
                    <max_background_jobs>8</max_background_jobs>
                </options>
                <column_family_options>
                    <num_levels>2</num_levels>
                </column_family_options>
            </table>
        </tables>
    </rocksdb>
    -->
    <timezone>Asia/Shanghai</timezone>
</clickhouse>
启动命令
docker-compose up -d
TODO
现在配置的 zookeeper 还是单机部署的，有空看看部署个zookeeper集群怎么配置"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.lvcshu.com/2022/08/12/deploy-clickhouse-by-docker-compose/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-12T17:30:00+08:00"><meta property="article:modified_time" content="2022-08-12T17:30:00+08:00"><meta property="og:site_name" content="johnpoint's blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="使用 docker-compose 搭建 clickhouse 集群"><meta name=twitter:description content="Docker Compose 配置
version: '3'
services:
  clickhouse-server-ck1:
    restart: on-failure:10 # 退出非0重启，尝试10次
    image: yandex/clickhouse-server
    container_name: ck1
    networks:
      - ck-network
    ports:
      - &#34;8124:8123&#34;
      - &#34;9001:9000&#34;
      - &#34;9010:9004&#34;
    volumes:
      - `pwd`/clickhouse/:/var/lib/clickhouse/
      - `pwd`/clickhouse-server/:/etc/clickhouse-server/
      - `pwd`/log/clickhouse-server/:/var/log/clickhouse-server/
    ulimits:
      nofile:
        soft: &#34;262144&#34;
        hard: &#34;262144&#34;
    depends_on:
      - zookeeper-1

  clickhouse-server-ck2:
    restart: on-failure:10 # 退出非0重启，尝试10次
    image: yandex/clickhouse-server
    container_name: ck2
    networks:
      - ck-network
    ports:
      - &#34;8125:8123&#34;
      - &#34;9002:9000&#34;
      - &#34;9011:9004&#34;
    volumes:
      - `pwd`/clickhouse2/:/var/lib/clickhouse/
      - `pwd`/clickhouse-server2/:/etc/clickhouse-server/
      - `pwd`/log/clickhouse-server2/:/var/log/clickhouse-server/
    ulimits:
      nofile:
        soft: &#34;262144&#34;
        hard: &#34;262144&#34;
    depends_on:
      - zookeeper-1

  clickhouse-server-ck3:
    restart: on-failure:10 # 退出非0重启，尝试10次
    image: yandex/clickhouse-server
    container_name: ck3
    networks:
      - ck-network
    ports:
      - &#34;8126:8123&#34;
      - &#34;9003:9000&#34;
      - &#34;9012:9004&#34;
    volumes:
      - `pwd`/clickhouse3/:/var/lib/clickhouse/
      - `pwd`/clickhouse-server3/:/etc/clickhouse-server/
      - `pwd`/log/clickhouse-server3/:/var/log/clickhouse-server/
    ulimits:
      nofile:
        soft: &#34;262144&#34;
        hard: &#34;262144&#34;
    depends_on:
      - zookeeper-1

  zookeeper-1:
    restart: on-failure:10 # 退出非0重启，尝试10次
    image: zookeeper:3.8.0
    container_name: zookeeper1
    networks:
      - ck-network
    ports:
      - &#34;2181:2181&#34;
    volumes:
      - `pwd`/zookeeper/conf/:/apache-zookeeper-3.8.0-bin/conf/
      - `pwd`/zookeeper/data/:/data
      - `pwd`/zookeeper/datalog/:/datalog
      - `pwd`/zookeeper/logs/:/logs
    ulimits:
      nofile:
        soft: &#34;262144&#34;
        hard: &#34;262144&#34;

networks:
  ck-network:
Clickhouse 配置文件
<?xml version=&#34;1.0&#34;?>
<!--
  NOTE: User and query level settings are set up in &#34;users.xml&#34; file.
  If you have accidentally specified user-level settings here, server won't start.
  You can either move the settings to the right place inside &#34;users.xml&#34; file
   or add <skip_check_for_incorrect_settings>1</skip_check_for_incorrect_settings> here.
-->
<clickhouse>
    <logger>
        <!-- Possible levels [1]:

          - none (turns off logging)
          - fatal
          - critical
          - error
          - warning
          - notice
          - information
          - debug
          - trace
          - test (not for production usage)

            [1]: https://github.com/pocoproject/poco/blob/poco-1.9.4-release/Foundation/include/Poco/Logger.h#L105-L114
        -->
        <level>trace</level>
        <log>/var/log/clickhouse-server/clickhouse-server.log</log>
        <errorlog>/var/log/clickhouse-server/clickhouse-server.err.log</errorlog>
        <!-- Rotation policy
             See https://github.com/pocoproject/poco/blob/poco-1.9.4-release/Foundation/include/Poco/FileChannel.h#L54-L85
          -->
        <size>1000M</size>
        <count>10</count>
        <!-- <console>1</console> --> <!-- Default behavior is autodetection (log to console if not daemon mode and is tty) -->

        <!-- Per level overrides (legacy):

        For example to suppress logging of the ConfigReloader you can use:
        NOTE: levels.logger is reserved, see below.
        -->
        <!--
        <levels>
          <ConfigReloader>none</ConfigReloader>
        </levels>
        -->

        <!-- Per level overrides:

        For example to suppress logging of the RBAC for default user you can use:
        (But please note that the logger name maybe changed from version to version, even after minor upgrade)
        -->
        <!--
        <levels>
          <logger>
            <name>ContextAccess (default)</name>
            <level>none</level>
          </logger>
          <logger>
            <name>DatabaseOrdinary (test)</name>
            <level>none</level>
          </logger>
        </levels>
        -->
    </logger>

    <!-- Add headers to response in options request. OPTIONS method is used in CORS preflight requests. -->
    <!-- It is off by default. Next headers are obligate for CORS.-->
    <!-- http_options_response>
        <header>
            <name>Access-Control-Allow-Origin</name>
            <value>*</value>
        </header>
        <header>
            <name>Access-Control-Allow-Headers</name>
            <value>origin, x-requested-with</value>
        </header>
        <header>
            <name>Access-Control-Allow-Methods</name>
            <value>POST, GET, OPTIONS</value>
        </header>
        <header>
            <name>Access-Control-Max-Age</name>
            <value>86400</value>
        </header>
    </http_options_response -->

    <!-- It is the name that will be shown in the clickhouse-client.
         By default, anything with &#34;production&#34; will be highlighted in red in query prompt.
    -->
    <!--display_name>production</display_name-->

    <!-- Port for HTTP API. See also 'https_port' for secure connections.
         This interface is also used by ODBC and JDBC drivers (DataGrip, Dbeaver, ...)
         and by most of web interfaces (embedded UI, Grafana, Redash, ...).
      -->
    <http_port>8123</http_port>

    <!-- Port for interaction by native protocol with:
         - clickhouse-client and other native ClickHouse tools (clickhouse-benchmark, clickhouse-copier);
         - clickhouse-server with other clickhouse-servers for distributed query processing;
         - ClickHouse drivers and applications supporting native protocol
         (this protocol is also informally called as &#34;the TCP protocol&#34;);
         See also 'tcp_port_secure' for secure connections.
    -->
    <tcp_port>9000</tcp_port>

    <!-- Compatibility with MySQL protocol.
         ClickHouse will pretend to be MySQL for applications connecting to this port.
    -->
    <mysql_port>9004</mysql_port>

    <!-- Compatibility with PostgreSQL protocol.
         ClickHouse will pretend to be PostgreSQL for applications connecting to this port.
    -->
    <postgresql_port>9005</postgresql_port>

    <!-- HTTP API with TLS (HTTPS).
         You have to configure certificate to enable this interface.
         See the openSSL section below.
    -->
    <!-- <https_port>8443</https_port> -->

    <!-- Native interface with TLS.
         You have to configure certificate to enable this interface.
         See the openSSL section below.
    -->
    <!-- <tcp_port_secure>9440</tcp_port_secure> -->

    <!-- Native interface wrapped with PROXYv1 protocol
         PROXYv1 header sent for every connection.
         ClickHouse will extract information about proxy-forwarded client address from the header.
    -->
    <!-- <tcp_with_proxy_port>9011</tcp_with_proxy_port> -->

    <!-- Port for communication between replicas. Used for data exchange.
         It provides low-level data access between servers.
         This port should not be accessible from untrusted networks.
         See also 'interserver_http_credentials'.
         Data transferred over connections to this port should not go through untrusted networks.
         See also 'interserver_https_port'.
      -->
    <interserver_http_port>9009</interserver_http_port>

    <!-- Port for communication between replicas with TLS.
         You have to configure certificate to enable this interface.
         See the openSSL section below.
         See also 'interserver_http_credentials'.
      -->
    <!-- <interserver_https_port>9010</interserver_https_port> -->

    <!-- Hostname that is used by other replicas to request this server.
         If not specified, than it is determined analogous to 'hostname -f' command.
         This setting could be used to switch replication to another network interface
         (the server may be connected to multiple networks via multiple addresses)
      -->

    <interserver_http_host>0.0.0.0</interserver_http_host>

    <!-- You can specify credentials for authenthication between replicas.
         This is required when interserver_https_port is accessible from untrusted networks,
         and also recommended to avoid SSRF attacks from possibly compromised services in your network.
      -->
    <!--<interserver_http_credentials>
        <user>interserver</user>
        <password></password>
    </interserver_http_credentials>-->

    <!-- Listen specified address.
         Use :: (wildcard IPv6 address), if you want to accept connections both with IPv4 and IPv6 from everywhere.
         Notes:
         If you open connections from wildcard address, make sure that at least one of the following measures applied:
         - server is protected by firewall and not accessible from untrusted networks;
         - all users are restricted to subset of network addresses (see users.xml);
         - all users have strong passwords, only secure (TLS) interfaces are accessible, or connections are only made via TLS interfaces.
         - users without password have readonly access.
         See also: https://www.shodan.io/search?query=clickhouse
      -->
    <!-- <listen_host>::</listen_host> -->


    <!-- Same for hosts without support for IPv6: -->
    <listen_host>0.0.0.0</listen_host>

    <!-- Default values - try listen localhost on IPv4 and IPv6. -->
    <!--
    <listen_host>::1</listen_host>
    <listen_host>127.0.0.1</listen_host>
    -->

    <!-- Don't exit if IPv6 or IPv4 networks are unavailable while trying to listen. -->
    <!-- <listen_try>0</listen_try> -->

    <!-- Allow multiple servers to listen on the same address:port. This is not recommended.
      -->
    <!-- <listen_reuse_port>0</listen_reuse_port> -->

    <!-- <listen_backlog>4096</listen_backlog> -->

    <max_connections>4096</max_connections>

    <!-- For 'Connection: keep-alive' in HTTP 1.1 -->
    <keep_alive_timeout>3</keep_alive_timeout>

    <!-- gRPC protocol (see src/Server/grpc_protos/clickhouse_grpc.proto for the API) -->
    <!-- <grpc_port>9100</grpc_port> -->
    <grpc>
        <enable_ssl>false</enable_ssl>

        <!-- The following two files are used only if enable_ssl=1 -->
        <ssl_cert_file>/path/to/ssl_cert_file</ssl_cert_file>
        <ssl_key_file>/path/to/ssl_key_file</ssl_key_file>

        <!-- Whether server will request client for a certificate -->
        <ssl_require_client_auth>false</ssl_require_client_auth>

        <!-- The following file is used only if ssl_require_client_auth=1 -->
        <ssl_ca_cert_file>/path/to/ssl_ca_cert_file</ssl_ca_cert_file>

        <!-- Default compression algorithm (applied if client doesn't specify another algorithm, see result_compression in QueryInfo).
             Supported algorithms: none, deflate, gzip, stream_gzip -->
        <compression>deflate</compression>

        <!-- Default compression level (applied if client doesn't specify another level, see result_compression in QueryInfo).
             Supported levels: none, low, medium, high -->
        <compression_level>medium</compression_level>

        <!-- Send/receive message size limits in bytes. -1 means unlimited -->
        <max_send_message_size>-1</max_send_message_size>
        <max_receive_message_size>-1</max_receive_message_size>

        <!-- Enable if you want very detailed logs -->
        <verbose_logs>false</verbose_logs>
    </grpc>

    <!-- Used with https_port and tcp_port_secure. Full ssl options list: https://github.com/ClickHouse-Extras/poco/blob/master/NetSSL_OpenSSL/include/Poco/Net/SSLManager.h#L71 -->
    <openSSL>
        <server> <!-- Used for https server AND secure tcp port -->
            <!-- openssl req -subj &#34;/CN=localhost&#34; -new -newkey rsa:2048 -days 365 -nodes -x509 -keyout /etc/clickhouse-server/server.key -out /etc/clickhouse-server/server.crt -->
            <certificateFile>/etc/clickhouse-server/server.crt</certificateFile>
            <privateKeyFile>/etc/clickhouse-server/server.key</privateKeyFile>
            <!-- dhparams are optional. You can delete the <dhParamsFile> element.
                 To generate dhparams, use the following command:
                  openssl dhparam -out /etc/clickhouse-server/dhparam.pem 4096
                 Only file format with BEGIN DH PARAMETERS is supported.
              -->
            <dhParamsFile>/etc/clickhouse-server/dhparam.pem</dhParamsFile>
            <verificationMode>none</verificationMode>
            <loadDefaultCAFile>true</loadDefaultCAFile>
            <cacheSessions>true</cacheSessions>
            <disableProtocols>sslv2,sslv3</disableProtocols>
            <preferServerCiphers>true</preferServerCiphers>
        </server>

        <client> <!-- Used for connecting to https dictionary source and secured Zookeeper communication -->
            <loadDefaultCAFile>true</loadDefaultCAFile>
            <cacheSessions>true</cacheSessions>
            <disableProtocols>sslv2,sslv3</disableProtocols>
            <preferServerCiphers>true</preferServerCiphers>
            <!-- Use for self-signed: <verificationMode>none</verificationMode> -->
            <invalidCertificateHandler>
                <!-- Use for self-signed: <name>AcceptCertificateHandler</name> -->
                <name>RejectCertificateHandler</name>
            </invalidCertificateHandler>
        </client>
    </openSSL>

    <!-- Default root page on http[s] server. For example load UI from https://tabix.io/ when opening http://localhost:8123 -->
    <!--
    <http_server_default_response><![CDATA[<html ng-app=&#34;SMI2&#34;><head><base href=&#34;http://ui.tabix.io/&#34;></head><body><div ui-view=&#34;&#34; class=&#34;content-ui&#34;></div><script src=&#34;http://loader.tabix.io/master.js&#34;></script></body></html>]]></http_server_default_response>
    -->

    <!-- Maximum number of concurrent queries. -->
    <max_concurrent_queries>100</max_concurrent_queries>

    <!-- Maximum memory usage (resident set size) for server process.
         Zero value or unset means default. Default is &#34;max_server_memory_usage_to_ram_ratio&#34; of available physical RAM.
         If the value is larger than &#34;max_server_memory_usage_to_ram_ratio&#34; of available physical RAM, it will be cut down.

         The constraint is checked on query execution time.
         If a query tries to allocate memory and the current memory usage plus allocation is greater
          than specified threshold, exception will be thrown.

         It is not practical to set this constraint to small values like just a few gigabytes,
          because memory allocator will keep this amount of memory in caches and the server will deny service of queries.
      -->
    <max_server_memory_usage>0</max_server_memory_usage>

    <!-- Maximum number of threads in the Global thread pool.
    This will default to a maximum of 10000 threads if not specified.
    This setting will be useful in scenarios where there are a large number
    of distributed queries that are running concurrently but are idling most
    of the time, in which case a higher number of threads might be required.
    -->

    <max_thread_pool_size>10000</max_thread_pool_size>

    <!-- Number of workers to recycle connections in background (see also drain_timeout).
         If the pool is full, connection will be drained synchronously. -->
    <!-- <max_threads_for_connection_collector>10</max_threads_for_connection_collector> -->

    <!-- On memory constrained environments you may have to set this to value larger than 1.
      -->
    <max_server_memory_usage_to_ram_ratio>0.9</max_server_memory_usage_to_ram_ratio>

    <!-- Simple server-wide memory profiler. Collect a stack trace at every peak allocation step (in bytes).
         Data will be stored in system.trace_log table with query_id = empty string.
         Zero means disabled.
      -->
    <total_memory_profiler_step>4194304</total_memory_profiler_step>

    <!-- Collect random allocations and deallocations and write them into system.trace_log with 'MemorySample' trace_type.
         The probability is for every alloc/free regardless to the size of the allocation.
         Note that sampling happens only when the amount of untracked memory exceeds the untracked memory limit,
          which is 4 MiB by default but can be lowered if 'total_memory_profiler_step' is lowered.
         You may want to set 'total_memory_profiler_step' to 1 for extra fine grained sampling.
      -->
    <total_memory_tracker_sample_probability>0</total_memory_tracker_sample_probability>

    <!-- Set limit on number of open files (default: maximum). This setting makes sense on Mac OS X because getrlimit() fails to retrieve
         correct maximum value. -->
    <!-- <max_open_files>262144</max_open_files> -->

    <!-- Size of cache of uncompressed blocks of data, used in tables of MergeTree family.
         In bytes. Cache is single for server. Memory is allocated only on demand.
         Cache is used when 'use_uncompressed_cache' user setting turned on (off by default).
         Uncompressed cache is advantageous only for very short queries and in rare cases.

         Note: uncompressed cache can be pointless for lz4, because memory bandwidth
         is slower than multi-core decompression on some server configurations.
         Enabling it can sometimes paradoxically make queries slower.
      -->
    <uncompressed_cache_size>8589934592</uncompressed_cache_size>

    <!-- Approximate size of mark cache, used in tables of MergeTree family.
         In bytes. Cache is single for server. Memory is allocated only on demand.
         You should not lower this value.
      -->
    <mark_cache_size>5368709120</mark_cache_size>


    <!-- If you enable the `min_bytes_to_use_mmap_io` setting,
         the data in MergeTree tables can be read with mmap to avoid copying from kernel to userspace.
         It makes sense only for large files and helps only if data reside in page cache.
         To avoid frequent open/mmap/munmap/close calls (which are very expensive due to consequent page faults)
         and to reuse mappings from several threads and queries,
         the cache of mapped files is maintained. Its size is the number of mapped regions (usually equal to the number of mapped files).
         The amount of data in mapped files can be monitored
         in system.metrics, system.metric_log by the MMappedFiles, MMappedFileBytes metrics
         and in system.asynchronous_metrics, system.asynchronous_metrics_log by the MMapCacheCells metric,
         and also in system.events, system.processes, system.query_log, system.query_thread_log, system.query_views_log by the
         CreatedReadBufferMMap, CreatedReadBufferMMapFailed, MMappedFileCacheHits, MMappedFileCacheMisses events.
         Note that the amount of data in mapped files does not consume memory directly and is not accounted
         in query or server memory usage - because this memory can be discarded similar to OS page cache.
         The cache is dropped (the files are closed) automatically on removal of old parts in MergeTree,
         also it can be dropped manually by the SYSTEM DROP MMAP CACHE query.
      -->
    <mmap_cache_size>1000</mmap_cache_size>

    <!-- Cache size in bytes for compiled expressions.-->
    <compiled_expression_cache_size>134217728</compiled_expression_cache_size>

    <!-- Cache size in elements for compiled expressions.-->
    <compiled_expression_cache_elements_size>10000</compiled_expression_cache_elements_size>

    <!-- Path to data directory, with trailing slash. -->
    <path>/var/lib/clickhouse/</path>

    <!-- Path to temporary data for processing hard queries. -->
    <tmp_path>/var/lib/clickhouse/tmp/</tmp_path>

    <!-- Policy from the <storage_configuration> for the temporary files.
         If not set <tmp_path> is used, otherwise <tmp_path> is ignored.

         Notes:
         - move_factor              is ignored
         - keep_free_space_bytes    is ignored
         - max_data_part_size_bytes is ignored
         - you must have exactly one volume in that policy
    -->
    <!-- <tmp_policy>tmp</tmp_policy> -->

    <!-- Directory with user provided files that are accessible by 'file' table function. -->
    <user_files_path>/var/lib/clickhouse/user_files/</user_files_path>

    <!-- LDAP server definitions. -->
    <ldap_servers>
        <!-- List LDAP servers with their connection parameters here to later 1) use them as authenticators for dedicated local users,
              who have 'ldap' authentication mechanism specified instead of 'password', or to 2) use them as remote user directories.
             Parameters:
                host - LDAP server hostname or IP, this parameter is mandatory and cannot be empty.
                port - LDAP server port, default is 636 if enable_tls is set to true, 389 otherwise.
                bind_dn - template used to construct the DN to bind to.
                        The resulting DN will be constructed by replacing all '{user_name}' substrings of the template with the actual
                         user name during each authentication attempt.
                user_dn_detection - section with LDAP search parameters for detecting the actual user DN of the bound user.
                        This is mainly used in search filters for further role mapping when the server is Active Directory. The
                         resulting user DN will be used when replacing '{user_dn}' substrings wherever they are allowed. By default,
                         user DN is set equal to bind DN, but once search is performed, it will be updated with to the actual detected
                         user DN value.
                    base_dn - template used to construct the base DN for the LDAP search.
                            The resulting DN will be constructed by replacing all '{user_name}' and '{bind_dn}' substrings
                             of the template with the actual user name and bind DN during the LDAP search.
                    scope - scope of the LDAP search.
                            Accepted values are: 'base', 'one_level', 'children', 'subtree' (the default).
                    search_filter - template used to construct the search filter for the LDAP search.
                            The resulting filter will be constructed by replacing all '{user_name}', '{bind_dn}', and '{base_dn}'
                             substrings of the template with the actual user name, bind DN, and base DN during the LDAP search.
                            Note, that the special characters must be escaped properly in XML.
                verification_cooldown - a period of time, in seconds, after a successful bind attempt, during which a user will be assumed
                         to be successfully authenticated for all consecutive requests without contacting the LDAP server.
                        Specify 0 (the default) to disable caching and force contacting the LDAP server for each authentication request.
                enable_tls - flag to trigger use of secure connection to the LDAP server.
                        Specify 'no' for plain text (ldap://) protocol (not recommended).
                        Specify 'yes' for LDAP over SSL/TLS (ldaps://) protocol (recommended, the default).
                        Specify 'starttls' for legacy StartTLS protocol (plain text (ldap://) protocol, upgraded to TLS).
                tls_minimum_protocol_version - the minimum protocol version of SSL/TLS.
                        Accepted values are: 'ssl2', 'ssl3', 'tls1.0', 'tls1.1', 'tls1.2' (the default).
                tls_require_cert - SSL/TLS peer certificate verification behavior.
                        Accepted values are: 'never', 'allow', 'try', 'demand' (the default).
                tls_cert_file - path to certificate file.
                tls_key_file - path to certificate key file.
                tls_ca_cert_file - path to CA certificate file.
                tls_ca_cert_dir - path to the directory containing CA certificates.
                tls_cipher_suite - allowed cipher suite (in OpenSSL notation).
             Example:
                <my_ldap_server>
                    <host>localhost</host>
                    <port>636</port>
                    <bind_dn>uid={user_name},ou=users,dc=example,dc=com</bind_dn>
                    <verification_cooldown>300</verification_cooldown>
                    <enable_tls>yes</enable_tls>
                    <tls_minimum_protocol_version>tls1.2</tls_minimum_protocol_version>
                    <tls_require_cert>demand</tls_require_cert>
                    <tls_cert_file>/path/to/tls_cert_file</tls_cert_file>
                    <tls_key_file>/path/to/tls_key_file</tls_key_file>
                    <tls_ca_cert_file>/path/to/tls_ca_cert_file</tls_ca_cert_file>
                    <tls_ca_cert_dir>/path/to/tls_ca_cert_dir</tls_ca_cert_dir>
                    <tls_cipher_suite>ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:AES256-GCM-SHA384</tls_cipher_suite>
                </my_ldap_server>
             Example (typical Active Directory with configured user DN detection for further role mapping):
                <my_ad_server>
                    <host>localhost</host>
                    <port>389</port>
                    <bind_dn>EXAMPLE\{user_name}</bind_dn>
                    <user_dn_detection>
                        <base_dn>CN=Users,DC=example,DC=com</base_dn>
                        <search_filter>(&amp;amp;(objectClass=user)(sAMAccountName={user_name}))</search_filter>
                    </user_dn_detection>
                    <enable_tls>no</enable_tls>
                </my_ad_server>
        -->
    </ldap_servers>

    <!-- To enable Kerberos authentication support for HTTP requests (GSS-SPNEGO), for those users who are explicitly configured
          to authenticate via Kerberos, define a single 'kerberos' section here.
         Parameters:
            principal - canonical service principal name, that will be acquired and used when accepting security contexts.
                    This parameter is optional, if omitted, the default principal will be used.
                    This parameter cannot be specified together with 'realm' parameter.
            realm - a realm, that will be used to restrict authentication to only those requests whose initiator's realm matches it.
                    This parameter is optional, if omitted, no additional filtering by realm will be applied.
                    This parameter cannot be specified together with 'principal' parameter.
         Example:
            <kerberos />
         Example:
            <kerberos>
                <principal>HTTP/clickhouse.example.com@EXAMPLE.COM</principal>
            </kerberos>
         Example:
            <kerberos>
                <realm>EXAMPLE.COM</realm>
            </kerberos>
    -->

    <!-- Sources to read users, roles, access rights, profiles of settings, quotas. -->
    <user_directories>
        <users_xml>
            <!-- Path to configuration file with predefined users. -->
            <path>users.xml</path>
        </users_xml>
        <local_directory>
            <!-- Path to folder where users created by SQL commands are stored. -->
            <path>/var/lib/clickhouse/access/</path>
        </local_directory>

        <!-- To add an LDAP server as a remote user directory of users that are not defined locally, define a single 'ldap' section
              with the following parameters:
                server - one of LDAP server names defined in 'ldap_servers' config section above.
                        This parameter is mandatory and cannot be empty.
                roles - section with a list of locally defined roles that will be assigned to each user retrieved from the LDAP server.
                        If no roles are specified here or assigned during role mapping (below), user will not be able to perform any
                         actions after authentication.
                role_mapping - section with LDAP search parameters and mapping rules.
                        When a user authenticates, while still bound to LDAP, an LDAP search is performed using search_filter and the
                         name of the logged in user. For each entry found during that search, the value of the specified attribute is
                         extracted. For each attribute value that has the specified prefix, the prefix is removed, and the rest of the
                         value becomes the name of a local role defined in ClickHouse, which is expected to be created beforehand by
                         CREATE ROLE command.
                        There can be multiple 'role_mapping' sections defined inside the same 'ldap' section. All of them will be
                         applied.
                    base_dn - template used to construct the base DN for the LDAP search.
                            The resulting DN will be constructed by replacing all '{user_name}', '{bind_dn}', and '{user_dn}'
                             substrings of the template with the actual user name, bind DN, and user DN during each LDAP search.
                    scope - scope of the LDAP search.
                            Accepted values are: 'base', 'one_level', 'children', 'subtree' (the default).
                    search_filter - template used to construct the search filter for the LDAP search.
                            The resulting filter will be constructed by replacing all '{user_name}', '{bind_dn}', '{user_dn}', and
                             '{base_dn}' substrings of the template with the actual user name, bind DN, user DN, and base DN during
                             each LDAP search.
                            Note, that the special characters must be escaped properly in XML.
                    attribute - attribute name whose values will be returned by the LDAP search. 'cn', by default.
                    prefix - prefix, that will be expected to be in front of each string in the original list of strings returned by
                             the LDAP search. Prefix will be removed from the original strings and resulting strings will be treated
                             as local role names. Empty, by default.
             Example:
                <ldap>
                    <server>my_ldap_server</server>
                    <roles>
                        <my_local_role1 />
                        <my_local_role2 />
                    </roles>
                    <role_mapping>
                        <base_dn>ou=groups,dc=example,dc=com</base_dn>
                        <scope>subtree</scope>
                        <search_filter>(&amp;amp;(objectClass=groupOfNames)(member={bind_dn}))</search_filter>
                        <attribute>cn</attribute>
                        <prefix>clickhouse_</prefix>
                    </role_mapping>
                </ldap>
             Example (typical Active Directory with role mapping that relies on the detected user DN):
                <ldap>
                    <server>my_ad_server</server>
                    <role_mapping>
                        <base_dn>CN=Users,DC=example,DC=com</base_dn>
                        <attribute>CN</attribute>
                        <scope>subtree</scope>
                        <search_filter>(&amp;amp;(objectClass=group)(member={user_dn}))</search_filter>
                        <prefix>clickhouse_</prefix>
                    </role_mapping>
                </ldap>
        -->
    </user_directories>

    <!-- Default profile of settings. -->
    <default_profile>default</default_profile>

    <!-- Comma-separated list of prefixes for user-defined settings. -->
    <custom_settings_prefixes></custom_settings_prefixes>

    <!-- System profile of settings. This settings are used by internal processes (Distributed DDL worker and so on). -->
    <!-- <system_profile>default</system_profile> -->

    <!-- Buffer profile of settings.
         This settings are used by Buffer storage to flush data to the underlying table.
         Default: used from system_profile directive.
    -->
    <!-- <buffer_profile>default</buffer_profile> -->

    <!-- Default database. -->
    <default_database>default</default_database>

    <!-- Server time zone could be set here.

         Time zone is used when converting between String and DateTime types,
          when printing DateTime in text formats and parsing DateTime from text,
          it is used in date and time related functions, if specific time zone was not passed as an argument.

         Time zone is specified as identifier from IANA time zone database, like UTC or Africa/Abidjan.
         If not specified, system time zone at server startup is used.

         Please note, that server could display time zone alias instead of specified name.
         Example: W-SU is an alias for Europe/Moscow and Zulu is an alias for UTC.
    -->
    <!-- <timezone>Europe/Moscow</timezone> -->

    <!-- You can specify umask here (see &#34;man umask&#34;). Server will apply it on startup.
         Number is always parsed as octal. Default umask is 027 (other users cannot read logs, data files, etc; group can only read).
    -->
    <!-- <umask>022</umask> -->

    <!-- Perform mlockall after startup to lower first queries latency
          and to prevent clickhouse executable from being paged out under high IO load.
         Enabling this option is recommended but will lead to increased startup time for up to a few seconds.
    -->
    <mlock_executable>true</mlock_executable>

    <!-- Reallocate memory for machine code (&#34;text&#34;) using huge pages. Highly experimental. -->
    <remap_executable>false</remap_executable>

    <![CDATA[
         Uncomment below in order to use JDBC table engine and function.

         To install and run JDBC bridge in background:
         * [Debian/Ubuntu]
           export MVN_URL=https://repo1.maven.org/maven2/ru/yandex/clickhouse/clickhouse-jdbc-bridge
           export PKG_VER=$(curl -sL $MVN_URL/maven-metadata.xml | grep '<release>' | sed -e 's|.*>\(.*\)<.*|\1|')
           wget https://github.com/ClickHouse/clickhouse-jdbc-bridge/releases/download/v$PKG_VER/clickhouse-jdbc-bridge_$PKG_VER-1_all.deb
           apt install --no-install-recommends -f ./clickhouse-jdbc-bridge_$PKG_VER-1_all.deb
           clickhouse-jdbc-bridge &

         * [CentOS/RHEL]
           export MVN_URL=https://repo1.maven.org/maven2/ru/yandex/clickhouse/clickhouse-jdbc-bridge
           export PKG_VER=$(curl -sL $MVN_URL/maven-metadata.xml | grep '<release>' | sed -e 's|.*>\(.*\)<.*|\1|')
           wget https://github.com/ClickHouse/clickhouse-jdbc-bridge/releases/download/v$PKG_VER/clickhouse-jdbc-bridge-$PKG_VER-1.noarch.rpm
           yum localinstall -y clickhouse-jdbc-bridge-$PKG_VER-1.noarch.rpm
           clickhouse-jdbc-bridge &

         Please refer to https://github.com/ClickHouse/clickhouse-jdbc-bridge#usage for more information.
    ]]>
    <!--
    <jdbc_bridge>
        <host>127.0.0.1</host>
        <port>9019</port>
    </jdbc_bridge>
    -->

    <!-- Configuration of clusters that could be used in Distributed tables.
         https://clickhouse.com/docs/en/operations/table_engines/distributed/
      -->
    <remote_servers>
        <default_cluster>
            <shard>
                <weight>1</weight>
                <internal_replication>false</internal_replication>
                <replica>
                    <host>ck1</host>
                    <port>9000</port>
                </replica>
            </shard>
            <shard>
                <weight>1</weight>
                <internal_replication>false</internal_replication>
                <replica>
                    <host>ck2</host>
                    <port>9000</port>
                </replica>
            </shard>
            <shard>
                <weight>1</weight>
                <internal_replication>false</internal_replication>
                <replica>
                    <host>ck3</host>
                    <port>9000</port>
                </replica>
            </shard>
        </default_cluster>
    </remote_servers>

    <macros>
        <replica>ck1</replica>
        <shard>01</shard>
        <layer>01</layer>
    </macros>


    <!-- The list of hosts allowed to use in URL-related storage engines and table functions.
        If this section is not present in configuration, all hosts are allowed.
    -->
    <!--<remote_url_allow_hosts>-->
    <!-- Host should be specified exactly as in URL. The name is checked before DNS resolution.
        Example: &#34;yandex.ru&#34;, &#34;yandex.ru.&#34; and &#34;www.yandex.ru&#34; are different hosts.
                If port is explicitly specified in URL, the host:port is checked as a whole.
                If host specified here without port, any port with this host allowed.
                &#34;yandex.ru&#34; -> &#34;yandex.ru:443&#34;, &#34;yandex.ru:80&#34; etc. is allowed, but &#34;yandex.ru:80&#34; -> only &#34;yandex.ru:80&#34; is allowed.
        If the host is specified as IP address, it is checked as specified in URL. Example: &#34;[2a02:6b8:a::a]&#34;.
        If there are redirects and support for redirects is enabled, every redirect (the Location field) is checked.
        Host should be specified using the host xml tag:
                <host>yandex.ru</host>
    -->

    <!-- Regular expression can be specified. RE2 engine is used for regexps.
        Regexps are not aligned: don't forget to add ^ and $. Also don't forget to escape dot (.) metacharacter
        (forgetting to do so is a common source of error).
    -->
    <!--</remote_url_allow_hosts>-->

    <!-- If element has 'incl' attribute, then for it's value will be used corresponding substitution from another file.
         By default, path to file with substitutions is /etc/metrika.xml. It could be changed in config in 'include_from' element.
         Values for substitutions are specified in /clickhouse/name_of_substitution elements in that file.
      -->

    <!-- ZooKeeper is used to store metadata about replicas, when using Replicated tables.
         Optional. If you don't use replicated tables, you could omit that.

         See https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replication/
      -->

    <zookeeper>
        <node>
            <host>zookeeper1</host>
            <port>2181</port>
        </node>
    </zookeeper>

    <!-- Substitutions for parameters of replicated tables.
          Optional. If you don't use replicated tables, you could omit that.

         See https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replication/#creating-replicated-tables
      -->
    <!--
    <macros>
        <shard>01</shard>
        <replica>example01-01-1</replica>
    </macros>
    -->


    <!-- Reloading interval for embedded dictionaries, in seconds. Default: 3600. -->
    <builtin_dictionaries_reload_interval>3600</builtin_dictionaries_reload_interval>


    <!-- Maximum session timeout, in seconds. Default: 3600. -->
    <max_session_timeout>3600</max_session_timeout>

    <!-- Default session timeout, in seconds. Default: 60. -->
    <default_session_timeout>60</default_session_timeout>

    <!-- Sending data to Graphite for monitoring. Several sections can be defined. -->
    <!--
        interval - send every X second
        root_path - prefix for keys
        hostname_in_path - append hostname to root_path (default = true)
        metrics - send data from table system.metrics
        events - send data from table system.events
        asynchronous_metrics - send data from table system.asynchronous_metrics
    -->
    <!--
    <graphite>
        <host>localhost</host>
        <port>42000</port>
        <timeout>0.1</timeout>
        <interval>60</interval>
        <root_path>one_min</root_path>
        <hostname_in_path>true</hostname_in_path>

        <metrics>true</metrics>
        <events>true</events>
        <events_cumulative>false</events_cumulative>
        <asynchronous_metrics>true</asynchronous_metrics>
    </graphite>
    <graphite>
        <host>localhost</host>
        <port>42000</port>
        <timeout>0.1</timeout>
        <interval>1</interval>
        <root_path>one_sec</root_path>

        <metrics>true</metrics>
        <events>true</events>
        <events_cumulative>false</events_cumulative>
        <asynchronous_metrics>false</asynchronous_metrics>
    </graphite>
    -->

    <!-- Serve endpoint for Prometheus monitoring. -->
    <!--
        endpoint - mertics path (relative to root, statring with &#34;/&#34;)
        port - port to setup server. If not defined or 0 than http_port used
        metrics - send data from table system.metrics
        events - send data from table system.events
        asynchronous_metrics - send data from table system.asynchronous_metrics
        status_info - send data from different component from CH, ex: Dictionaries status
    -->
    <!--
    <prometheus>
        <endpoint>/metrics</endpoint>
        <port>9363</port>

        <metrics>true</metrics>
        <events>true</events>
        <asynchronous_metrics>true</asynchronous_metrics>
        <status_info>true</status_info>
    </prometheus>
    -->

    <!-- Query log. Used only for queries with setting log_queries = 1. -->
    <query_log>
        <!-- What table to insert data. If table is not exist, it will be created.
             When query log structure is changed after system update,
              then old table will be renamed and new table will be created automatically.
        -->
        <database>system</database>
        <table>query_log</table>
        <!--
            PARTITION BY expr: https://clickhouse.com/docs/en/table_engines/mergetree-family/custom_partitioning_key/
            Example:
                event_date
                toMonday(event_date)
                toYYYYMM(event_date)
                toStartOfHour(event_time)
        -->
        <partition_by>toYYYYMM(event_date)</partition_by>
        <!--
            Table TTL specification: https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree/#mergetree-table-ttl
            Example:
                event_date + INTERVAL 1 WEEK
                event_date + INTERVAL 7 DAY DELETE
                event_date + INTERVAL 2 WEEK TO DISK 'bbb'

        <ttl>event_date + INTERVAL 30 DAY DELETE</ttl>
        -->

        <!-- Instead of partition_by, you can provide full engine expression (starting with ENGINE = ) with parameters,
             Example: <engine>ENGINE = MergeTree PARTITION BY toYYYYMM(event_date) ORDER BY (event_date, event_time) SETTINGS index_granularity = 1024</engine>
          -->

        <!-- Interval of flushing data. -->
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </query_log>

    <!-- Trace log. Stores stack traces collected by query profilers.
         See query_profiler_real_time_period_ns and query_profiler_cpu_time_period_ns settings. -->
    <trace_log>
        <database>system</database>
        <table>trace_log</table>

        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </trace_log>

    <!-- Query thread log. Has information about all threads participated in query execution.
         Used only for queries with setting log_query_threads = 1. -->
    <query_thread_log>
        <database>system</database>
        <table>query_thread_log</table>
        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </query_thread_log>

    <!-- Query views log. Has information about all dependent views associated with a query.
         Used only for queries with setting log_query_views = 1. -->
    <query_views_log>
        <database>system</database>
        <table>query_views_log</table>
        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </query_views_log>

    <!-- Uncomment if use part log.
         Part log contains information about all actions with parts in MergeTree tables (creation, deletion, merges, downloads).-->
    <part_log>
        <database>system</database>
        <table>part_log</table>
        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </part_log>

    <!-- Uncomment to write text log into table.
         Text log contains all information from usual server log but stores it in structured and efficient way.
         The level of the messages that goes to the table can be limited (<level>), if not specified all messages will go to the table.
    <text_log>
        <database>system</database>
        <table>text_log</table>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
        <level></level>
    </text_log>
    -->

    <!-- Metric log contains rows with current values of ProfileEvents, CurrentMetrics collected with &#34;collect_interval_milliseconds&#34; interval. -->
    <metric_log>
        <database>system</database>
        <table>metric_log</table>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
        <collect_interval_milliseconds>1000</collect_interval_milliseconds>
    </metric_log>

    <!--
        Asynchronous metric log contains values of metrics from
        system.asynchronous_metrics.
    -->
    <asynchronous_metric_log>
        <database>system</database>
        <table>asynchronous_metric_log</table>
        <!--
            Asynchronous metrics are updated once a minute, so there is
            no need to flush more often.
        -->
        <flush_interval_milliseconds>7000</flush_interval_milliseconds>
    </asynchronous_metric_log>

    <!--
        OpenTelemetry log contains OpenTelemetry trace spans.
    -->
    <opentelemetry_span_log>
        <!--
            The default table creation code is insufficient, this <engine> spec
            is a workaround. There is no 'event_time' for this log, but two times,
            start and finish. It is sorted by finish time, to avoid inserting
            data too far away in the past (probably we can sometimes insert a span
            that is seconds earlier than the last span in the table, due to a race
            between several spans inserted in parallel). This gives the spans a
            global order that we can use to e.g. retry insertion into some external
            system.
        -->
        <engine>
            engine MergeTree
            partition by toYYYYMM(finish_date)
            order by (finish_date, finish_time_us, trace_id)
        </engine>
        <database>system</database>
        <table>opentelemetry_span_log</table>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </opentelemetry_span_log>


    <!-- Crash log. Stores stack traces for fatal errors.
         This table is normally empty. -->
    <crash_log>
        <database>system</database>
        <table>crash_log</table>

        <partition_by/>
        <flush_interval_milliseconds>1000</flush_interval_milliseconds>
    </crash_log>

    <!-- Session log. Stores user log in (successful or not) and log out events. -->
    <session_log>
        <database>system</database>
        <table>session_log</table>

        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </session_log>

    <!-- Parameters for embedded dictionaries, used in Yandex.Metrica.
         See https://clickhouse.com/docs/en/dicts/internal_dicts/
    -->

    <!-- Path to file with region hierarchy. -->
    <!-- <path_to_regions_hierarchy_file>/opt/geo/regions_hierarchy.txt</path_to_regions_hierarchy_file> -->

    <!-- Path to directory with files containing names of regions -->
    <!-- <path_to_regions_names_files>/opt/geo/</path_to_regions_names_files> -->


    <!-- <top_level_domains_path>/var/lib/clickhouse/top_level_domains/</top_level_domains_path> -->
    <!-- Custom TLD lists.
         Format: <name>/path/to/file</name>

         Changes will not be applied w/o server restart.
         Path to the list is under top_level_domains_path (see above).
    -->
    <top_level_domains_lists>
        <!--
        <public_suffix_list>/path/to/public_suffix_list.dat</public_suffix_list>
        -->
    </top_level_domains_lists>

    <!-- Configuration of external dictionaries. See:
         https://clickhouse.com/docs/en/sql-reference/dictionaries/external-dictionaries/external-dicts
    -->
    <dictionaries_config>*_dictionary.xml</dictionaries_config>

    <!-- Configuration of user defined executable functions -->
    <user_defined_executable_functions_config>*_function.xml</user_defined_executable_functions_config>

    <!-- Uncomment if you want data to be compressed 30-100% better.
         Don't do that if you just started using ClickHouse.
      -->
    <!--
    <compression>
        <!- - Set of variants. Checked in order. Last matching case wins. If nothing matches, lz4 will be used. - ->
        <case>

            <!- - Conditions. All must be satisfied. Some conditions may be omitted. - ->
            <min_part_size>10000000000</min_part_size>        <!- - Min part size in bytes. - ->
            <min_part_size_ratio>0.01</min_part_size_ratio>   <!- - Min size of part relative to whole table size. - ->

            <!- - What compression method to use. - ->
            <method>zstd</method>
        </case>
    </compression>
    -->

    <!-- Configuration of encryption. The server executes a command to
         obtain an encryption key at startup if such a command is
         defined, or encryption codecs will be disabled otherwise. The
         command is executed through /bin/sh and is expected to write
         a Base64-encoded key to the stdout. -->
    <encryption_codecs>
        <!-- aes_128_gcm_siv -->
        <!-- Example of getting hex key from env -->
        <!-- the code should use this key and throw an exception if its length is not 16 bytes -->
        <!--key_hex from_env=&#34;...&#34;></key_hex -->

        <!-- Example of multiple hex keys. They can be imported from env or be written down in config-->
        <!-- the code should use these keys and throw an exception if their length is not 16 bytes -->
        <!-- key_hex id=&#34;0&#34;>...</key_hex -->
        <!-- key_hex id=&#34;1&#34; from_env=&#34;..&#34;></key_hex -->
        <!-- key_hex id=&#34;2&#34;>...</key_hex -->
        <!-- current_key_id>2</current_key_id -->

        <!-- Example of getting hex key from config -->
        <!-- the code should use this key and throw an exception if its length is not 16 bytes -->
        <!-- key>...</key -->

        <!-- example of adding nonce -->
        <!-- nonce>...</nonce -->

        <!-- /aes_128_gcm_siv -->
    </encryption_codecs>

    <!-- Allow to execute distributed DDL queries (CREATE, DROP, ALTER, RENAME) on cluster.
         Works only if ZooKeeper is enabled. Comment it if such functionality isn't required. -->
    <distributed_ddl>
        <!-- Path in ZooKeeper to queue with DDL queries -->
        <path>/clickhouse/task_queue/ddl</path>

        <!-- Settings from this profile will be used to execute DDL queries -->
        <!-- <profile>default</profile> -->

        <!-- Controls how much ON CLUSTER queries can be run simultaneously. -->
        <!-- <pool_size>1</pool_size> -->

        <!--
             Cleanup settings (active tasks will not be removed)
        -->

        <!-- Controls task TTL (default 1 week) -->
        <!-- <task_max_lifetime>604800</task_max_lifetime> -->

        <!-- Controls how often cleanup should be performed (in seconds) -->
        <!-- <cleanup_delay_period>60</cleanup_delay_period> -->

        <!-- Controls how many tasks could be in the queue -->
        <!-- <max_tasks_in_queue>1000</max_tasks_in_queue> -->
    </distributed_ddl>

    <!-- Settings to fine tune MergeTree tables. See documentation in source code, in MergeTreeSettings.h -->
    <!--
    <merge_tree>
        <max_suspicious_broken_parts>5</max_suspicious_broken_parts>
    </merge_tree>
    -->

    <!-- Protection from accidental DROP.
         If size of a MergeTree table is greater than max_table_size_to_drop (in bytes) than table could not be dropped with any DROP query.
         If you want do delete one table and don't want to change clickhouse-server config, you could create special file <clickhouse-path>/flags/force_drop_table and make DROP once.
         By default max_table_size_to_drop is 50GB; max_table_size_to_drop=0 allows to DROP any tables.
         The same for max_partition_size_to_drop.
         Uncomment to disable protection.
    -->
    <!-- <max_table_size_to_drop>0</max_table_size_to_drop> -->
    <!-- <max_partition_size_to_drop>0</max_partition_size_to_drop> -->

    <!-- Example of parameters for GraphiteMergeTree table engine -->
    <graphite_rollup_example>
        <pattern>
            <regexp>click_cost</regexp>
            <function>any</function>
            <retention>
                <age>0</age>
                <precision>3600</precision>
            </retention>
            <retention>
                <age>86400</age>
                <precision>60</precision>
            </retention>
        </pattern>
        <default>
            <function>max</function>
            <retention>
                <age>0</age>
                <precision>60</precision>
            </retention>
            <retention>
                <age>3600</age>
                <precision>300</precision>
            </retention>
            <retention>
                <age>86400</age>
                <precision>3600</precision>
            </retention>
        </default>
    </graphite_rollup_example>

    <!-- Directory in <clickhouse-path> containing schema files for various input formats.
         The directory will be created if it doesn't exist.
      -->
    <format_schema_path>/var/lib/clickhouse/format_schemas/</format_schema_path>

    <!-- Default query masking rules, matching lines would be replaced with something else in the logs
        (both text logs and system.query_log).
        name - name for the rule (optional)
        regexp - RE2 compatible regular expression (mandatory)
        replace - substitution string for sensitive data (optional, by default - six asterisks)
    -->
    <query_masking_rules>
        <rule>
            <name>hide encrypt/decrypt arguments</name>
            <regexp>((?:aes_)?(?:encrypt|decrypt)(?:_mysql)?)\s*\(\s*(?:'(?:\\'|.)+'|.*?)\s*\)</regexp>
            <!-- or more secure, but also more invasive:
                (aes_\w+)\s*\(.*\)
            -->
            <replace>\1(???)</replace>
        </rule>
    </query_masking_rules>

    <!-- Uncomment to use custom http handlers.
        rules are checked from top to bottom, first match runs the handler
            url - to match request URL, you can use 'regex:' prefix to use regex match(optional)
            methods - to match request method, you can use commas to separate multiple method matches(optional)
            headers - to match request headers, match each child element(child element name is header name), you can use 'regex:' prefix to use regex match(optional)
        handler is request handler
            type - supported types: static, dynamic_query_handler, predefined_query_handler
            query - use with predefined_query_handler type, executes query when the handler is called
            query_param_name - use with dynamic_query_handler type, extracts and executes the value corresponding to the <query_param_name> value in HTTP request params
            status - use with static type, response status code
            content_type - use with static type, response content-type
            response_content - use with static type, Response content sent to client, when using the prefix 'file://' or 'config://', find the content from the file or configuration send to client.

    <http_handlers>
        <rule>
            <url>/</url>
            <methods>POST,GET</methods>
            <headers><pragma>no-cache</pragma></headers>
            <handler>
                <type>dynamic_query_handler</type>
                <query_param_name>query</query_param_name>
            </handler>
        </rule>

        <rule>
            <url>/predefined_query</url>
            <methods>POST,GET</methods>
            <handler>
                <type>predefined_query_handler</type>
                <query>SELECT * FROM system.settings</query>
            </handler>
        </rule>

        <rule>
            <handler>
                <type>static</type>
                <status>200</status>
                <content_type>text/plain; charset=UTF-8</content_type>
                <response_content>config://http_server_default_response</response_content>
            </handler>
        </rule>
    </http_handlers>
    -->

    <send_crash_reports>
        <!-- Changing <enabled> to true allows sending crash reports to -->
        <!-- the ClickHouse core developers team via Sentry https://sentry.io -->
        <!-- Doing so at least in pre-production environments is highly appreciated -->
        <enabled>false</enabled>
        <!-- Change <anonymize> to true if you don't feel comfortable attaching the server hostname to the crash report -->
        <anonymize>false</anonymize>
        <!-- Default endpoint s hould be changed to different Sentry DSN only if you have -->
        <!-- some in-house engineers or hired consultants who're going to debug ClickHouse issues for you -->
        <endpoint></endpoint>
    </send_crash_reports>

    <!-- Uncomment to disable ClickHouse internal DNS caching. -->
    <!-- <disable_internal_dns_cache>1</disable_internal_dns_cache> -->

    <!-- You can also configure rocksdb like this: -->
    <!--
    <rocksdb>
        <options>
            <max_background_jobs>8</max_background_jobs>
        </options>
        <column_family_options>
            <num_levels>2</num_levels>
        </column_family_options>
        <tables>
            <table>
                <name>TABLE</name>
                <options>
                    <max_background_jobs>8</max_background_jobs>
                </options>
                <column_family_options>
                    <num_levels>2</num_levels>
                </column_family_options>
            </table>
        </tables>
    </rocksdb>
    -->
    <timezone>Asia/Shanghai</timezone>
</clickhouse>
启动命令
docker-compose up -d
TODO
现在配置的 zookeeper 还是单机部署的，有空看看部署个zookeeper集群怎么配置"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.lvcshu.com/posts/"},{"@type":"ListItem","position":2,"name":"使用 docker-compose 搭建 clickhouse 集群","item":"https://blog.lvcshu.com/2022/08/12/deploy-clickhouse-by-docker-compose/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"使用 docker-compose 搭建 clickhouse 集群","name":"使用 docker-compose 搭建 clickhouse 集群","description":"Docker Compose 配置 version: \u0026#39;3\u0026#39; services: clickhouse-server-ck1: restart: on-failure:10 # 退出非0重启，尝试10次 image: yandex/clickhouse-server container_name: ck1 networks: - ck-network ports: - \u0026#34;8124:8123\u0026#34; - \u0026#34;9001:9000\u0026#34; - \u0026#34;9010:9004\u0026#34; volumes: - `pwd`/clickhouse/:/var/lib/clickhouse/ - `pwd`/clickhouse-server/:/etc/clickhouse-server/ - `pwd`/log/clickhouse-server/:/var/log/clickhouse-server/ ulimits: nofile: soft: \u0026#34;262144\u0026#34; hard: \u0026#34;262144\u0026#34; depends_on: - zookeeper-1 clickhouse-server-ck2: restart: on-failure:10 # 退出非0重启，尝试10次 image: yandex/clickhouse-server container_name: ck2 networks: - ck-network ports: - \u0026#34;8125:8123\u0026#34; - \u0026#34;9002:9000\u0026#34; - \u0026#34;9011:9004\u0026#34; volumes: - `pwd`/clickhouse2/:/var/lib/clickhouse/ - `pwd`/clickhouse-server2/:/etc/clickhouse-server/ - `pwd`/log/clickhouse-server2/:/var/log/clickhouse-server/ ulimits: nofile: soft: \u0026#34;262144\u0026#34; hard: \u0026#34;262144\u0026#34; depends_on: - zookeeper-1 clickhouse-server-ck3: restart: on-failure:10 # 退出非0重启，尝试10次 image: yandex/clickhouse-server container_name: ck3 networks: - ck-network ports: - \u0026#34;8126:8123\u0026#34; - \u0026#34;9003:9000\u0026#34; - \u0026#34;9012:9004\u0026#34; volumes: - `pwd`/clickhouse3/:/var/lib/clickhouse/ - `pwd`/clickhouse-server3/:/etc/clickhouse-server/ - `pwd`/log/clickhouse-server3/:/var/log/clickhouse-server/ ulimits: nofile: soft: \u0026#34;262144\u0026#34; hard: \u0026#34;262144\u0026#34; depends_on: - zookeeper-1 zookeeper-1: restart: on-failure:10 # 退出非0重启，尝试10次 image: zookeeper:3.8.0 container_name: zookeeper1 networks: - ck-network ports: - \u0026#34;2181:2181\u0026#34; volumes: - `pwd`/zookeeper/conf/:/apache-zookeeper-3.8.0-bin/conf/ - `pwd`/zookeeper/data/:/data - `pwd`/zookeeper/datalog/:/datalog - `pwd`/zookeeper/logs/:/logs ulimits: nofile: soft: \u0026#34;262144\u0026#34; hard: \u0026#34;262144\u0026#34; networks: ck-network: Clickhouse 配置文件 \u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt; \u0026lt;!-- NOTE: User and query level settings are set up in \u0026#34;users.xml\u0026#34; file. If you have accidentally specified user-level settings here, server won\u0026#39;t start. You can either move the settings to the right place inside \u0026#34;users.xml\u0026#34; file or add \u0026lt;skip_check_for_incorrect_settings\u0026gt;1\u0026lt;/skip_check_for_incorrect_settings\u0026gt; here. --\u0026gt; \u0026lt;clickhouse\u0026gt; \u0026lt;logger\u0026gt; \u0026lt;!-- Possible levels [1]: - none (turns off logging) - fatal - critical - error - warning - notice - information - debug - trace - test (not for production usage) [1]: https://github.com/pocoproject/poco/blob/poco-1.9.4-release/Foundation/include/Poco/Logger.h#L105-L114 --\u0026gt; \u0026lt;level\u0026gt;trace\u0026lt;/level\u0026gt; \u0026lt;log\u0026gt;/var/log/clickhouse-server/clickhouse-server.log\u0026lt;/log\u0026gt; \u0026lt;errorlog\u0026gt;/var/log/clickhouse-server/clickhouse-server.err.log\u0026lt;/errorlog\u0026gt; \u0026lt;!-- Rotation policy See https://github.com/pocoproject/poco/blob/poco-1.9.4-release/Foundation/include/Poco/FileChannel.h#L54-L85 --\u0026gt; \u0026lt;size\u0026gt;1000M\u0026lt;/size\u0026gt; \u0026lt;count\u0026gt;10\u0026lt;/count\u0026gt; \u0026lt;!-- \u0026lt;console\u0026gt;1\u0026lt;/console\u0026gt; --\u0026gt; \u0026lt;!-- Default behavior is autodetection (log to console if not daemon mode and is tty) --\u0026gt; \u0026lt;!-- Per level overrides (legacy): For example to suppress logging of the ConfigReloader you can use: NOTE: levels.logger is reserved, see below. --\u0026gt; \u0026lt;!-- \u0026lt;levels\u0026gt; \u0026lt;ConfigReloader\u0026gt;none\u0026lt;/ConfigReloader\u0026gt; \u0026lt;/levels\u0026gt; --\u0026gt; \u0026lt;!-- Per level overrides: For example to suppress logging of the RBAC for default user you can use: (But please note that the logger name maybe changed from version to version, even after minor upgrade) --\u0026gt; \u0026lt;!-- \u0026lt;levels\u0026gt; \u0026lt;logger\u0026gt; \u0026lt;name\u0026gt;ContextAccess (default)\u0026lt;/name\u0026gt; \u0026lt;level\u0026gt;none\u0026lt;/level\u0026gt; \u0026lt;/logger\u0026gt; \u0026lt;logger\u0026gt; \u0026lt;name\u0026gt;DatabaseOrdinary (test)\u0026lt;/name\u0026gt; \u0026lt;level\u0026gt;none\u0026lt;/level\u0026gt; \u0026lt;/logger\u0026gt; \u0026lt;/levels\u0026gt; --\u0026gt; \u0026lt;/logger\u0026gt; \u0026lt;!-- Add headers to response in options request. OPTIONS method is used in CORS preflight requests. --\u0026gt; \u0026lt;!-- It is off by default. Next headers are obligate for CORS.--\u0026gt; \u0026lt;!-- http_options_response\u0026gt; \u0026lt;header\u0026gt; \u0026lt;name\u0026gt;Access-Control-Allow-Origin\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;*\u0026lt;/value\u0026gt; \u0026lt;/header\u0026gt; \u0026lt;header\u0026gt; \u0026lt;name\u0026gt;Access-Control-Allow-Headers\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;origin, x-requested-with\u0026lt;/value\u0026gt; \u0026lt;/header\u0026gt; \u0026lt;header\u0026gt; \u0026lt;name\u0026gt;Access-Control-Allow-Methods\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;POST, GET, OPTIONS\u0026lt;/value\u0026gt; \u0026lt;/header\u0026gt; \u0026lt;header\u0026gt; \u0026lt;name\u0026gt;Access-Control-Max-Age\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;86400\u0026lt;/value\u0026gt; \u0026lt;/header\u0026gt; \u0026lt;/http_options_response --\u0026gt; \u0026lt;!-- It is the name that will be shown in the clickhouse-client. By default, anything with \u0026#34;production\u0026#34; will be highlighted in red in query prompt. --\u0026gt; \u0026lt;!--display_name\u0026gt;production\u0026lt;/display_name--\u0026gt; \u0026lt;!-- Port for HTTP API. See also \u0026#39;https_port\u0026#39; for secure connections. This interface is also used by ODBC and JDBC drivers (DataGrip, Dbeaver, ...) and by most of web interfaces (embedded UI, Grafana, Redash, ...). --\u0026gt; \u0026lt;http_port\u0026gt;8123\u0026lt;/http_port\u0026gt; \u0026lt;!-- Port for interaction by native protocol with: - clickhouse-client and other native ClickHouse tools (clickhouse-benchmark, clickhouse-copier); - clickhouse-server with other clickhouse-servers for distributed query processing; - ClickHouse drivers and applications supporting native protocol (this protocol is also informally called as \u0026#34;the TCP protocol\u0026#34;); See also \u0026#39;tcp_port_secure\u0026#39; for secure connections. --\u0026gt; \u0026lt;tcp_port\u0026gt;9000\u0026lt;/tcp_port\u0026gt; \u0026lt;!-- Compatibility with MySQL protocol. ClickHouse will pretend to be MySQL for applications connecting to this port. --\u0026gt; \u0026lt;mysql_port\u0026gt;9004\u0026lt;/mysql_port\u0026gt; \u0026lt;!-- Compatibility with PostgreSQL protocol. ClickHouse will pretend to be PostgreSQL for applications connecting to this port. --\u0026gt; \u0026lt;postgresql_port\u0026gt;9005\u0026lt;/postgresql_port\u0026gt; \u0026lt;!-- HTTP API with TLS (HTTPS). You have to configure certificate to enable this interface. See the openSSL section below. --\u0026gt; \u0026lt;!-- \u0026lt;https_port\u0026gt;8443\u0026lt;/https_port\u0026gt; --\u0026gt; \u0026lt;!-- Native interface with TLS. You have to configure certificate to enable this interface. See the openSSL section below. --\u0026gt; \u0026lt;!-- \u0026lt;tcp_port_secure\u0026gt;9440\u0026lt;/tcp_port_secure\u0026gt; --\u0026gt; \u0026lt;!-- Native interface wrapped with PROXYv1 protocol PROXYv1 header sent for every connection. ClickHouse will extract information about proxy-forwarded client address from the header. --\u0026gt; \u0026lt;!-- \u0026lt;tcp_with_proxy_port\u0026gt;9011\u0026lt;/tcp_with_proxy_port\u0026gt; --\u0026gt; \u0026lt;!-- Port for communication between replicas. Used for data exchange. It provides low-level data access between servers. This port should not be accessible from untrusted networks. See also \u0026#39;interserver_http_credentials\u0026#39;. Data transferred over connections to this port should not go through untrusted networks. See also \u0026#39;interserver_https_port\u0026#39;. --\u0026gt; \u0026lt;interserver_http_port\u0026gt;9009\u0026lt;/interserver_http_port\u0026gt; \u0026lt;!-- Port for communication between replicas with TLS. You have to configure certificate to enable this interface. See the openSSL section below. See also \u0026#39;interserver_http_credentials\u0026#39;. --\u0026gt; \u0026lt;!-- \u0026lt;interserver_https_port\u0026gt;9010\u0026lt;/interserver_https_port\u0026gt; --\u0026gt; \u0026lt;!-- Hostname that is used by other replicas to request this server. If not specified, than it is determined analogous to \u0026#39;hostname -f\u0026#39; command. This setting could be used to switch replication to another network interface (the server may be connected to multiple networks via multiple addresses) --\u0026gt; \u0026lt;interserver_http_host\u0026gt;0.0.0.0\u0026lt;/interserver_http_host\u0026gt; \u0026lt;!-- You can specify credentials for authenthication between replicas. This is required when interserver_https_port is accessible from untrusted networks, and also recommended to avoid SSRF attacks from possibly compromised services in your network. --\u0026gt; \u0026lt;!--\u0026lt;interserver_http_credentials\u0026gt; \u0026lt;user\u0026gt;interserver\u0026lt;/user\u0026gt; \u0026lt;password\u0026gt;\u0026lt;/password\u0026gt; \u0026lt;/interserver_http_credentials\u0026gt;--\u0026gt; \u0026lt;!-- Listen specified address. Use :: (wildcard IPv6 address), if you want to accept connections both with IPv4 and IPv6 from everywhere. Notes: If you open connections from wildcard address, make sure that at least one of the following measures applied: - server is protected by firewall and not accessible from untrusted networks; - all users are restricted to subset of network addresses (see users.xml); - all users have strong passwords, only secure (TLS) interfaces are accessible, or connections are only made via TLS interfaces. - users without password have readonly access. See also: https://www.shodan.io/search?query=clickhouse --\u0026gt; \u0026lt;!-- \u0026lt;listen_host\u0026gt;::\u0026lt;/listen_host\u0026gt; --\u0026gt; \u0026lt;!-- Same for hosts without support for IPv6: --\u0026gt; \u0026lt;listen_host\u0026gt;0.0.0.0\u0026lt;/listen_host\u0026gt; \u0026lt;!-- Default values - try listen localhost on IPv4 and IPv6. --\u0026gt; \u0026lt;!-- \u0026lt;listen_host\u0026gt;::1\u0026lt;/listen_host\u0026gt; \u0026lt;listen_host\u0026gt;127.0.0.1\u0026lt;/listen_host\u0026gt; --\u0026gt; \u0026lt;!-- Don\u0026#39;t exit if IPv6 or IPv4 networks are unavailable while trying to listen. --\u0026gt; \u0026lt;!-- \u0026lt;listen_try\u0026gt;0\u0026lt;/listen_try\u0026gt; --\u0026gt; \u0026lt;!-- Allow multiple servers to listen on the same address:port. This is not recommended. --\u0026gt; \u0026lt;!-- \u0026lt;listen_reuse_port\u0026gt;0\u0026lt;/listen_reuse_port\u0026gt; --\u0026gt; \u0026lt;!-- \u0026lt;listen_backlog\u0026gt;4096\u0026lt;/listen_backlog\u0026gt; --\u0026gt; \u0026lt;max_connections\u0026gt;4096\u0026lt;/max_connections\u0026gt; \u0026lt;!-- For \u0026#39;Connection: keep-alive\u0026#39; in HTTP 1.1 --\u0026gt; \u0026lt;keep_alive_timeout\u0026gt;3\u0026lt;/keep_alive_timeout\u0026gt; \u0026lt;!-- gRPC protocol (see src/Server/grpc_protos/clickhouse_grpc.proto for the API) --\u0026gt; \u0026lt;!-- \u0026lt;grpc_port\u0026gt;9100\u0026lt;/grpc_port\u0026gt; --\u0026gt; \u0026lt;grpc\u0026gt; \u0026lt;enable_ssl\u0026gt;false\u0026lt;/enable_ssl\u0026gt; \u0026lt;!-- The following two files are used only if enable_ssl=1 --\u0026gt; \u0026lt;ssl_cert_file\u0026gt;/path/to/ssl_cert_file\u0026lt;/ssl_cert_file\u0026gt; \u0026lt;ssl_key_file\u0026gt;/path/to/ssl_key_file\u0026lt;/ssl_key_file\u0026gt; \u0026lt;!-- Whether server will request client for a certificate --\u0026gt; \u0026lt;ssl_require_client_auth\u0026gt;false\u0026lt;/ssl_require_client_auth\u0026gt; \u0026lt;!-- The following file is used only if ssl_require_client_auth=1 --\u0026gt; \u0026lt;ssl_ca_cert_file\u0026gt;/path/to/ssl_ca_cert_file\u0026lt;/ssl_ca_cert_file\u0026gt; \u0026lt;!-- Default compression algorithm (applied if client doesn\u0026#39;t specify another algorithm, see result_compression in QueryInfo). Supported algorithms: none, deflate, gzip, stream_gzip --\u0026gt; \u0026lt;compression\u0026gt;deflate\u0026lt;/compression\u0026gt; \u0026lt;!-- Default compression level (applied if client doesn\u0026#39;t specify another level, see result_compression in QueryInfo). Supported levels: none, low, medium, high --\u0026gt; \u0026lt;compression_level\u0026gt;medium\u0026lt;/compression_level\u0026gt; \u0026lt;!-- Send/receive message size limits in bytes. -1 means unlimited --\u0026gt; \u0026lt;max_send_message_size\u0026gt;-1\u0026lt;/max_send_message_size\u0026gt; \u0026lt;max_receive_message_size\u0026gt;-1\u0026lt;/max_receive_message_size\u0026gt; \u0026lt;!-- Enable if you want very detailed logs --\u0026gt; \u0026lt;verbose_logs\u0026gt;false\u0026lt;/verbose_logs\u0026gt; \u0026lt;/grpc\u0026gt; \u0026lt;!-- Used with https_port and tcp_port_secure. Full ssl options list: https://github.com/ClickHouse-Extras/poco/blob/master/NetSSL_OpenSSL/include/Poco/Net/SSLManager.h#L71 --\u0026gt; \u0026lt;openSSL\u0026gt; \u0026lt;server\u0026gt; \u0026lt;!-- Used for https server AND secure tcp port --\u0026gt; \u0026lt;!-- openssl req -subj \u0026#34;/CN=localhost\u0026#34; -new -newkey rsa:2048 -days 365 -nodes -x509 -keyout /etc/clickhouse-server/server.key -out /etc/clickhouse-server/server.crt --\u0026gt; \u0026lt;certificateFile\u0026gt;/etc/clickhouse-server/server.crt\u0026lt;/certificateFile\u0026gt; \u0026lt;privateKeyFile\u0026gt;/etc/clickhouse-server/server.key\u0026lt;/privateKeyFile\u0026gt; \u0026lt;!-- dhparams are optional. You can delete the \u0026lt;dhParamsFile\u0026gt; element. To generate dhparams, use the following command: openssl dhparam -out /etc/clickhouse-server/dhparam.pem 4096 Only file format with BEGIN DH PARAMETERS is supported. --\u0026gt; \u0026lt;dhParamsFile\u0026gt;/etc/clickhouse-server/dhparam.pem\u0026lt;/dhParamsFile\u0026gt; \u0026lt;verificationMode\u0026gt;none\u0026lt;/verificationMode\u0026gt; \u0026lt;loadDefaultCAFile\u0026gt;true\u0026lt;/loadDefaultCAFile\u0026gt; \u0026lt;cacheSessions\u0026gt;true\u0026lt;/cacheSessions\u0026gt; \u0026lt;disableProtocols\u0026gt;sslv2,sslv3\u0026lt;/disableProtocols\u0026gt; \u0026lt;preferServerCiphers\u0026gt;true\u0026lt;/preferServerCiphers\u0026gt; \u0026lt;/server\u0026gt; \u0026lt;client\u0026gt; \u0026lt;!-- Used for connecting to https dictionary source and secured Zookeeper communication --\u0026gt; \u0026lt;loadDefaultCAFile\u0026gt;true\u0026lt;/loadDefaultCAFile\u0026gt; \u0026lt;cacheSessions\u0026gt;true\u0026lt;/cacheSessions\u0026gt; \u0026lt;disableProtocols\u0026gt;sslv2,sslv3\u0026lt;/disableProtocols\u0026gt; \u0026lt;preferServerCiphers\u0026gt;true\u0026lt;/preferServerCiphers\u0026gt; \u0026lt;!-- Use for self-signed: \u0026lt;verificationMode\u0026gt;none\u0026lt;/verificationMode\u0026gt; --\u0026gt; \u0026lt;invalidCertificateHandler\u0026gt; \u0026lt;!-- Use for self-signed: \u0026lt;name\u0026gt;AcceptCertificateHandler\u0026lt;/name\u0026gt; --\u0026gt; \u0026lt;name\u0026gt;RejectCertificateHandler\u0026lt;/name\u0026gt; \u0026lt;/invalidCertificateHandler\u0026gt; \u0026lt;/client\u0026gt; \u0026lt;/openSSL\u0026gt; \u0026lt;!-- Default root page on http[s] server. For example load UI from https://tabix.io/ when opening http://localhost:8123 --\u0026gt; \u0026lt;!-- \u0026lt;http_server_default_response\u0026gt;\u0026lt;![CDATA[\u0026lt;html ng-app=\u0026#34;SMI2\u0026#34;\u0026gt;\u0026lt;head\u0026gt;\u0026lt;base href=\u0026#34;http://ui.tabix.io/\u0026#34;\u0026gt;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\u0026lt;div ui-view=\u0026#34;\u0026#34; class=\u0026#34;content-ui\u0026#34;\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;script src=\u0026#34;http://loader.tabix.io/master.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;]]\u0026gt;\u0026lt;/http_server_default_response\u0026gt; --\u0026gt; \u0026lt;!-- Maximum number of concurrent queries. --\u0026gt; \u0026lt;max_concurrent_queries\u0026gt;100\u0026lt;/max_concurrent_queries\u0026gt; \u0026lt;!-- Maximum memory usage (resident set size) for server process. Zero value or unset means default. Default is \u0026#34;max_server_memory_usage_to_ram_ratio\u0026#34; of available physical RAM. If the value is larger than \u0026#34;max_server_memory_usage_to_ram_ratio\u0026#34; of available physical RAM, it will be cut down. The constraint is checked on query execution time. If a query tries to allocate memory and the current memory usage plus allocation is greater than specified threshold, exception will be thrown. It is not practical to set this constraint to small values like just a few gigabytes, because memory allocator will keep this amount of memory in caches and the server will deny service of queries. --\u0026gt; \u0026lt;max_server_memory_usage\u0026gt;0\u0026lt;/max_server_memory_usage\u0026gt; \u0026lt;!-- Maximum number of threads in the Global thread pool. This will default to a maximum of 10000 threads if not specified. This setting will be useful in scenarios where there are a large number of distributed queries that are running concurrently but are idling most of the time, in which case a higher number of threads might be required. --\u0026gt; \u0026lt;max_thread_pool_size\u0026gt;10000\u0026lt;/max_thread_pool_size\u0026gt; \u0026lt;!-- Number of workers to recycle connections in background (see also drain_timeout). If the pool is full, connection will be drained synchronously. --\u0026gt; \u0026lt;!-- \u0026lt;max_threads_for_connection_collector\u0026gt;10\u0026lt;/max_threads_for_connection_collector\u0026gt; --\u0026gt; \u0026lt;!-- On memory constrained environments you may have to set this to value larger than 1. --\u0026gt; \u0026lt;max_server_memory_usage_to_ram_ratio\u0026gt;0.9\u0026lt;/max_server_memory_usage_to_ram_ratio\u0026gt; \u0026lt;!-- Simple server-wide memory profiler. Collect a stack trace at every peak allocation step (in bytes). Data will be stored in system.trace_log table with query_id = empty string. Zero means disabled. --\u0026gt; \u0026lt;total_memory_profiler_step\u0026gt;4194304\u0026lt;/total_memory_profiler_step\u0026gt; \u0026lt;!-- Collect random allocations and deallocations and write them into system.trace_log with \u0026#39;MemorySample\u0026#39; trace_type. The probability is for every alloc/free regardless to the size of the allocation. Note that sampling happens only when the amount of untracked memory exceeds the untracked memory limit, which is 4 MiB by default but can be lowered if \u0026#39;total_memory_profiler_step\u0026#39; is lowered. You may want to set \u0026#39;total_memory_profiler_step\u0026#39; to 1 for extra fine grained sampling. --\u0026gt; \u0026lt;total_memory_tracker_sample_probability\u0026gt;0\u0026lt;/total_memory_tracker_sample_probability\u0026gt; \u0026lt;!-- Set limit on number of open files (default: maximum). This setting makes sense on Mac OS X because getrlimit() fails to retrieve correct maximum value. --\u0026gt; \u0026lt;!-- \u0026lt;max_open_files\u0026gt;262144\u0026lt;/max_open_files\u0026gt; --\u0026gt; \u0026lt;!-- Size of cache of uncompressed blocks of data, used in tables of MergeTree family. In bytes. Cache is single for server. Memory is allocated only on demand. Cache is used when \u0026#39;use_uncompressed_cache\u0026#39; user setting turned on (off by default). Uncompressed cache is advantageous only for very short queries and in rare cases. Note: uncompressed cache can be pointless for lz4, because memory bandwidth is slower than multi-core decompression on some server configurations. Enabling it can sometimes paradoxically make queries slower. --\u0026gt; \u0026lt;uncompressed_cache_size\u0026gt;8589934592\u0026lt;/uncompressed_cache_size\u0026gt; \u0026lt;!-- Approximate size of mark cache, used in tables of MergeTree family. In bytes. Cache is single for server. Memory is allocated only on demand. You should not lower this value. --\u0026gt; \u0026lt;mark_cache_size\u0026gt;5368709120\u0026lt;/mark_cache_size\u0026gt; \u0026lt;!-- If you enable the `min_bytes_to_use_mmap_io` setting, the data in MergeTree tables can be read with mmap to avoid copying from kernel to userspace. It makes sense only for large files and helps only if data reside in page cache. To avoid frequent open/mmap/munmap/close calls (which are very expensive due to consequent page faults) and to reuse mappings from several threads and queries, the cache of mapped files is maintained. Its size is the number of mapped regions (usually equal to the number of mapped files). The amount of data in mapped files can be monitored in system.metrics, system.metric_log by the MMappedFiles, MMappedFileBytes metrics and in system.asynchronous_metrics, system.asynchronous_metrics_log by the MMapCacheCells metric, and also in system.events, system.processes, system.query_log, system.query_thread_log, system.query_views_log by the CreatedReadBufferMMap, CreatedReadBufferMMapFailed, MMappedFileCacheHits, MMappedFileCacheMisses events. Note that the amount of data in mapped files does not consume memory directly and is not accounted in query or server memory usage - because this memory can be discarded similar to OS page cache. The cache is dropped (the files are closed) automatically on removal of old parts in MergeTree, also it can be dropped manually by the SYSTEM DROP MMAP CACHE query. --\u0026gt; \u0026lt;mmap_cache_size\u0026gt;1000\u0026lt;/mmap_cache_size\u0026gt; \u0026lt;!-- Cache size in bytes for compiled expressions.--\u0026gt; \u0026lt;compiled_expression_cache_size\u0026gt;134217728\u0026lt;/compiled_expression_cache_size\u0026gt; \u0026lt;!-- Cache size in elements for compiled expressions.--\u0026gt; \u0026lt;compiled_expression_cache_elements_size\u0026gt;10000\u0026lt;/compiled_expression_cache_elements_size\u0026gt; \u0026lt;!-- Path to data directory, with trailing slash. --\u0026gt; \u0026lt;path\u0026gt;/var/lib/clickhouse/\u0026lt;/path\u0026gt; \u0026lt;!-- Path to temporary data for processing hard queries. --\u0026gt; \u0026lt;tmp_path\u0026gt;/var/lib/clickhouse/tmp/\u0026lt;/tmp_path\u0026gt; \u0026lt;!-- Policy from the \u0026lt;storage_configuration\u0026gt; for the temporary files. If not set \u0026lt;tmp_path\u0026gt; is used, otherwise \u0026lt;tmp_path\u0026gt; is ignored. Notes: - move_factor is ignored - keep_free_space_bytes is ignored - max_data_part_size_bytes is ignored - you must have exactly one volume in that policy --\u0026gt; \u0026lt;!-- \u0026lt;tmp_policy\u0026gt;tmp\u0026lt;/tmp_policy\u0026gt; --\u0026gt; \u0026lt;!-- Directory with user provided files that are accessible by \u0026#39;file\u0026#39; table function. --\u0026gt; \u0026lt;user_files_path\u0026gt;/var/lib/clickhouse/user_files/\u0026lt;/user_files_path\u0026gt; \u0026lt;!-- LDAP server definitions. --\u0026gt; \u0026lt;ldap_servers\u0026gt; \u0026lt;!-- List LDAP servers with their connection parameters here to later 1) use them as authenticators for dedicated local users, who have \u0026#39;ldap\u0026#39; authentication mechanism specified instead of \u0026#39;password\u0026#39;, or to 2) use them as remote user directories. Parameters: host - LDAP server hostname or IP, this parameter is mandatory and cannot be empty. port - LDAP server port, default is 636 if enable_tls is set to true, 389 otherwise. bind_dn - template used to construct the DN to bind to. The resulting DN will be constructed by replacing all \u0026#39;{user_name}\u0026#39; substrings of the template with the actual user name during each authentication attempt. user_dn_detection - section with LDAP search parameters for detecting the actual user DN of the bound user. This is mainly used in search filters for further role mapping when the server is Active Directory. The resulting user DN will be used when replacing \u0026#39;{user_dn}\u0026#39; substrings wherever they are allowed. By default, user DN is set equal to bind DN, but once search is performed, it will be updated with to the actual detected user DN value. base_dn - template used to construct the base DN for the LDAP search. The resulting DN will be constructed by replacing all \u0026#39;{user_name}\u0026#39; and \u0026#39;{bind_dn}\u0026#39; substrings of the template with the actual user name and bind DN during the LDAP search. scope - scope of the LDAP search. Accepted values are: \u0026#39;base\u0026#39;, \u0026#39;one_level\u0026#39;, \u0026#39;children\u0026#39;, \u0026#39;subtree\u0026#39; (the default). search_filter - template used to construct the search filter for the LDAP search. The resulting filter will be constructed by replacing all \u0026#39;{user_name}\u0026#39;, \u0026#39;{bind_dn}\u0026#39;, and \u0026#39;{base_dn}\u0026#39; substrings of the template with the actual user name, bind DN, and base DN during the LDAP search. Note, that the special characters must be escaped properly in XML. verification_cooldown - a period of time, in seconds, after a successful bind attempt, during which a user will be assumed to be successfully authenticated for all consecutive requests without contacting the LDAP server. Specify 0 (the default) to disable caching and force contacting the LDAP server for each authentication request. enable_tls - flag to trigger use of secure connection to the LDAP server. Specify \u0026#39;no\u0026#39; for plain text (ldap://) protocol (not recommended). Specify \u0026#39;yes\u0026#39; for LDAP over SSL/TLS (ldaps://) protocol (recommended, the default). Specify \u0026#39;starttls\u0026#39; for legacy StartTLS protocol (plain text (ldap://) protocol, upgraded to TLS). tls_minimum_protocol_version - the minimum protocol version of SSL/TLS. Accepted values are: \u0026#39;ssl2\u0026#39;, \u0026#39;ssl3\u0026#39;, \u0026#39;tls1.0\u0026#39;, \u0026#39;tls1.1\u0026#39;, \u0026#39;tls1.2\u0026#39; (the default). tls_require_cert - SSL/TLS peer certificate verification behavior. Accepted values are: \u0026#39;never\u0026#39;, \u0026#39;allow\u0026#39;, \u0026#39;try\u0026#39;, \u0026#39;demand\u0026#39; (the default). tls_cert_file - path to certificate file. tls_key_file - path to certificate key file. tls_ca_cert_file - path to CA certificate file. tls_ca_cert_dir - path to the directory containing CA certificates. tls_cipher_suite - allowed cipher suite (in OpenSSL notation). Example: \u0026lt;my_ldap_server\u0026gt; \u0026lt;host\u0026gt;localhost\u0026lt;/host\u0026gt; \u0026lt;port\u0026gt;636\u0026lt;/port\u0026gt; \u0026lt;bind_dn\u0026gt;uid={user_name},ou=users,dc=example,dc=com\u0026lt;/bind_dn\u0026gt; \u0026lt;verification_cooldown\u0026gt;300\u0026lt;/verification_cooldown\u0026gt; \u0026lt;enable_tls\u0026gt;yes\u0026lt;/enable_tls\u0026gt; \u0026lt;tls_minimum_protocol_version\u0026gt;tls1.2\u0026lt;/tls_minimum_protocol_version\u0026gt; \u0026lt;tls_require_cert\u0026gt;demand\u0026lt;/tls_require_cert\u0026gt; \u0026lt;tls_cert_file\u0026gt;/path/to/tls_cert_file\u0026lt;/tls_cert_file\u0026gt; \u0026lt;tls_key_file\u0026gt;/path/to/tls_key_file\u0026lt;/tls_key_file\u0026gt; \u0026lt;tls_ca_cert_file\u0026gt;/path/to/tls_ca_cert_file\u0026lt;/tls_ca_cert_file\u0026gt; \u0026lt;tls_ca_cert_dir\u0026gt;/path/to/tls_ca_cert_dir\u0026lt;/tls_ca_cert_dir\u0026gt; \u0026lt;tls_cipher_suite\u0026gt;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:AES256-GCM-SHA384\u0026lt;/tls_cipher_suite\u0026gt; \u0026lt;/my_ldap_server\u0026gt; Example (typical Active Directory with configured user DN detection for further role mapping): \u0026lt;my_ad_server\u0026gt; \u0026lt;host\u0026gt;localhost\u0026lt;/host\u0026gt; \u0026lt;port\u0026gt;389\u0026lt;/port\u0026gt; \u0026lt;bind_dn\u0026gt;EXAMPLE\\{user_name}\u0026lt;/bind_dn\u0026gt; \u0026lt;user_dn_detection\u0026gt; \u0026lt;base_dn\u0026gt;CN=Users,DC=example,DC=com\u0026lt;/base_dn\u0026gt; \u0026lt;search_filter\u0026gt;(\u0026amp;amp;(objectClass=user)(sAMAccountName={user_name}))\u0026lt;/search_filter\u0026gt; \u0026lt;/user_dn_detection\u0026gt; \u0026lt;enable_tls\u0026gt;no\u0026lt;/enable_tls\u0026gt; \u0026lt;/my_ad_server\u0026gt; --\u0026gt; \u0026lt;/ldap_servers\u0026gt; \u0026lt;!-- To enable Kerberos authentication support for HTTP requests (GSS-SPNEGO), for those users who are explicitly configured to authenticate via Kerberos, define a single \u0026#39;kerberos\u0026#39; section here. Parameters: principal - canonical service principal name, that will be acquired and used when accepting security contexts. This parameter is optional, if omitted, the default principal will be used. This parameter cannot be specified together with \u0026#39;realm\u0026#39; parameter. realm - a realm, that will be used to restrict authentication to only those requests whose initiator\u0026#39;s realm matches it. This parameter is optional, if omitted, no additional filtering by realm will be applied. This parameter cannot be specified together with \u0026#39;principal\u0026#39; parameter. Example: \u0026lt;kerberos /\u0026gt; Example: \u0026lt;kerberos\u0026gt; \u0026lt;principal\u0026gt;HTTP/clickhouse.example.com@EXAMPLE.COM\u0026lt;/principal\u0026gt; \u0026lt;/kerberos\u0026gt; Example: \u0026lt;kerberos\u0026gt; \u0026lt;realm\u0026gt;EXAMPLE.COM\u0026lt;/realm\u0026gt; \u0026lt;/kerberos\u0026gt; --\u0026gt; \u0026lt;!-- Sources to read users, roles, access rights, profiles of settings, quotas. --\u0026gt; \u0026lt;user_directories\u0026gt; \u0026lt;users_xml\u0026gt; \u0026lt;!-- Path to configuration file with predefined users. --\u0026gt; \u0026lt;path\u0026gt;users.xml\u0026lt;/path\u0026gt; \u0026lt;/users_xml\u0026gt; \u0026lt;local_directory\u0026gt; \u0026lt;!-- Path to folder where users created by SQL commands are stored. --\u0026gt; \u0026lt;path\u0026gt;/var/lib/clickhouse/access/\u0026lt;/path\u0026gt; \u0026lt;/local_directory\u0026gt; \u0026lt;!-- To add an LDAP server as a remote user directory of users that are not defined locally, define a single \u0026#39;ldap\u0026#39; section with the following parameters: server - one of LDAP server names defined in \u0026#39;ldap_servers\u0026#39; config section above. This parameter is mandatory and cannot be empty. roles - section with a list of locally defined roles that will be assigned to each user retrieved from the LDAP server. If no roles are specified here or assigned during role mapping (below), user will not be able to perform any actions after authentication. role_mapping - section with LDAP search parameters and mapping rules. When a user authenticates, while still bound to LDAP, an LDAP search is performed using search_filter and the name of the logged in user. For each entry found during that search, the value of the specified attribute is extracted. For each attribute value that has the specified prefix, the prefix is removed, and the rest of the value becomes the name of a local role defined in ClickHouse, which is expected to be created beforehand by CREATE ROLE command. There can be multiple \u0026#39;role_mapping\u0026#39; sections defined inside the same \u0026#39;ldap\u0026#39; section. All of them will be applied. base_dn - template used to construct the base DN for the LDAP search. The resulting DN will be constructed by replacing all \u0026#39;{user_name}\u0026#39;, \u0026#39;{bind_dn}\u0026#39;, and \u0026#39;{user_dn}\u0026#39; substrings of the template with the actual user name, bind DN, and user DN during each LDAP search. scope - scope of the LDAP search. Accepted values are: \u0026#39;base\u0026#39;, \u0026#39;one_level\u0026#39;, \u0026#39;children\u0026#39;, \u0026#39;subtree\u0026#39; (the default). search_filter - template used to construct the search filter for the LDAP search. The resulting filter will be constructed by replacing all \u0026#39;{user_name}\u0026#39;, \u0026#39;{bind_dn}\u0026#39;, \u0026#39;{user_dn}\u0026#39;, and \u0026#39;{base_dn}\u0026#39; substrings of the template with the actual user name, bind DN, user DN, and base DN during each LDAP search. Note, that the special characters must be escaped properly in XML. attribute - attribute name whose values will be returned by the LDAP search. \u0026#39;cn\u0026#39;, by default. prefix - prefix, that will be expected to be in front of each string in the original list of strings returned by the LDAP search. Prefix will be removed from the original strings and resulting strings will be treated as local role names. Empty, by default. Example: \u0026lt;ldap\u0026gt; \u0026lt;server\u0026gt;my_ldap_server\u0026lt;/server\u0026gt; \u0026lt;roles\u0026gt; \u0026lt;my_local_role1 /\u0026gt; \u0026lt;my_local_role2 /\u0026gt; \u0026lt;/roles\u0026gt; \u0026lt;role_mapping\u0026gt; \u0026lt;base_dn\u0026gt;ou=groups,dc=example,dc=com\u0026lt;/base_dn\u0026gt; \u0026lt;scope\u0026gt;subtree\u0026lt;/scope\u0026gt; \u0026lt;search_filter\u0026gt;(\u0026amp;amp;(objectClass=groupOfNames)(member={bind_dn}))\u0026lt;/search_filter\u0026gt; \u0026lt;attribute\u0026gt;cn\u0026lt;/attribute\u0026gt; \u0026lt;prefix\u0026gt;clickhouse_\u0026lt;/prefix\u0026gt; \u0026lt;/role_mapping\u0026gt; \u0026lt;/ldap\u0026gt; Example (typical Active Directory with role mapping that relies on the detected user DN): \u0026lt;ldap\u0026gt; \u0026lt;server\u0026gt;my_ad_server\u0026lt;/server\u0026gt; \u0026lt;role_mapping\u0026gt; \u0026lt;base_dn\u0026gt;CN=Users,DC=example,DC=com\u0026lt;/base_dn\u0026gt; \u0026lt;attribute\u0026gt;CN\u0026lt;/attribute\u0026gt; \u0026lt;scope\u0026gt;subtree\u0026lt;/scope\u0026gt; \u0026lt;search_filter\u0026gt;(\u0026amp;amp;(objectClass=group)(member={user_dn}))\u0026lt;/search_filter\u0026gt; \u0026lt;prefix\u0026gt;clickhouse_\u0026lt;/prefix\u0026gt; \u0026lt;/role_mapping\u0026gt; \u0026lt;/ldap\u0026gt; --\u0026gt; \u0026lt;/user_directories\u0026gt; \u0026lt;!-- Default profile of settings. --\u0026gt; \u0026lt;default_profile\u0026gt;default\u0026lt;/default_profile\u0026gt; \u0026lt;!-- Comma-separated list of prefixes for user-defined settings. --\u0026gt; \u0026lt;custom_settings_prefixes\u0026gt;\u0026lt;/custom_settings_prefixes\u0026gt; \u0026lt;!-- System profile of settings. This settings are used by internal processes (Distributed DDL worker and so on). --\u0026gt; \u0026lt;!-- \u0026lt;system_profile\u0026gt;default\u0026lt;/system_profile\u0026gt; --\u0026gt; \u0026lt;!-- Buffer profile of settings. This settings are used by Buffer storage to flush data to the underlying table. Default: used from system_profile directive. --\u0026gt; \u0026lt;!-- \u0026lt;buffer_profile\u0026gt;default\u0026lt;/buffer_profile\u0026gt; --\u0026gt; \u0026lt;!-- Default database. --\u0026gt; \u0026lt;default_database\u0026gt;default\u0026lt;/default_database\u0026gt; \u0026lt;!-- Server time zone could be set here. Time zone is used when converting between String and DateTime types, when printing DateTime in text formats and parsing DateTime from text, it is used in date and time related functions, if specific time zone was not passed as an argument. Time zone is specified as identifier from IANA time zone database, like UTC or Africa/Abidjan. If not specified, system time zone at server startup is used. Please note, that server could display time zone alias instead of specified name. Example: W-SU is an alias for Europe/Moscow and Zulu is an alias for UTC. --\u0026gt; \u0026lt;!-- \u0026lt;timezone\u0026gt;Europe/Moscow\u0026lt;/timezone\u0026gt; --\u0026gt; \u0026lt;!-- You can specify umask here (see \u0026#34;man umask\u0026#34;). Server will apply it on startup. Number is always parsed as octal. Default umask is 027 (other users cannot read logs, data files, etc; group can only read). --\u0026gt; \u0026lt;!-- \u0026lt;umask\u0026gt;022\u0026lt;/umask\u0026gt; --\u0026gt; \u0026lt;!-- Perform mlockall after startup to lower first queries latency and to prevent clickhouse executable from being paged out under high IO load. Enabling this option is recommended but will lead to increased startup time for up to a few seconds. --\u0026gt; \u0026lt;mlock_executable\u0026gt;true\u0026lt;/mlock_executable\u0026gt; \u0026lt;!-- Reallocate memory for machine code (\u0026#34;text\u0026#34;) using huge pages. Highly experimental. --\u0026gt; \u0026lt;remap_executable\u0026gt;false\u0026lt;/remap_executable\u0026gt; \u0026lt;![CDATA[ Uncomment below in order to use JDBC table engine and function. To install and run JDBC bridge in background: * [Debian/Ubuntu] export MVN_URL=https://repo1.maven.org/maven2/ru/yandex/clickhouse/clickhouse-jdbc-bridge export PKG_VER=$(curl -sL $MVN_URL/maven-metadata.xml | grep \u0026#39;\u0026lt;release\u0026gt;\u0026#39; | sed -e \u0026#39;s|.*\u0026gt;\\(.*\\)\u0026lt;.*|\\1|\u0026#39;) wget https://github.com/ClickHouse/clickhouse-jdbc-bridge/releases/download/v$PKG_VER/clickhouse-jdbc-bridge_$PKG_VER-1_all.deb apt install --no-install-recommends -f ./clickhouse-jdbc-bridge_$PKG_VER-1_all.deb clickhouse-jdbc-bridge \u0026amp; * [CentOS/RHEL] export MVN_URL=https://repo1.maven.org/maven2/ru/yandex/clickhouse/clickhouse-jdbc-bridge export PKG_VER=$(curl -sL $MVN_URL/maven-metadata.xml | grep \u0026#39;\u0026lt;release\u0026gt;\u0026#39; | sed -e \u0026#39;s|.*\u0026gt;\\(.*\\)\u0026lt;.*|\\1|\u0026#39;) wget https://github.com/ClickHouse/clickhouse-jdbc-bridge/releases/download/v$PKG_VER/clickhouse-jdbc-bridge-$PKG_VER-1.noarch.rpm yum localinstall -y clickhouse-jdbc-bridge-$PKG_VER-1.noarch.rpm clickhouse-jdbc-bridge \u0026amp; Please refer to https://github.com/ClickHouse/clickhouse-jdbc-bridge#usage for more information. ]]\u0026gt; \u0026lt;!-- \u0026lt;jdbc_bridge\u0026gt; \u0026lt;host\u0026gt;127.0.0.1\u0026lt;/host\u0026gt; \u0026lt;port\u0026gt;9019\u0026lt;/port\u0026gt; \u0026lt;/jdbc_bridge\u0026gt; --\u0026gt; \u0026lt;!-- Configuration of clusters that could be used in Distributed tables. https://clickhouse.com/docs/en/operations/table_engines/distributed/ --\u0026gt; \u0026lt;remote_servers\u0026gt; \u0026lt;default_cluster\u0026gt; \u0026lt;shard\u0026gt; \u0026lt;weight\u0026gt;1\u0026lt;/weight\u0026gt; \u0026lt;internal_replication\u0026gt;false\u0026lt;/internal_replication\u0026gt; \u0026lt;replica\u0026gt; \u0026lt;host\u0026gt;ck1\u0026lt;/host\u0026gt; \u0026lt;port\u0026gt;9000\u0026lt;/port\u0026gt; \u0026lt;/replica\u0026gt; \u0026lt;/shard\u0026gt; \u0026lt;shard\u0026gt; \u0026lt;weight\u0026gt;1\u0026lt;/weight\u0026gt; \u0026lt;internal_replication\u0026gt;false\u0026lt;/internal_replication\u0026gt; \u0026lt;replica\u0026gt; \u0026lt;host\u0026gt;ck2\u0026lt;/host\u0026gt; \u0026lt;port\u0026gt;9000\u0026lt;/port\u0026gt; \u0026lt;/replica\u0026gt; \u0026lt;/shard\u0026gt; \u0026lt;shard\u0026gt; \u0026lt;weight\u0026gt;1\u0026lt;/weight\u0026gt; \u0026lt;internal_replication\u0026gt;false\u0026lt;/internal_replication\u0026gt; \u0026lt;replica\u0026gt; \u0026lt;host\u0026gt;ck3\u0026lt;/host\u0026gt; \u0026lt;port\u0026gt;9000\u0026lt;/port\u0026gt; \u0026lt;/replica\u0026gt; \u0026lt;/shard\u0026gt; \u0026lt;/default_cluster\u0026gt; \u0026lt;/remote_servers\u0026gt; \u0026lt;macros\u0026gt; \u0026lt;replica\u0026gt;ck1\u0026lt;/replica\u0026gt; \u0026lt;shard\u0026gt;01\u0026lt;/shard\u0026gt; \u0026lt;layer\u0026gt;01\u0026lt;/layer\u0026gt; \u0026lt;/macros\u0026gt; \u0026lt;!-- The list of hosts allowed to use in URL-related storage engines and table functions. If this section is not present in configuration, all hosts are allowed. --\u0026gt; \u0026lt;!--\u0026lt;remote_url_allow_hosts\u0026gt;--\u0026gt; \u0026lt;!-- Host should be specified exactly as in URL. The name is checked before DNS resolution. Example: \u0026#34;yandex.ru\u0026#34;, \u0026#34;yandex.ru.\u0026#34; and \u0026#34;www.yandex.ru\u0026#34; are different hosts. If port is explicitly specified in URL, the host:port is checked as a whole. If host specified here without port, any port with this host allowed. \u0026#34;yandex.ru\u0026#34; -\u0026gt; \u0026#34;yandex.ru:443\u0026#34;, \u0026#34;yandex.ru:80\u0026#34; etc. is allowed, but \u0026#34;yandex.ru:80\u0026#34; -\u0026gt; only \u0026#34;yandex.ru:80\u0026#34; is allowed. If the host is specified as IP address, it is checked as specified in URL. Example: \u0026#34;[2a02:6b8:a::a]\u0026#34;. If there are redirects and support for redirects is enabled, every redirect (the Location field) is checked. Host should be specified using the host xml tag: \u0026lt;host\u0026gt;yandex.ru\u0026lt;/host\u0026gt; --\u0026gt; \u0026lt;!-- Regular expression can be specified. RE2 engine is used for regexps. Regexps are not aligned: don\u0026#39;t forget to add ^ and $. Also don\u0026#39;t forget to escape dot (.) metacharacter (forgetting to do so is a common source of error). --\u0026gt; \u0026lt;!--\u0026lt;/remote_url_allow_hosts\u0026gt;--\u0026gt; \u0026lt;!-- If element has \u0026#39;incl\u0026#39; attribute, then for it\u0026#39;s value will be used corresponding substitution from another file. By default, path to file with substitutions is /etc/metrika.xml. It could be changed in config in \u0026#39;include_from\u0026#39; element. Values for substitutions are specified in /clickhouse/name_of_substitution elements in that file. --\u0026gt; \u0026lt;!-- ZooKeeper is used to store metadata about replicas, when using Replicated tables. Optional. If you don\u0026#39;t use replicated tables, you could omit that. See https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replication/ --\u0026gt; \u0026lt;zookeeper\u0026gt; \u0026lt;node\u0026gt; \u0026lt;host\u0026gt;zookeeper1\u0026lt;/host\u0026gt; \u0026lt;port\u0026gt;2181\u0026lt;/port\u0026gt; \u0026lt;/node\u0026gt; \u0026lt;/zookeeper\u0026gt; \u0026lt;!-- Substitutions for parameters of replicated tables. Optional. If you don\u0026#39;t use replicated tables, you could omit that. See https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replication/#creating-replicated-tables --\u0026gt; \u0026lt;!-- \u0026lt;macros\u0026gt; \u0026lt;shard\u0026gt;01\u0026lt;/shard\u0026gt; \u0026lt;replica\u0026gt;example01-01-1\u0026lt;/replica\u0026gt; \u0026lt;/macros\u0026gt; --\u0026gt; \u0026lt;!-- Reloading interval for embedded dictionaries, in seconds. Default: 3600. --\u0026gt; \u0026lt;builtin_dictionaries_reload_interval\u0026gt;3600\u0026lt;/builtin_dictionaries_reload_interval\u0026gt; \u0026lt;!-- Maximum session timeout, in seconds. Default: 3600. --\u0026gt; \u0026lt;max_session_timeout\u0026gt;3600\u0026lt;/max_session_timeout\u0026gt; \u0026lt;!-- Default session timeout, in seconds. Default: 60. --\u0026gt; \u0026lt;default_session_timeout\u0026gt;60\u0026lt;/default_session_timeout\u0026gt; \u0026lt;!-- Sending data to Graphite for monitoring. Several sections can be defined. --\u0026gt; \u0026lt;!-- interval - send every X second root_path - prefix for keys hostname_in_path - append hostname to root_path (default = true) metrics - send data from table system.metrics events - send data from table system.events asynchronous_metrics - send data from table system.asynchronous_metrics --\u0026gt; \u0026lt;!-- \u0026lt;graphite\u0026gt; \u0026lt;host\u0026gt;localhost\u0026lt;/host\u0026gt; \u0026lt;port\u0026gt;42000\u0026lt;/port\u0026gt; \u0026lt;timeout\u0026gt;0.1\u0026lt;/timeout\u0026gt; \u0026lt;interval\u0026gt;60\u0026lt;/interval\u0026gt; \u0026lt;root_path\u0026gt;one_min\u0026lt;/root_path\u0026gt; \u0026lt;hostname_in_path\u0026gt;true\u0026lt;/hostname_in_path\u0026gt; \u0026lt;metrics\u0026gt;true\u0026lt;/metrics\u0026gt; \u0026lt;events\u0026gt;true\u0026lt;/events\u0026gt; \u0026lt;events_cumulative\u0026gt;false\u0026lt;/events_cumulative\u0026gt; \u0026lt;asynchronous_metrics\u0026gt;true\u0026lt;/asynchronous_metrics\u0026gt; \u0026lt;/graphite\u0026gt; \u0026lt;graphite\u0026gt; \u0026lt;host\u0026gt;localhost\u0026lt;/host\u0026gt; \u0026lt;port\u0026gt;42000\u0026lt;/port\u0026gt; \u0026lt;timeout\u0026gt;0.1\u0026lt;/timeout\u0026gt; \u0026lt;interval\u0026gt;1\u0026lt;/interval\u0026gt; \u0026lt;root_path\u0026gt;one_sec\u0026lt;/root_path\u0026gt; \u0026lt;metrics\u0026gt;true\u0026lt;/metrics\u0026gt; \u0026lt;events\u0026gt;true\u0026lt;/events\u0026gt; \u0026lt;events_cumulative\u0026gt;false\u0026lt;/events_cumulative\u0026gt; \u0026lt;asynchronous_metrics\u0026gt;false\u0026lt;/asynchronous_metrics\u0026gt; \u0026lt;/graphite\u0026gt; --\u0026gt; \u0026lt;!-- Serve endpoint for Prometheus monitoring. --\u0026gt; \u0026lt;!-- endpoint - mertics path (relative to root, statring with \u0026#34;/\u0026#34;) port - port to setup server. If not defined or 0 than http_port used metrics - send data from table system.metrics events - send data from table system.events asynchronous_metrics - send data from table system.asynchronous_metrics status_info - send data from different component from CH, ex: Dictionaries status --\u0026gt; \u0026lt;!-- \u0026lt;prometheus\u0026gt; \u0026lt;endpoint\u0026gt;/metrics\u0026lt;/endpoint\u0026gt; \u0026lt;port\u0026gt;9363\u0026lt;/port\u0026gt; \u0026lt;metrics\u0026gt;true\u0026lt;/metrics\u0026gt; \u0026lt;events\u0026gt;true\u0026lt;/events\u0026gt; \u0026lt;asynchronous_metrics\u0026gt;true\u0026lt;/asynchronous_metrics\u0026gt; \u0026lt;status_info\u0026gt;true\u0026lt;/status_info\u0026gt; \u0026lt;/prometheus\u0026gt; --\u0026gt; \u0026lt;!-- Query log. Used only for queries with setting log_queries = 1. --\u0026gt; \u0026lt;query_log\u0026gt; \u0026lt;!-- What table to insert data. If table is not exist, it will be created. When query log structure is changed after system update, then old table will be renamed and new table will be created automatically. --\u0026gt; \u0026lt;database\u0026gt;system\u0026lt;/database\u0026gt; \u0026lt;table\u0026gt;query_log\u0026lt;/table\u0026gt; \u0026lt;!-- PARTITION BY expr: https://clickhouse.com/docs/en/table_engines/mergetree-family/custom_partitioning_key/ Example: event_date toMonday(event_date) toYYYYMM(event_date) toStartOfHour(event_time) --\u0026gt; \u0026lt;partition_by\u0026gt;toYYYYMM(event_date)\u0026lt;/partition_by\u0026gt; \u0026lt;!-- Table TTL specification: https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree/#mergetree-table-ttl Example: event_date + INTERVAL 1 WEEK event_date + INTERVAL 7 DAY DELETE event_date + INTERVAL 2 WEEK TO DISK \u0026#39;bbb\u0026#39; \u0026lt;ttl\u0026gt;event_date + INTERVAL 30 DAY DELETE\u0026lt;/ttl\u0026gt; --\u0026gt; \u0026lt;!-- Instead of partition_by, you can provide full engine expression (starting with ENGINE = ) with parameters, Example: \u0026lt;engine\u0026gt;ENGINE = MergeTree PARTITION BY toYYYYMM(event_date) ORDER BY (event_date, event_time) SETTINGS index_granularity = 1024\u0026lt;/engine\u0026gt; --\u0026gt; \u0026lt;!-- Interval of flushing data. --\u0026gt; \u0026lt;flush_interval_milliseconds\u0026gt;7500\u0026lt;/flush_interval_milliseconds\u0026gt; \u0026lt;/query_log\u0026gt; \u0026lt;!-- Trace log. Stores stack traces collected by query profilers. See query_profiler_real_time_period_ns and query_profiler_cpu_time_period_ns settings. --\u0026gt; \u0026lt;trace_log\u0026gt; \u0026lt;database\u0026gt;system\u0026lt;/database\u0026gt; \u0026lt;table\u0026gt;trace_log\u0026lt;/table\u0026gt; \u0026lt;partition_by\u0026gt;toYYYYMM(event_date)\u0026lt;/partition_by\u0026gt; \u0026lt;flush_interval_milliseconds\u0026gt;7500\u0026lt;/flush_interval_milliseconds\u0026gt; \u0026lt;/trace_log\u0026gt; \u0026lt;!-- Query thread log. Has information about all threads participated in query execution. Used only for queries with setting log_query_threads = 1. --\u0026gt; \u0026lt;query_thread_log\u0026gt; \u0026lt;database\u0026gt;system\u0026lt;/database\u0026gt; \u0026lt;table\u0026gt;query_thread_log\u0026lt;/table\u0026gt; \u0026lt;partition_by\u0026gt;toYYYYMM(event_date)\u0026lt;/partition_by\u0026gt; \u0026lt;flush_interval_milliseconds\u0026gt;7500\u0026lt;/flush_interval_milliseconds\u0026gt; \u0026lt;/query_thread_log\u0026gt; \u0026lt;!-- Query views log. Has information about all dependent views associated with a query. Used only for queries with setting log_query_views = 1. --\u0026gt; \u0026lt;query_views_log\u0026gt; \u0026lt;database\u0026gt;system\u0026lt;/database\u0026gt; \u0026lt;table\u0026gt;query_views_log\u0026lt;/table\u0026gt; \u0026lt;partition_by\u0026gt;toYYYYMM(event_date)\u0026lt;/partition_by\u0026gt; \u0026lt;flush_interval_milliseconds\u0026gt;7500\u0026lt;/flush_interval_milliseconds\u0026gt; \u0026lt;/query_views_log\u0026gt; \u0026lt;!-- Uncomment if use part log. Part log contains information about all actions with parts in MergeTree tables (creation, deletion, merges, downloads).--\u0026gt; \u0026lt;part_log\u0026gt; \u0026lt;database\u0026gt;system\u0026lt;/database\u0026gt; \u0026lt;table\u0026gt;part_log\u0026lt;/table\u0026gt; \u0026lt;partition_by\u0026gt;toYYYYMM(event_date)\u0026lt;/partition_by\u0026gt; \u0026lt;flush_interval_milliseconds\u0026gt;7500\u0026lt;/flush_interval_milliseconds\u0026gt; \u0026lt;/part_log\u0026gt; \u0026lt;!-- Uncomment to write text log into table. Text log contains all information from usual server log but stores it in structured and efficient way. The level of the messages that goes to the table can be limited (\u0026lt;level\u0026gt;), if not specified all messages will go to the table. \u0026lt;text_log\u0026gt; \u0026lt;database\u0026gt;system\u0026lt;/database\u0026gt; \u0026lt;table\u0026gt;text_log\u0026lt;/table\u0026gt; \u0026lt;flush_interval_milliseconds\u0026gt;7500\u0026lt;/flush_interval_milliseconds\u0026gt; \u0026lt;level\u0026gt;\u0026lt;/level\u0026gt; \u0026lt;/text_log\u0026gt; --\u0026gt; \u0026lt;!-- Metric log contains rows with current values of ProfileEvents, CurrentMetrics collected with \u0026#34;collect_interval_milliseconds\u0026#34; interval. --\u0026gt; \u0026lt;metric_log\u0026gt; \u0026lt;database\u0026gt;system\u0026lt;/database\u0026gt; \u0026lt;table\u0026gt;metric_log\u0026lt;/table\u0026gt; \u0026lt;flush_interval_milliseconds\u0026gt;7500\u0026lt;/flush_interval_milliseconds\u0026gt; \u0026lt;collect_interval_milliseconds\u0026gt;1000\u0026lt;/collect_interval_milliseconds\u0026gt; \u0026lt;/metric_log\u0026gt; \u0026lt;!-- Asynchronous metric log contains values of metrics from system.asynchronous_metrics. --\u0026gt; \u0026lt;asynchronous_metric_log\u0026gt; \u0026lt;database\u0026gt;system\u0026lt;/database\u0026gt; \u0026lt;table\u0026gt;asynchronous_metric_log\u0026lt;/table\u0026gt; \u0026lt;!-- Asynchronous metrics are updated once a minute, so there is no need to flush more often. --\u0026gt; \u0026lt;flush_interval_milliseconds\u0026gt;7000\u0026lt;/flush_interval_milliseconds\u0026gt; \u0026lt;/asynchronous_metric_log\u0026gt; \u0026lt;!-- OpenTelemetry log contains OpenTelemetry trace spans. --\u0026gt; \u0026lt;opentelemetry_span_log\u0026gt; \u0026lt;!-- The default table creation code is insufficient, this \u0026lt;engine\u0026gt; spec is a workaround. There is no \u0026#39;event_time\u0026#39; for this log, but two times, start and finish. It is sorted by finish time, to avoid inserting data too far away in the past (probably we can sometimes insert a span that is seconds earlier than the last span in the table, due to a race between several spans inserted in parallel). This gives the spans a global order that we can use to e.g. retry insertion into some external system. --\u0026gt; \u0026lt;engine\u0026gt; engine MergeTree partition by toYYYYMM(finish_date) order by (finish_date, finish_time_us, trace_id) \u0026lt;/engine\u0026gt; \u0026lt;database\u0026gt;system\u0026lt;/database\u0026gt; \u0026lt;table\u0026gt;opentelemetry_span_log\u0026lt;/table\u0026gt; \u0026lt;flush_interval_milliseconds\u0026gt;7500\u0026lt;/flush_interval_milliseconds\u0026gt; \u0026lt;/opentelemetry_span_log\u0026gt; \u0026lt;!-- Crash log. Stores stack traces for fatal errors. This table is normally empty. --\u0026gt; \u0026lt;crash_log\u0026gt; \u0026lt;database\u0026gt;system\u0026lt;/database\u0026gt; \u0026lt;table\u0026gt;crash_log\u0026lt;/table\u0026gt; \u0026lt;partition_by/\u0026gt; \u0026lt;flush_interval_milliseconds\u0026gt;1000\u0026lt;/flush_interval_milliseconds\u0026gt; \u0026lt;/crash_log\u0026gt; \u0026lt;!-- Session log. Stores user log in (successful or not) and log out events. --\u0026gt; \u0026lt;session_log\u0026gt; \u0026lt;database\u0026gt;system\u0026lt;/database\u0026gt; \u0026lt;table\u0026gt;session_log\u0026lt;/table\u0026gt; \u0026lt;partition_by\u0026gt;toYYYYMM(event_date)\u0026lt;/partition_by\u0026gt; \u0026lt;flush_interval_milliseconds\u0026gt;7500\u0026lt;/flush_interval_milliseconds\u0026gt; \u0026lt;/session_log\u0026gt; \u0026lt;!-- Parameters for embedded dictionaries, used in Yandex.Metrica. See https://clickhouse.com/docs/en/dicts/internal_dicts/ --\u0026gt; \u0026lt;!-- Path to file with region hierarchy. --\u0026gt; \u0026lt;!-- \u0026lt;path_to_regions_hierarchy_file\u0026gt;/opt/geo/regions_hierarchy.txt\u0026lt;/path_to_regions_hierarchy_file\u0026gt; --\u0026gt; \u0026lt;!-- Path to directory with files containing names of regions --\u0026gt; \u0026lt;!-- \u0026lt;path_to_regions_names_files\u0026gt;/opt/geo/\u0026lt;/path_to_regions_names_files\u0026gt; --\u0026gt; \u0026lt;!-- \u0026lt;top_level_domains_path\u0026gt;/var/lib/clickhouse/top_level_domains/\u0026lt;/top_level_domains_path\u0026gt; --\u0026gt; \u0026lt;!-- Custom TLD lists. Format: \u0026lt;name\u0026gt;/path/to/file\u0026lt;/name\u0026gt; Changes will not be applied w/o server restart. Path to the list is under top_level_domains_path (see above). --\u0026gt; \u0026lt;top_level_domains_lists\u0026gt; \u0026lt;!-- \u0026lt;public_suffix_list\u0026gt;/path/to/public_suffix_list.dat\u0026lt;/public_suffix_list\u0026gt; --\u0026gt; \u0026lt;/top_level_domains_lists\u0026gt; \u0026lt;!-- Configuration of external dictionaries. See: https://clickhouse.com/docs/en/sql-reference/dictionaries/external-dictionaries/external-dicts --\u0026gt; \u0026lt;dictionaries_config\u0026gt;*_dictionary.xml\u0026lt;/dictionaries_config\u0026gt; \u0026lt;!-- Configuration of user defined executable functions --\u0026gt; \u0026lt;user_defined_executable_functions_config\u0026gt;*_function.xml\u0026lt;/user_defined_executable_functions_config\u0026gt; \u0026lt;!-- Uncomment if you want data to be compressed 30-100% better. Don\u0026#39;t do that if you just started using ClickHouse. --\u0026gt; \u0026lt;!-- \u0026lt;compression\u0026gt; \u0026lt;!- - Set of variants. Checked in order. Last matching case wins. If nothing matches, lz4 will be used. - -\u0026gt; \u0026lt;case\u0026gt; \u0026lt;!- - Conditions. All must be satisfied. Some conditions may be omitted. - -\u0026gt; \u0026lt;min_part_size\u0026gt;10000000000\u0026lt;/min_part_size\u0026gt; \u0026lt;!- - Min part size in bytes. - -\u0026gt; \u0026lt;min_part_size_ratio\u0026gt;0.01\u0026lt;/min_part_size_ratio\u0026gt; \u0026lt;!- - Min size of part relative to whole table size. - -\u0026gt; \u0026lt;!- - What compression method to use. - -\u0026gt; \u0026lt;method\u0026gt;zstd\u0026lt;/method\u0026gt; \u0026lt;/case\u0026gt; \u0026lt;/compression\u0026gt; --\u0026gt; \u0026lt;!-- Configuration of encryption. The server executes a command to obtain an encryption key at startup if such a command is defined, or encryption codecs will be disabled otherwise. The command is executed through /bin/sh and is expected to write a Base64-encoded key to the stdout. --\u0026gt; \u0026lt;encryption_codecs\u0026gt; \u0026lt;!-- aes_128_gcm_siv --\u0026gt; \u0026lt;!-- Example of getting hex key from env --\u0026gt; \u0026lt;!-- the code should use this key and throw an exception if its length is not 16 bytes --\u0026gt; \u0026lt;!--key_hex from_env=\u0026#34;...\u0026#34;\u0026gt;\u0026lt;/key_hex --\u0026gt; \u0026lt;!-- Example of multiple hex keys. They can be imported from env or be written down in config--\u0026gt; \u0026lt;!-- the code should use these keys and throw an exception if their length is not 16 bytes --\u0026gt; \u0026lt;!-- key_hex id=\u0026#34;0\u0026#34;\u0026gt;...\u0026lt;/key_hex --\u0026gt; \u0026lt;!-- key_hex id=\u0026#34;1\u0026#34; from_env=\u0026#34;..\u0026#34;\u0026gt;\u0026lt;/key_hex --\u0026gt; \u0026lt;!-- key_hex id=\u0026#34;2\u0026#34;\u0026gt;...\u0026lt;/key_hex --\u0026gt; \u0026lt;!-- current_key_id\u0026gt;2\u0026lt;/current_key_id --\u0026gt; \u0026lt;!-- Example of getting hex key from config --\u0026gt; \u0026lt;!-- the code should use this key and throw an exception if its length is not 16 bytes --\u0026gt; \u0026lt;!-- key\u0026gt;...\u0026lt;/key --\u0026gt; \u0026lt;!-- example of adding nonce --\u0026gt; \u0026lt;!-- nonce\u0026gt;...\u0026lt;/nonce --\u0026gt; \u0026lt;!-- /aes_128_gcm_siv --\u0026gt; \u0026lt;/encryption_codecs\u0026gt; \u0026lt;!-- Allow to execute distributed DDL queries (CREATE, DROP, ALTER, RENAME) on cluster. Works only if ZooKeeper is enabled. Comment it if such functionality isn\u0026#39;t required. --\u0026gt; \u0026lt;distributed_ddl\u0026gt; \u0026lt;!-- Path in ZooKeeper to queue with DDL queries --\u0026gt; \u0026lt;path\u0026gt;/clickhouse/task_queue/ddl\u0026lt;/path\u0026gt; \u0026lt;!-- Settings from this profile will be used to execute DDL queries --\u0026gt; \u0026lt;!-- \u0026lt;profile\u0026gt;default\u0026lt;/profile\u0026gt; --\u0026gt; \u0026lt;!-- Controls how much ON CLUSTER queries can be run simultaneously. --\u0026gt; \u0026lt;!-- \u0026lt;pool_size\u0026gt;1\u0026lt;/pool_size\u0026gt; --\u0026gt; \u0026lt;!-- Cleanup settings (active tasks will not be removed) --\u0026gt; \u0026lt;!-- Controls task TTL (default 1 week) --\u0026gt; \u0026lt;!-- \u0026lt;task_max_lifetime\u0026gt;604800\u0026lt;/task_max_lifetime\u0026gt; --\u0026gt; \u0026lt;!-- Controls how often cleanup should be performed (in seconds) --\u0026gt; \u0026lt;!-- \u0026lt;cleanup_delay_period\u0026gt;60\u0026lt;/cleanup_delay_period\u0026gt; --\u0026gt; \u0026lt;!-- Controls how many tasks could be in the queue --\u0026gt; \u0026lt;!-- \u0026lt;max_tasks_in_queue\u0026gt;1000\u0026lt;/max_tasks_in_queue\u0026gt; --\u0026gt; \u0026lt;/distributed_ddl\u0026gt; \u0026lt;!-- Settings to fine tune MergeTree tables. See documentation in source code, in MergeTreeSettings.h --\u0026gt; \u0026lt;!-- \u0026lt;merge_tree\u0026gt; \u0026lt;max_suspicious_broken_parts\u0026gt;5\u0026lt;/max_suspicious_broken_parts\u0026gt; \u0026lt;/merge_tree\u0026gt; --\u0026gt; \u0026lt;!-- Protection from accidental DROP. If size of a MergeTree table is greater than max_table_size_to_drop (in bytes) than table could not be dropped with any DROP query. If you want do delete one table and don\u0026#39;t want to change clickhouse-server config, you could create special file \u0026lt;clickhouse-path\u0026gt;/flags/force_drop_table and make DROP once. By default max_table_size_to_drop is 50GB; max_table_size_to_drop=0 allows to DROP any tables. The same for max_partition_size_to_drop. Uncomment to disable protection. --\u0026gt; \u0026lt;!-- \u0026lt;max_table_size_to_drop\u0026gt;0\u0026lt;/max_table_size_to_drop\u0026gt; --\u0026gt; \u0026lt;!-- \u0026lt;max_partition_size_to_drop\u0026gt;0\u0026lt;/max_partition_size_to_drop\u0026gt; --\u0026gt; \u0026lt;!-- Example of parameters for GraphiteMergeTree table engine --\u0026gt; \u0026lt;graphite_rollup_example\u0026gt; \u0026lt;pattern\u0026gt; \u0026lt;regexp\u0026gt;click_cost\u0026lt;/regexp\u0026gt; \u0026lt;function\u0026gt;any\u0026lt;/function\u0026gt; \u0026lt;retention\u0026gt; \u0026lt;age\u0026gt;0\u0026lt;/age\u0026gt; \u0026lt;precision\u0026gt;3600\u0026lt;/precision\u0026gt; \u0026lt;/retention\u0026gt; \u0026lt;retention\u0026gt; \u0026lt;age\u0026gt;86400\u0026lt;/age\u0026gt; \u0026lt;precision\u0026gt;60\u0026lt;/precision\u0026gt; \u0026lt;/retention\u0026gt; \u0026lt;/pattern\u0026gt; \u0026lt;default\u0026gt; \u0026lt;function\u0026gt;max\u0026lt;/function\u0026gt; \u0026lt;retention\u0026gt; \u0026lt;age\u0026gt;0\u0026lt;/age\u0026gt; \u0026lt;precision\u0026gt;60\u0026lt;/precision\u0026gt; \u0026lt;/retention\u0026gt; \u0026lt;retention\u0026gt; \u0026lt;age\u0026gt;3600\u0026lt;/age\u0026gt; \u0026lt;precision\u0026gt;300\u0026lt;/precision\u0026gt; \u0026lt;/retention\u0026gt; \u0026lt;retention\u0026gt; \u0026lt;age\u0026gt;86400\u0026lt;/age\u0026gt; \u0026lt;precision\u0026gt;3600\u0026lt;/precision\u0026gt; \u0026lt;/retention\u0026gt; \u0026lt;/default\u0026gt; \u0026lt;/graphite_rollup_example\u0026gt; \u0026lt;!-- Directory in \u0026lt;clickhouse-path\u0026gt; containing schema files for various input formats. The directory will be created if it doesn\u0026#39;t exist. --\u0026gt; \u0026lt;format_schema_path\u0026gt;/var/lib/clickhouse/format_schemas/\u0026lt;/format_schema_path\u0026gt; \u0026lt;!-- Default query masking rules, matching lines would be replaced with something else in the logs (both text logs and system.query_log). name - name for the rule (optional) regexp - RE2 compatible regular expression (mandatory) replace - substitution string for sensitive data (optional, by default - six asterisks) --\u0026gt; \u0026lt;query_masking_rules\u0026gt; \u0026lt;rule\u0026gt; \u0026lt;name\u0026gt;hide encrypt/decrypt arguments\u0026lt;/name\u0026gt; \u0026lt;regexp\u0026gt;((?:aes_)?(?:encrypt|decrypt)(?:_mysql)?)\\s*\\(\\s*(?:\u0026#39;(?:\\\\\u0026#39;|.)+\u0026#39;|.*?)\\s*\\)\u0026lt;/regexp\u0026gt; \u0026lt;!-- or more secure, but also more invasive: (aes_\\w+)\\s*\\(.*\\) --\u0026gt; \u0026lt;replace\u0026gt;\\1(???)\u0026lt;/replace\u0026gt; \u0026lt;/rule\u0026gt; \u0026lt;/query_masking_rules\u0026gt; \u0026lt;!-- Uncomment to use custom http handlers. rules are checked from top to bottom, first match runs the handler url - to match request URL, you can use \u0026#39;regex:\u0026#39; prefix to use regex match(optional) methods - to match request method, you can use commas to separate multiple method matches(optional) headers - to match request headers, match each child element(child element name is header name), you can use \u0026#39;regex:\u0026#39; prefix to use regex match(optional) handler is request handler type - supported types: static, dynamic_query_handler, predefined_query_handler query - use with predefined_query_handler type, executes query when the handler is called query_param_name - use with dynamic_query_handler type, extracts and executes the value corresponding to the \u0026lt;query_param_name\u0026gt; value in HTTP request params status - use with static type, response status code content_type - use with static type, response content-type response_content - use with static type, Response content sent to client, when using the prefix \u0026#39;file://\u0026#39; or \u0026#39;config://\u0026#39;, find the content from the file or configuration send to client. \u0026lt;http_handlers\u0026gt; \u0026lt;rule\u0026gt; \u0026lt;url\u0026gt;/\u0026lt;/url\u0026gt; \u0026lt;methods\u0026gt;POST,GET\u0026lt;/methods\u0026gt; \u0026lt;headers\u0026gt;\u0026lt;pragma\u0026gt;no-cache\u0026lt;/pragma\u0026gt;\u0026lt;/headers\u0026gt; \u0026lt;handler\u0026gt; \u0026lt;type\u0026gt;dynamic_query_handler\u0026lt;/type\u0026gt; \u0026lt;query_param_name\u0026gt;query\u0026lt;/query_param_name\u0026gt; \u0026lt;/handler\u0026gt; \u0026lt;/rule\u0026gt; \u0026lt;rule\u0026gt; \u0026lt;url\u0026gt;/predefined_query\u0026lt;/url\u0026gt; \u0026lt;methods\u0026gt;POST,GET\u0026lt;/methods\u0026gt; \u0026lt;handler\u0026gt; \u0026lt;type\u0026gt;predefined_query_handler\u0026lt;/type\u0026gt; \u0026lt;query\u0026gt;SELECT * FROM system.settings\u0026lt;/query\u0026gt; \u0026lt;/handler\u0026gt; \u0026lt;/rule\u0026gt; \u0026lt;rule\u0026gt; \u0026lt;handler\u0026gt; \u0026lt;type\u0026gt;static\u0026lt;/type\u0026gt; \u0026lt;status\u0026gt;200\u0026lt;/status\u0026gt; \u0026lt;content_type\u0026gt;text/plain; charset=UTF-8\u0026lt;/content_type\u0026gt; \u0026lt;response_content\u0026gt;config://http_server_default_response\u0026lt;/response_content\u0026gt; \u0026lt;/handler\u0026gt; \u0026lt;/rule\u0026gt; \u0026lt;/http_handlers\u0026gt; --\u0026gt; \u0026lt;send_crash_reports\u0026gt; \u0026lt;!-- Changing \u0026lt;enabled\u0026gt; to true allows sending crash reports to --\u0026gt; \u0026lt;!-- the ClickHouse core developers team via Sentry https://sentry.io --\u0026gt; \u0026lt;!-- Doing so at least in pre-production environments is highly appreciated --\u0026gt; \u0026lt;enabled\u0026gt;false\u0026lt;/enabled\u0026gt; \u0026lt;!-- Change \u0026lt;anonymize\u0026gt; to true if you don\u0026#39;t feel comfortable attaching the server hostname to the crash report --\u0026gt; \u0026lt;anonymize\u0026gt;false\u0026lt;/anonymize\u0026gt; \u0026lt;!-- Default endpoint s hould be changed to different Sentry DSN only if you have --\u0026gt; \u0026lt;!-- some in-house engineers or hired consultants who\u0026#39;re going to debug ClickHouse issues for you --\u0026gt; \u0026lt;endpoint\u0026gt;\u0026lt;/endpoint\u0026gt; \u0026lt;/send_crash_reports\u0026gt; \u0026lt;!-- Uncomment to disable ClickHouse internal DNS caching. --\u0026gt; \u0026lt;!-- \u0026lt;disable_internal_dns_cache\u0026gt;1\u0026lt;/disable_internal_dns_cache\u0026gt; --\u0026gt; \u0026lt;!-- You can also configure rocksdb like this: --\u0026gt; \u0026lt;!-- \u0026lt;rocksdb\u0026gt; \u0026lt;options\u0026gt; \u0026lt;max_background_jobs\u0026gt;8\u0026lt;/max_background_jobs\u0026gt; \u0026lt;/options\u0026gt; \u0026lt;column_family_options\u0026gt; \u0026lt;num_levels\u0026gt;2\u0026lt;/num_levels\u0026gt; \u0026lt;/column_family_options\u0026gt; \u0026lt;tables\u0026gt; \u0026lt;table\u0026gt; \u0026lt;name\u0026gt;TABLE\u0026lt;/name\u0026gt; \u0026lt;options\u0026gt; \u0026lt;max_background_jobs\u0026gt;8\u0026lt;/max_background_jobs\u0026gt; \u0026lt;/options\u0026gt; \u0026lt;column_family_options\u0026gt; \u0026lt;num_levels\u0026gt;2\u0026lt;/num_levels\u0026gt; \u0026lt;/column_family_options\u0026gt; \u0026lt;/table\u0026gt; \u0026lt;/tables\u0026gt; \u0026lt;/rocksdb\u0026gt; --\u0026gt; \u0026lt;timezone\u0026gt;Asia/Shanghai\u0026lt;/timezone\u0026gt; \u0026lt;/clickhouse\u0026gt; 启动命令 docker-compose up -d TODO 现在配置的 zookeeper 还是单机部署的，有空看看部署个zookeeper集群怎么配置\n","keywords":["clickhouse","笔记","docker","docker-compose"],"articleBody":"Docker Compose 配置 version: '3' services: clickhouse-server-ck1: restart: on-failure:10 # 退出非0重启，尝试10次 image: yandex/clickhouse-server container_name: ck1 networks: - ck-network ports: - \"8124:8123\" - \"9001:9000\" - \"9010:9004\" volumes: - `pwd`/clickhouse/:/var/lib/clickhouse/ - `pwd`/clickhouse-server/:/etc/clickhouse-server/ - `pwd`/log/clickhouse-server/:/var/log/clickhouse-server/ ulimits: nofile: soft: \"262144\" hard: \"262144\" depends_on: - zookeeper-1 clickhouse-server-ck2: restart: on-failure:10 # 退出非0重启，尝试10次 image: yandex/clickhouse-server container_name: ck2 networks: - ck-network ports: - \"8125:8123\" - \"9002:9000\" - \"9011:9004\" volumes: - `pwd`/clickhouse2/:/var/lib/clickhouse/ - `pwd`/clickhouse-server2/:/etc/clickhouse-server/ - `pwd`/log/clickhouse-server2/:/var/log/clickhouse-server/ ulimits: nofile: soft: \"262144\" hard: \"262144\" depends_on: - zookeeper-1 clickhouse-server-ck3: restart: on-failure:10 # 退出非0重启，尝试10次 image: yandex/clickhouse-server container_name: ck3 networks: - ck-network ports: - \"8126:8123\" - \"9003:9000\" - \"9012:9004\" volumes: - `pwd`/clickhouse3/:/var/lib/clickhouse/ - `pwd`/clickhouse-server3/:/etc/clickhouse-server/ - `pwd`/log/clickhouse-server3/:/var/log/clickhouse-server/ ulimits: nofile: soft: \"262144\" hard: \"262144\" depends_on: - zookeeper-1 zookeeper-1: restart: on-failure:10 # 退出非0重启，尝试10次 image: zookeeper:3.8.0 container_name: zookeeper1 networks: - ck-network ports: - \"2181:2181\" volumes: - `pwd`/zookeeper/conf/:/apache-zookeeper-3.8.0-bin/conf/ - `pwd`/zookeeper/data/:/data - `pwd`/zookeeper/datalog/:/datalog - `pwd`/zookeeper/logs/:/logs ulimits: nofile: soft: \"262144\" hard: \"262144\" networks: ck-network: Clickhouse 配置文件 \u003c?xml version=\"1.0\"?\u003e trace /var/log/clickhouse-server/clickhouse-server.log /var/log/clickhouse-server/clickhouse-server.err.log 1000M 10 8123 9000 9004 9005 9009 0.0.0.0 0.0.0.0 4096 3 false /path/to/ssl_cert_file /path/to/ssl_key_file false /path/to/ssl_ca_cert_file deflate medium -1 -1 false /etc/clickhouse-server/server.crt /etc/clickhouse-server/server.key /etc/clickhouse-server/dhparam.pem none true true sslv2,sslv3 true true true sslv2,sslv3 true RejectCertificateHandler 100 0 10000 0.9 4194304 0 8589934592 5368709120 1000 134217728 10000 /var/lib/clickhouse/ /var/lib/clickhouse/tmp/ /var/lib/clickhouse/user_files/ users.xml /var/lib/clickhouse/access/ default default true false \u003c![CDATA[ Uncomment below in order to use JDBC table engine and function. To install and run JDBC bridge in background: * [Debian/Ubuntu] export MVN_URL=https://repo1.maven.org/maven2/ru/yandex/clickhouse/clickhouse-jdbc-bridge export PKG_VER=$(curl -sL $MVN_URL/maven-metadata.xml | grep '' | sed -e 's|.*\u003e\\(.*\\)\u003c.*|\\1|') wget https://github.com/ClickHouse/clickhouse-jdbc-bridge/releases/download/v$PKG_VER/clickhouse-jdbc-bridge_$PKG_VER-1_all.deb apt install --no-install-recommends -f ./clickhouse-jdbc-bridge_$PKG_VER-1_all.deb clickhouse-jdbc-bridge \u0026 * [CentOS/RHEL] export MVN_URL=https://repo1.maven.org/maven2/ru/yandex/clickhouse/clickhouse-jdbc-bridge export PKG_VER=$(curl -sL $MVN_URL/maven-metadata.xml | grep '' | sed -e 's|.*\u003e\\(.*\\)\u003c.*|\\1|') wget https://github.com/ClickHouse/clickhouse-jdbc-bridge/releases/download/v$PKG_VER/clickhouse-jdbc-bridge-$PKG_VER-1.noarch.rpm yum localinstall -y clickhouse-jdbc-bridge-$PKG_VER-1.noarch.rpm clickhouse-jdbc-bridge \u0026 Please refer to https://github.com/ClickHouse/clickhouse-jdbc-bridge#usage for more information. ]]\u003e 1 false ck1 9000 1 false ck2 9000 1 false ck3 9000 ck1 01 01 zookeeper1 2181 3600 3600 60 system query_log toYYYYMM(event_date) 7500 system trace_log toYYYYMM(event_date) 7500 system query_thread_log toYYYYMM(event_date) 7500 system query_views_log toYYYYMM(event_date) 7500 system part_log toYYYYMM(event_date) 7500 system metric_log 7500 1000 system asynchronous_metric_log 7000 engine MergeTree partition by toYYYYMM(finish_date) order by (finish_date, finish_time_us, trace_id) system opentelemetry_span_log 7500 system crash_log 1000 system session_log toYYYYMM(event_date) 7500 *_dictionary.xml *_function.xml /clickhouse/task_queue/ddl click_cost any 0 3600 86400 60 max 0 60 3600 300 86400 3600 /var/lib/clickhouse/format_schemas/ hide encrypt/decrypt arguments ((?:aes_)?(?:encrypt|decrypt)(?:_mysql)?)\\s*\\(\\s*(?:'(?:\\\\'|.)+'|.*?)\\s*\\) \\1(???) false false Asia/Shanghai 启动命令 docker-compose up -d TODO 现在配置的 zookeeper 还是单机部署的，有空看看部署个zookeeper集群怎么配置\n","wordCount":"5510","inLanguage":"en","datePublished":"2022-08-12T17:30:00+08:00","dateModified":"2022-08-12T17:30:00+08:00","author":{"@type":"Person","name":"johnpoint"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.lvcshu.com/2022/08/12/deploy-clickhouse-by-docker-compose/"},"publisher":{"@type":"Organization","name":"johnpoint's blog","logo":{"@type":"ImageObject","url":"https://blog.lvcshu.com/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://blog.lvcshu.com/ accesskey=h title="johnpoint's blog (Alt + H)">johnpoint's blog</a><div class=logo-switches><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://blog.lvcshu.com/posts/ title=归档><span>归档</span></a></li><li><a href=https://blog.lvcshu.com/friends/ title=友链><span>友链</span></a></li><li><a href=https://blog.lvcshu.com/about/ title=关于我><span>关于我</span></a></li><li><a href=https://blog.lvcshu.com/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">使用 docker-compose 搭建 clickhouse 集群</h1><div class=post-meta><span title='2022-08-12 17:30:00 +0800 CST'>2022-08-12 17:30:00</span>&nbsp;·&nbsp;26 min&nbsp;·&nbsp;5510 words&nbsp;·&nbsp;johnpoint</div></header><div class=post-content><h3 id=docker-compose-配置>Docker Compose 配置<a hidden class=anchor aria-hidden=true href=#docker-compose-配置>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>clickhouse-server-ck1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=kc>on</span>-<span class=l>failure:10</span><span class=w> </span><span class=c># 退出非0重启，尝试10次</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>yandex/clickhouse-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>ck1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ck-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;8124:8123&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;9001:9000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;9010:9004&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>`pwd`/clickhouse/:/var/lib/clickhouse/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>`pwd`/clickhouse-server/:/etc/clickhouse-server/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>`pwd`/log/clickhouse-server/:/var/log/clickhouse-server/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ulimits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>nofile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>soft</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;262144&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>hard</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;262144&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>zookeeper-1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>clickhouse-server-ck2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=kc>on</span>-<span class=l>failure:10</span><span class=w> </span><span class=c># 退出非0重启，尝试10次</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>yandex/clickhouse-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>ck2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ck-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;8125:8123&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;9002:9000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;9011:9004&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>`pwd`/clickhouse2/:/var/lib/clickhouse/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>`pwd`/clickhouse-server2/:/etc/clickhouse-server/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>`pwd`/log/clickhouse-server2/:/var/log/clickhouse-server/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ulimits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>nofile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>soft</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;262144&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>hard</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;262144&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>zookeeper-1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>clickhouse-server-ck3</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=kc>on</span>-<span class=l>failure:10</span><span class=w> </span><span class=c># 退出非0重启，尝试10次</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>yandex/clickhouse-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>ck3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ck-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;8126:8123&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;9003:9000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;9012:9004&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>`pwd`/clickhouse3/:/var/lib/clickhouse/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>`pwd`/clickhouse-server3/:/etc/clickhouse-server/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>`pwd`/log/clickhouse-server3/:/var/log/clickhouse-server/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ulimits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>nofile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>soft</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;262144&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>hard</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;262144&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>zookeeper-1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zookeeper-1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=kc>on</span>-<span class=l>failure:10</span><span class=w> </span><span class=c># 退出非0重启，尝试10次</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper:3.8.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ck-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;2181:2181&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>`pwd`/zookeeper/conf/:/apache-zookeeper-3.8.0-bin/conf/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>`pwd`/zookeeper/data/:/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>`pwd`/zookeeper/datalog/:/datalog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>`pwd`/zookeeper/logs/:/logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ulimits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>nofile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>soft</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;262144&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>hard</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;262144&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ck-network</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></div><h3 id=clickhouse-配置文件>Clickhouse 配置文件<a hidden class=anchor aria-hidden=true href=#clickhouse-配置文件>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>  NOTE: User and query level settings are set up in &#34;users.xml&#34; file.
</span></span></span><span class=line><span class=cl><span class=c>  If you have accidentally specified user-level settings here, server won&#39;t start.
</span></span></span><span class=line><span class=cl><span class=c>  You can either move the settings to the right place inside &#34;users.xml&#34; file
</span></span></span><span class=line><span class=cl><span class=c>   or add &lt;skip_check_for_incorrect_settings&gt;1&lt;/skip_check_for_incorrect_settings&gt; here.
</span></span></span><span class=line><span class=cl><span class=c>--&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;clickhouse&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;logger&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Possible levels [1]:
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>          - none (turns off logging)
</span></span></span><span class=line><span class=cl><span class=c>          - fatal
</span></span></span><span class=line><span class=cl><span class=c>          - critical
</span></span></span><span class=line><span class=cl><span class=c>          - error
</span></span></span><span class=line><span class=cl><span class=c>          - warning
</span></span></span><span class=line><span class=cl><span class=c>          - notice
</span></span></span><span class=line><span class=cl><span class=c>          - information
</span></span></span><span class=line><span class=cl><span class=c>          - debug
</span></span></span><span class=line><span class=cl><span class=c>          - trace
</span></span></span><span class=line><span class=cl><span class=c>          - test (not for production usage)
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>            [1]: https://github.com/pocoproject/poco/blob/poco-1.9.4-release/Foundation/include/Poco/Logger.h#L105-L114
</span></span></span><span class=line><span class=cl><span class=c>        --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;level&gt;</span>trace<span class=nt>&lt;/level&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;log&gt;</span>/var/log/clickhouse-server/clickhouse-server.log<span class=nt>&lt;/log&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;errorlog&gt;</span>/var/log/clickhouse-server/clickhouse-server.err.log<span class=nt>&lt;/errorlog&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Rotation policy
</span></span></span><span class=line><span class=cl><span class=c>             See https://github.com/pocoproject/poco/blob/poco-1.9.4-release/Foundation/include/Poco/FileChannel.h#L54-L85
</span></span></span><span class=line><span class=cl><span class=c>          --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;size&gt;</span>1000M<span class=nt>&lt;/size&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;count&gt;</span>10<span class=nt>&lt;/count&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- &lt;console&gt;1&lt;/console&gt; --&gt;</span> <span class=c>&lt;!-- Default behavior is autodetection (log to console if not daemon mode and is tty) --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Per level overrides (legacy):
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>        For example to suppress logging of the ConfigReloader you can use:
</span></span></span><span class=line><span class=cl><span class=c>        NOTE: levels.logger is reserved, see below.
</span></span></span><span class=line><span class=cl><span class=c>        --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>        &lt;levels&gt;
</span></span></span><span class=line><span class=cl><span class=c>          &lt;ConfigReloader&gt;none&lt;/ConfigReloader&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;/levels&gt;
</span></span></span><span class=line><span class=cl><span class=c>        --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Per level overrides:
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>        For example to suppress logging of the RBAC for default user you can use:
</span></span></span><span class=line><span class=cl><span class=c>        (But please note that the logger name maybe changed from version to version, even after minor upgrade)
</span></span></span><span class=line><span class=cl><span class=c>        --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>        &lt;levels&gt;
</span></span></span><span class=line><span class=cl><span class=c>          &lt;logger&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;name&gt;ContextAccess (default)&lt;/name&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;level&gt;none&lt;/level&gt;
</span></span></span><span class=line><span class=cl><span class=c>          &lt;/logger&gt;
</span></span></span><span class=line><span class=cl><span class=c>          &lt;logger&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;name&gt;DatabaseOrdinary (test)&lt;/name&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;level&gt;none&lt;/level&gt;
</span></span></span><span class=line><span class=cl><span class=c>          &lt;/logger&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;/levels&gt;
</span></span></span><span class=line><span class=cl><span class=c>        --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/logger&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Add headers to response in options request. OPTIONS method is used in CORS preflight requests. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- It is off by default. Next headers are obligate for CORS.--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- http_options_response&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;header&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;name&gt;Access-Control-Allow-Origin&lt;/name&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;value&gt;*&lt;/value&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;/header&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;header&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;name&gt;Access-Control-Allow-Headers&lt;/name&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;value&gt;origin, x-requested-with&lt;/value&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;/header&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;header&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;name&gt;Access-Control-Allow-Methods&lt;/name&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;value&gt;POST, GET, OPTIONS&lt;/value&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;/header&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;header&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;name&gt;Access-Control-Max-Age&lt;/name&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;value&gt;86400&lt;/value&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;/header&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;/http_options_response --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- It is the name that will be shown in the clickhouse-client.
</span></span></span><span class=line><span class=cl><span class=c>         By default, anything with &#34;production&#34; will be highlighted in red in query prompt.
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--display_name&gt;production&lt;/display_name--&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Port for HTTP API. See also &#39;https_port&#39; for secure connections.
</span></span></span><span class=line><span class=cl><span class=c>         This interface is also used by ODBC and JDBC drivers (DataGrip, Dbeaver, ...)
</span></span></span><span class=line><span class=cl><span class=c>         and by most of web interfaces (embedded UI, Grafana, Redash, ...).
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;http_port&gt;</span>8123<span class=nt>&lt;/http_port&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Port for interaction by native protocol with:
</span></span></span><span class=line><span class=cl><span class=c>         - clickhouse-client and other native ClickHouse tools (clickhouse-benchmark, clickhouse-copier);
</span></span></span><span class=line><span class=cl><span class=c>         - clickhouse-server with other clickhouse-servers for distributed query processing;
</span></span></span><span class=line><span class=cl><span class=c>         - ClickHouse drivers and applications supporting native protocol
</span></span></span><span class=line><span class=cl><span class=c>         (this protocol is also informally called as &#34;the TCP protocol&#34;);
</span></span></span><span class=line><span class=cl><span class=c>         See also &#39;tcp_port_secure&#39; for secure connections.
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;tcp_port&gt;</span>9000<span class=nt>&lt;/tcp_port&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Compatibility with MySQL protocol.
</span></span></span><span class=line><span class=cl><span class=c>         ClickHouse will pretend to be MySQL for applications connecting to this port.
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;mysql_port&gt;</span>9004<span class=nt>&lt;/mysql_port&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Compatibility with PostgreSQL protocol.
</span></span></span><span class=line><span class=cl><span class=c>         ClickHouse will pretend to be PostgreSQL for applications connecting to this port.
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;postgresql_port&gt;</span>9005<span class=nt>&lt;/postgresql_port&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- HTTP API with TLS (HTTPS).
</span></span></span><span class=line><span class=cl><span class=c>         You have to configure certificate to enable this interface.
</span></span></span><span class=line><span class=cl><span class=c>         See the openSSL section below.
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;https_port&gt;8443&lt;/https_port&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Native interface with TLS.
</span></span></span><span class=line><span class=cl><span class=c>         You have to configure certificate to enable this interface.
</span></span></span><span class=line><span class=cl><span class=c>         See the openSSL section below.
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;tcp_port_secure&gt;9440&lt;/tcp_port_secure&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Native interface wrapped with PROXYv1 protocol
</span></span></span><span class=line><span class=cl><span class=c>         PROXYv1 header sent for every connection.
</span></span></span><span class=line><span class=cl><span class=c>         ClickHouse will extract information about proxy-forwarded client address from the header.
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;tcp_with_proxy_port&gt;9011&lt;/tcp_with_proxy_port&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Port for communication between replicas. Used for data exchange.
</span></span></span><span class=line><span class=cl><span class=c>         It provides low-level data access between servers.
</span></span></span><span class=line><span class=cl><span class=c>         This port should not be accessible from untrusted networks.
</span></span></span><span class=line><span class=cl><span class=c>         See also &#39;interserver_http_credentials&#39;.
</span></span></span><span class=line><span class=cl><span class=c>         Data transferred over connections to this port should not go through untrusted networks.
</span></span></span><span class=line><span class=cl><span class=c>         See also &#39;interserver_https_port&#39;.
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;interserver_http_port&gt;</span>9009<span class=nt>&lt;/interserver_http_port&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Port for communication between replicas with TLS.
</span></span></span><span class=line><span class=cl><span class=c>         You have to configure certificate to enable this interface.
</span></span></span><span class=line><span class=cl><span class=c>         See the openSSL section below.
</span></span></span><span class=line><span class=cl><span class=c>         See also &#39;interserver_http_credentials&#39;.
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;interserver_https_port&gt;9010&lt;/interserver_https_port&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Hostname that is used by other replicas to request this server.
</span></span></span><span class=line><span class=cl><span class=c>         If not specified, than it is determined analogous to &#39;hostname -f&#39; command.
</span></span></span><span class=line><span class=cl><span class=c>         This setting could be used to switch replication to another network interface
</span></span></span><span class=line><span class=cl><span class=c>         (the server may be connected to multiple networks via multiple addresses)
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;interserver_http_host&gt;</span>0.0.0.0<span class=nt>&lt;/interserver_http_host&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- You can specify credentials for authenthication between replicas.
</span></span></span><span class=line><span class=cl><span class=c>         This is required when interserver_https_port is accessible from untrusted networks,
</span></span></span><span class=line><span class=cl><span class=c>         and also recommended to avoid SSRF attacks from possibly compromised services in your network.
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--&lt;interserver_http_credentials&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;user&gt;interserver&lt;/user&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;password&gt;&lt;/password&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;/interserver_http_credentials&gt;--&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Listen specified address.
</span></span></span><span class=line><span class=cl><span class=c>         Use :: (wildcard IPv6 address), if you want to accept connections both with IPv4 and IPv6 from everywhere.
</span></span></span><span class=line><span class=cl><span class=c>         Notes:
</span></span></span><span class=line><span class=cl><span class=c>         If you open connections from wildcard address, make sure that at least one of the following measures applied:
</span></span></span><span class=line><span class=cl><span class=c>         - server is protected by firewall and not accessible from untrusted networks;
</span></span></span><span class=line><span class=cl><span class=c>         - all users are restricted to subset of network addresses (see users.xml);
</span></span></span><span class=line><span class=cl><span class=c>         - all users have strong passwords, only secure (TLS) interfaces are accessible, or connections are only made via TLS interfaces.
</span></span></span><span class=line><span class=cl><span class=c>         - users without password have readonly access.
</span></span></span><span class=line><span class=cl><span class=c>         See also: https://www.shodan.io/search?query=clickhouse
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;listen_host&gt;::&lt;/listen_host&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Same for hosts without support for IPv6: --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;listen_host&gt;</span>0.0.0.0<span class=nt>&lt;/listen_host&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Default values - try listen localhost on IPv4 and IPv6. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>    &lt;listen_host&gt;::1&lt;/listen_host&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;listen_host&gt;127.0.0.1&lt;/listen_host&gt;
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Don&#39;t exit if IPv6 or IPv4 networks are unavailable while trying to listen. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;listen_try&gt;0&lt;/listen_try&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Allow multiple servers to listen on the same address:port. This is not recommended.
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;listen_reuse_port&gt;0&lt;/listen_reuse_port&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;listen_backlog&gt;4096&lt;/listen_backlog&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;max_connections&gt;</span>4096<span class=nt>&lt;/max_connections&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- For &#39;Connection: keep-alive&#39; in HTTP 1.1 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;keep_alive_timeout&gt;</span>3<span class=nt>&lt;/keep_alive_timeout&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- gRPC protocol (see src/Server/grpc_protos/clickhouse_grpc.proto for the API) --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;grpc_port&gt;9100&lt;/grpc_port&gt; --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;grpc&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;enable_ssl&gt;</span>false<span class=nt>&lt;/enable_ssl&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- The following two files are used only if enable_ssl=1 --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;ssl_cert_file&gt;</span>/path/to/ssl_cert_file<span class=nt>&lt;/ssl_cert_file&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;ssl_key_file&gt;</span>/path/to/ssl_key_file<span class=nt>&lt;/ssl_key_file&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Whether server will request client for a certificate --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;ssl_require_client_auth&gt;</span>false<span class=nt>&lt;/ssl_require_client_auth&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- The following file is used only if ssl_require_client_auth=1 --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;ssl_ca_cert_file&gt;</span>/path/to/ssl_ca_cert_file<span class=nt>&lt;/ssl_ca_cert_file&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Default compression algorithm (applied if client doesn&#39;t specify another algorithm, see result_compression in QueryInfo).
</span></span></span><span class=line><span class=cl><span class=c>             Supported algorithms: none, deflate, gzip, stream_gzip --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;compression&gt;</span>deflate<span class=nt>&lt;/compression&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Default compression level (applied if client doesn&#39;t specify another level, see result_compression in QueryInfo).
</span></span></span><span class=line><span class=cl><span class=c>             Supported levels: none, low, medium, high --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;compression_level&gt;</span>medium<span class=nt>&lt;/compression_level&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Send/receive message size limits in bytes. -1 means unlimited --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;max_send_message_size&gt;</span>-1<span class=nt>&lt;/max_send_message_size&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;max_receive_message_size&gt;</span>-1<span class=nt>&lt;/max_receive_message_size&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Enable if you want very detailed logs --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;verbose_logs&gt;</span>false<span class=nt>&lt;/verbose_logs&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/grpc&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Used with https_port and tcp_port_secure. Full ssl options list: https://github.com/ClickHouse-Extras/poco/blob/master/NetSSL_OpenSSL/include/Poco/Net/SSLManager.h#L71 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;openSSL&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;server&gt;</span> <span class=c>&lt;!-- Used for https server AND secure tcp port --&gt;</span>
</span></span><span class=line><span class=cl>            <span class=c>&lt;!-- openssl req -subj &#34;/CN=localhost&#34; -new -newkey rsa:2048 -days 365 -nodes -x509 -keyout /etc/clickhouse-server/server.key -out /etc/clickhouse-server/server.crt --&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;certificateFile&gt;</span>/etc/clickhouse-server/server.crt<span class=nt>&lt;/certificateFile&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;privateKeyFile&gt;</span>/etc/clickhouse-server/server.key<span class=nt>&lt;/privateKeyFile&gt;</span>
</span></span><span class=line><span class=cl>            <span class=c>&lt;!-- dhparams are optional. You can delete the &lt;dhParamsFile&gt; element.
</span></span></span><span class=line><span class=cl><span class=c>                 To generate dhparams, use the following command:
</span></span></span><span class=line><span class=cl><span class=c>                  openssl dhparam -out /etc/clickhouse-server/dhparam.pem 4096
</span></span></span><span class=line><span class=cl><span class=c>                 Only file format with BEGIN DH PARAMETERS is supported.
</span></span></span><span class=line><span class=cl><span class=c>              --&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;dhParamsFile&gt;</span>/etc/clickhouse-server/dhparam.pem<span class=nt>&lt;/dhParamsFile&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;verificationMode&gt;</span>none<span class=nt>&lt;/verificationMode&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;loadDefaultCAFile&gt;</span>true<span class=nt>&lt;/loadDefaultCAFile&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;cacheSessions&gt;</span>true<span class=nt>&lt;/cacheSessions&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;disableProtocols&gt;</span>sslv2,sslv3<span class=nt>&lt;/disableProtocols&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;preferServerCiphers&gt;</span>true<span class=nt>&lt;/preferServerCiphers&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/server&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;client&gt;</span> <span class=c>&lt;!-- Used for connecting to https dictionary source and secured Zookeeper communication --&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;loadDefaultCAFile&gt;</span>true<span class=nt>&lt;/loadDefaultCAFile&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;cacheSessions&gt;</span>true<span class=nt>&lt;/cacheSessions&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;disableProtocols&gt;</span>sslv2,sslv3<span class=nt>&lt;/disableProtocols&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;preferServerCiphers&gt;</span>true<span class=nt>&lt;/preferServerCiphers&gt;</span>
</span></span><span class=line><span class=cl>            <span class=c>&lt;!-- Use for self-signed: &lt;verificationMode&gt;none&lt;/verificationMode&gt; --&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;invalidCertificateHandler&gt;</span>
</span></span><span class=line><span class=cl>                <span class=c>&lt;!-- Use for self-signed: &lt;name&gt;AcceptCertificateHandler&lt;/name&gt; --&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;name&gt;</span>RejectCertificateHandler<span class=nt>&lt;/name&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/invalidCertificateHandler&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/client&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/openSSL&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Default root page on http[s] server. For example load UI from https://tabix.io/ when opening http://localhost:8123 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>    &lt;http_server_default_response&gt;&lt;![CDATA[&lt;html ng-app=&#34;SMI2&#34;&gt;&lt;head&gt;&lt;base href=&#34;http://ui.tabix.io/&#34;&gt;&lt;/head&gt;&lt;body&gt;&lt;div ui-view=&#34;&#34; class=&#34;content-ui&#34;&gt;&lt;/div&gt;&lt;script src=&#34;http://loader.tabix.io/master.js&#34;&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;]]&gt;&lt;/http_server_default_response&gt;
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Maximum number of concurrent queries. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;max_concurrent_queries&gt;</span>100<span class=nt>&lt;/max_concurrent_queries&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Maximum memory usage (resident set size) for server process.
</span></span></span><span class=line><span class=cl><span class=c>         Zero value or unset means default. Default is &#34;max_server_memory_usage_to_ram_ratio&#34; of available physical RAM.
</span></span></span><span class=line><span class=cl><span class=c>         If the value is larger than &#34;max_server_memory_usage_to_ram_ratio&#34; of available physical RAM, it will be cut down.
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>         The constraint is checked on query execution time.
</span></span></span><span class=line><span class=cl><span class=c>         If a query tries to allocate memory and the current memory usage plus allocation is greater
</span></span></span><span class=line><span class=cl><span class=c>          than specified threshold, exception will be thrown.
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>         It is not practical to set this constraint to small values like just a few gigabytes,
</span></span></span><span class=line><span class=cl><span class=c>          because memory allocator will keep this amount of memory in caches and the server will deny service of queries.
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;max_server_memory_usage&gt;</span>0<span class=nt>&lt;/max_server_memory_usage&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Maximum number of threads in the Global thread pool.
</span></span></span><span class=line><span class=cl><span class=c>    This will default to a maximum of 10000 threads if not specified.
</span></span></span><span class=line><span class=cl><span class=c>    This setting will be useful in scenarios where there are a large number
</span></span></span><span class=line><span class=cl><span class=c>    of distributed queries that are running concurrently but are idling most
</span></span></span><span class=line><span class=cl><span class=c>    of the time, in which case a higher number of threads might be required.
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;max_thread_pool_size&gt;</span>10000<span class=nt>&lt;/max_thread_pool_size&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Number of workers to recycle connections in background (see also drain_timeout).
</span></span></span><span class=line><span class=cl><span class=c>         If the pool is full, connection will be drained synchronously. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;max_threads_for_connection_collector&gt;10&lt;/max_threads_for_connection_collector&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- On memory constrained environments you may have to set this to value larger than 1.
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;max_server_memory_usage_to_ram_ratio&gt;</span>0.9<span class=nt>&lt;/max_server_memory_usage_to_ram_ratio&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Simple server-wide memory profiler. Collect a stack trace at every peak allocation step (in bytes).
</span></span></span><span class=line><span class=cl><span class=c>         Data will be stored in system.trace_log table with query_id = empty string.
</span></span></span><span class=line><span class=cl><span class=c>         Zero means disabled.
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;total_memory_profiler_step&gt;</span>4194304<span class=nt>&lt;/total_memory_profiler_step&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Collect random allocations and deallocations and write them into system.trace_log with &#39;MemorySample&#39; trace_type.
</span></span></span><span class=line><span class=cl><span class=c>         The probability is for every alloc/free regardless to the size of the allocation.
</span></span></span><span class=line><span class=cl><span class=c>         Note that sampling happens only when the amount of untracked memory exceeds the untracked memory limit,
</span></span></span><span class=line><span class=cl><span class=c>          which is 4 MiB by default but can be lowered if &#39;total_memory_profiler_step&#39; is lowered.
</span></span></span><span class=line><span class=cl><span class=c>         You may want to set &#39;total_memory_profiler_step&#39; to 1 for extra fine grained sampling.
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;total_memory_tracker_sample_probability&gt;</span>0<span class=nt>&lt;/total_memory_tracker_sample_probability&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Set limit on number of open files (default: maximum). This setting makes sense on Mac OS X because getrlimit() fails to retrieve
</span></span></span><span class=line><span class=cl><span class=c>         correct maximum value. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;max_open_files&gt;262144&lt;/max_open_files&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Size of cache of uncompressed blocks of data, used in tables of MergeTree family.
</span></span></span><span class=line><span class=cl><span class=c>         In bytes. Cache is single for server. Memory is allocated only on demand.
</span></span></span><span class=line><span class=cl><span class=c>         Cache is used when &#39;use_uncompressed_cache&#39; user setting turned on (off by default).
</span></span></span><span class=line><span class=cl><span class=c>         Uncompressed cache is advantageous only for very short queries and in rare cases.
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>         Note: uncompressed cache can be pointless for lz4, because memory bandwidth
</span></span></span><span class=line><span class=cl><span class=c>         is slower than multi-core decompression on some server configurations.
</span></span></span><span class=line><span class=cl><span class=c>         Enabling it can sometimes paradoxically make queries slower.
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;uncompressed_cache_size&gt;</span>8589934592<span class=nt>&lt;/uncompressed_cache_size&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Approximate size of mark cache, used in tables of MergeTree family.
</span></span></span><span class=line><span class=cl><span class=c>         In bytes. Cache is single for server. Memory is allocated only on demand.
</span></span></span><span class=line><span class=cl><span class=c>         You should not lower this value.
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;mark_cache_size&gt;</span>5368709120<span class=nt>&lt;/mark_cache_size&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- If you enable the `min_bytes_to_use_mmap_io` setting,
</span></span></span><span class=line><span class=cl><span class=c>         the data in MergeTree tables can be read with mmap to avoid copying from kernel to userspace.
</span></span></span><span class=line><span class=cl><span class=c>         It makes sense only for large files and helps only if data reside in page cache.
</span></span></span><span class=line><span class=cl><span class=c>         To avoid frequent open/mmap/munmap/close calls (which are very expensive due to consequent page faults)
</span></span></span><span class=line><span class=cl><span class=c>         and to reuse mappings from several threads and queries,
</span></span></span><span class=line><span class=cl><span class=c>         the cache of mapped files is maintained. Its size is the number of mapped regions (usually equal to the number of mapped files).
</span></span></span><span class=line><span class=cl><span class=c>         The amount of data in mapped files can be monitored
</span></span></span><span class=line><span class=cl><span class=c>         in system.metrics, system.metric_log by the MMappedFiles, MMappedFileBytes metrics
</span></span></span><span class=line><span class=cl><span class=c>         and in system.asynchronous_metrics, system.asynchronous_metrics_log by the MMapCacheCells metric,
</span></span></span><span class=line><span class=cl><span class=c>         and also in system.events, system.processes, system.query_log, system.query_thread_log, system.query_views_log by the
</span></span></span><span class=line><span class=cl><span class=c>         CreatedReadBufferMMap, CreatedReadBufferMMapFailed, MMappedFileCacheHits, MMappedFileCacheMisses events.
</span></span></span><span class=line><span class=cl><span class=c>         Note that the amount of data in mapped files does not consume memory directly and is not accounted
</span></span></span><span class=line><span class=cl><span class=c>         in query or server memory usage - because this memory can be discarded similar to OS page cache.
</span></span></span><span class=line><span class=cl><span class=c>         The cache is dropped (the files are closed) automatically on removal of old parts in MergeTree,
</span></span></span><span class=line><span class=cl><span class=c>         also it can be dropped manually by the SYSTEM DROP MMAP CACHE query.
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;mmap_cache_size&gt;</span>1000<span class=nt>&lt;/mmap_cache_size&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Cache size in bytes for compiled expressions.--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;compiled_expression_cache_size&gt;</span>134217728<span class=nt>&lt;/compiled_expression_cache_size&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Cache size in elements for compiled expressions.--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;compiled_expression_cache_elements_size&gt;</span>10000<span class=nt>&lt;/compiled_expression_cache_elements_size&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Path to data directory, with trailing slash. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;path&gt;</span>/var/lib/clickhouse/<span class=nt>&lt;/path&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Path to temporary data for processing hard queries. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;tmp_path&gt;</span>/var/lib/clickhouse/tmp/<span class=nt>&lt;/tmp_path&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Policy from the &lt;storage_configuration&gt; for the temporary files.
</span></span></span><span class=line><span class=cl><span class=c>         If not set &lt;tmp_path&gt; is used, otherwise &lt;tmp_path&gt; is ignored.
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>         Notes:
</span></span></span><span class=line><span class=cl><span class=c>         - move_factor              is ignored
</span></span></span><span class=line><span class=cl><span class=c>         - keep_free_space_bytes    is ignored
</span></span></span><span class=line><span class=cl><span class=c>         - max_data_part_size_bytes is ignored
</span></span></span><span class=line><span class=cl><span class=c>         - you must have exactly one volume in that policy
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;tmp_policy&gt;tmp&lt;/tmp_policy&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Directory with user provided files that are accessible by &#39;file&#39; table function. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;user_files_path&gt;</span>/var/lib/clickhouse/user_files/<span class=nt>&lt;/user_files_path&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- LDAP server definitions. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;ldap_servers&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- List LDAP servers with their connection parameters here to later 1) use them as authenticators for dedicated local users,
</span></span></span><span class=line><span class=cl><span class=c>              who have &#39;ldap&#39; authentication mechanism specified instead of &#39;password&#39;, or to 2) use them as remote user directories.
</span></span></span><span class=line><span class=cl><span class=c>             Parameters:
</span></span></span><span class=line><span class=cl><span class=c>                host - LDAP server hostname or IP, this parameter is mandatory and cannot be empty.
</span></span></span><span class=line><span class=cl><span class=c>                port - LDAP server port, default is 636 if enable_tls is set to true, 389 otherwise.
</span></span></span><span class=line><span class=cl><span class=c>                bind_dn - template used to construct the DN to bind to.
</span></span></span><span class=line><span class=cl><span class=c>                        The resulting DN will be constructed by replacing all &#39;{user_name}&#39; substrings of the template with the actual
</span></span></span><span class=line><span class=cl><span class=c>                         user name during each authentication attempt.
</span></span></span><span class=line><span class=cl><span class=c>                user_dn_detection - section with LDAP search parameters for detecting the actual user DN of the bound user.
</span></span></span><span class=line><span class=cl><span class=c>                        This is mainly used in search filters for further role mapping when the server is Active Directory. The
</span></span></span><span class=line><span class=cl><span class=c>                         resulting user DN will be used when replacing &#39;{user_dn}&#39; substrings wherever they are allowed. By default,
</span></span></span><span class=line><span class=cl><span class=c>                         user DN is set equal to bind DN, but once search is performed, it will be updated with to the actual detected
</span></span></span><span class=line><span class=cl><span class=c>                         user DN value.
</span></span></span><span class=line><span class=cl><span class=c>                    base_dn - template used to construct the base DN for the LDAP search.
</span></span></span><span class=line><span class=cl><span class=c>                            The resulting DN will be constructed by replacing all &#39;{user_name}&#39; and &#39;{bind_dn}&#39; substrings
</span></span></span><span class=line><span class=cl><span class=c>                             of the template with the actual user name and bind DN during the LDAP search.
</span></span></span><span class=line><span class=cl><span class=c>                    scope - scope of the LDAP search.
</span></span></span><span class=line><span class=cl><span class=c>                            Accepted values are: &#39;base&#39;, &#39;one_level&#39;, &#39;children&#39;, &#39;subtree&#39; (the default).
</span></span></span><span class=line><span class=cl><span class=c>                    search_filter - template used to construct the search filter for the LDAP search.
</span></span></span><span class=line><span class=cl><span class=c>                            The resulting filter will be constructed by replacing all &#39;{user_name}&#39;, &#39;{bind_dn}&#39;, and &#39;{base_dn}&#39;
</span></span></span><span class=line><span class=cl><span class=c>                             substrings of the template with the actual user name, bind DN, and base DN during the LDAP search.
</span></span></span><span class=line><span class=cl><span class=c>                            Note, that the special characters must be escaped properly in XML.
</span></span></span><span class=line><span class=cl><span class=c>                verification_cooldown - a period of time, in seconds, after a successful bind attempt, during which a user will be assumed
</span></span></span><span class=line><span class=cl><span class=c>                         to be successfully authenticated for all consecutive requests without contacting the LDAP server.
</span></span></span><span class=line><span class=cl><span class=c>                        Specify 0 (the default) to disable caching and force contacting the LDAP server for each authentication request.
</span></span></span><span class=line><span class=cl><span class=c>                enable_tls - flag to trigger use of secure connection to the LDAP server.
</span></span></span><span class=line><span class=cl><span class=c>                        Specify &#39;no&#39; for plain text (ldap://) protocol (not recommended).
</span></span></span><span class=line><span class=cl><span class=c>                        Specify &#39;yes&#39; for LDAP over SSL/TLS (ldaps://) protocol (recommended, the default).
</span></span></span><span class=line><span class=cl><span class=c>                        Specify &#39;starttls&#39; for legacy StartTLS protocol (plain text (ldap://) protocol, upgraded to TLS).
</span></span></span><span class=line><span class=cl><span class=c>                tls_minimum_protocol_version - the minimum protocol version of SSL/TLS.
</span></span></span><span class=line><span class=cl><span class=c>                        Accepted values are: &#39;ssl2&#39;, &#39;ssl3&#39;, &#39;tls1.0&#39;, &#39;tls1.1&#39;, &#39;tls1.2&#39; (the default).
</span></span></span><span class=line><span class=cl><span class=c>                tls_require_cert - SSL/TLS peer certificate verification behavior.
</span></span></span><span class=line><span class=cl><span class=c>                        Accepted values are: &#39;never&#39;, &#39;allow&#39;, &#39;try&#39;, &#39;demand&#39; (the default).
</span></span></span><span class=line><span class=cl><span class=c>                tls_cert_file - path to certificate file.
</span></span></span><span class=line><span class=cl><span class=c>                tls_key_file - path to certificate key file.
</span></span></span><span class=line><span class=cl><span class=c>                tls_ca_cert_file - path to CA certificate file.
</span></span></span><span class=line><span class=cl><span class=c>                tls_ca_cert_dir - path to the directory containing CA certificates.
</span></span></span><span class=line><span class=cl><span class=c>                tls_cipher_suite - allowed cipher suite (in OpenSSL notation).
</span></span></span><span class=line><span class=cl><span class=c>             Example:
</span></span></span><span class=line><span class=cl><span class=c>                &lt;my_ldap_server&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;host&gt;localhost&lt;/host&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;port&gt;636&lt;/port&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;bind_dn&gt;uid={user_name},ou=users,dc=example,dc=com&lt;/bind_dn&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;verification_cooldown&gt;300&lt;/verification_cooldown&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;enable_tls&gt;yes&lt;/enable_tls&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;tls_minimum_protocol_version&gt;tls1.2&lt;/tls_minimum_protocol_version&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;tls_require_cert&gt;demand&lt;/tls_require_cert&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;tls_cert_file&gt;/path/to/tls_cert_file&lt;/tls_cert_file&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;tls_key_file&gt;/path/to/tls_key_file&lt;/tls_key_file&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;tls_ca_cert_file&gt;/path/to/tls_ca_cert_file&lt;/tls_ca_cert_file&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;tls_ca_cert_dir&gt;/path/to/tls_ca_cert_dir&lt;/tls_ca_cert_dir&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;tls_cipher_suite&gt;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:AES256-GCM-SHA384&lt;/tls_cipher_suite&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;/my_ldap_server&gt;
</span></span></span><span class=line><span class=cl><span class=c>             Example (typical Active Directory with configured user DN detection for further role mapping):
</span></span></span><span class=line><span class=cl><span class=c>                &lt;my_ad_server&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;host&gt;localhost&lt;/host&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;port&gt;389&lt;/port&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;bind_dn&gt;EXAMPLE\{user_name}&lt;/bind_dn&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;user_dn_detection&gt;
</span></span></span><span class=line><span class=cl><span class=c>                        &lt;base_dn&gt;CN=Users,DC=example,DC=com&lt;/base_dn&gt;
</span></span></span><span class=line><span class=cl><span class=c>                        &lt;search_filter&gt;(&amp;amp;(objectClass=user)(sAMAccountName={user_name}))&lt;/search_filter&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;/user_dn_detection&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;enable_tls&gt;no&lt;/enable_tls&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;/my_ad_server&gt;
</span></span></span><span class=line><span class=cl><span class=c>        --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/ldap_servers&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- To enable Kerberos authentication support for HTTP requests (GSS-SPNEGO), for those users who are explicitly configured
</span></span></span><span class=line><span class=cl><span class=c>          to authenticate via Kerberos, define a single &#39;kerberos&#39; section here.
</span></span></span><span class=line><span class=cl><span class=c>         Parameters:
</span></span></span><span class=line><span class=cl><span class=c>            principal - canonical service principal name, that will be acquired and used when accepting security contexts.
</span></span></span><span class=line><span class=cl><span class=c>                    This parameter is optional, if omitted, the default principal will be used.
</span></span></span><span class=line><span class=cl><span class=c>                    This parameter cannot be specified together with &#39;realm&#39; parameter.
</span></span></span><span class=line><span class=cl><span class=c>            realm - a realm, that will be used to restrict authentication to only those requests whose initiator&#39;s realm matches it.
</span></span></span><span class=line><span class=cl><span class=c>                    This parameter is optional, if omitted, no additional filtering by realm will be applied.
</span></span></span><span class=line><span class=cl><span class=c>                    This parameter cannot be specified together with &#39;principal&#39; parameter.
</span></span></span><span class=line><span class=cl><span class=c>         Example:
</span></span></span><span class=line><span class=cl><span class=c>            &lt;kerberos /&gt;
</span></span></span><span class=line><span class=cl><span class=c>         Example:
</span></span></span><span class=line><span class=cl><span class=c>            &lt;kerberos&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;principal&gt;HTTP/clickhouse.example.com@EXAMPLE.COM&lt;/principal&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;/kerberos&gt;
</span></span></span><span class=line><span class=cl><span class=c>         Example:
</span></span></span><span class=line><span class=cl><span class=c>            &lt;kerberos&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;realm&gt;EXAMPLE.COM&lt;/realm&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;/kerberos&gt;
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Sources to read users, roles, access rights, profiles of settings, quotas. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;user_directories&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;users_xml&gt;</span>
</span></span><span class=line><span class=cl>            <span class=c>&lt;!-- Path to configuration file with predefined users. --&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;path&gt;</span>users.xml<span class=nt>&lt;/path&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/users_xml&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;local_directory&gt;</span>
</span></span><span class=line><span class=cl>            <span class=c>&lt;!-- Path to folder where users created by SQL commands are stored. --&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;path&gt;</span>/var/lib/clickhouse/access/<span class=nt>&lt;/path&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/local_directory&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- To add an LDAP server as a remote user directory of users that are not defined locally, define a single &#39;ldap&#39; section
</span></span></span><span class=line><span class=cl><span class=c>              with the following parameters:
</span></span></span><span class=line><span class=cl><span class=c>                server - one of LDAP server names defined in &#39;ldap_servers&#39; config section above.
</span></span></span><span class=line><span class=cl><span class=c>                        This parameter is mandatory and cannot be empty.
</span></span></span><span class=line><span class=cl><span class=c>                roles - section with a list of locally defined roles that will be assigned to each user retrieved from the LDAP server.
</span></span></span><span class=line><span class=cl><span class=c>                        If no roles are specified here or assigned during role mapping (below), user will not be able to perform any
</span></span></span><span class=line><span class=cl><span class=c>                         actions after authentication.
</span></span></span><span class=line><span class=cl><span class=c>                role_mapping - section with LDAP search parameters and mapping rules.
</span></span></span><span class=line><span class=cl><span class=c>                        When a user authenticates, while still bound to LDAP, an LDAP search is performed using search_filter and the
</span></span></span><span class=line><span class=cl><span class=c>                         name of the logged in user. For each entry found during that search, the value of the specified attribute is
</span></span></span><span class=line><span class=cl><span class=c>                         extracted. For each attribute value that has the specified prefix, the prefix is removed, and the rest of the
</span></span></span><span class=line><span class=cl><span class=c>                         value becomes the name of a local role defined in ClickHouse, which is expected to be created beforehand by
</span></span></span><span class=line><span class=cl><span class=c>                         CREATE ROLE command.
</span></span></span><span class=line><span class=cl><span class=c>                        There can be multiple &#39;role_mapping&#39; sections defined inside the same &#39;ldap&#39; section. All of them will be
</span></span></span><span class=line><span class=cl><span class=c>                         applied.
</span></span></span><span class=line><span class=cl><span class=c>                    base_dn - template used to construct the base DN for the LDAP search.
</span></span></span><span class=line><span class=cl><span class=c>                            The resulting DN will be constructed by replacing all &#39;{user_name}&#39;, &#39;{bind_dn}&#39;, and &#39;{user_dn}&#39;
</span></span></span><span class=line><span class=cl><span class=c>                             substrings of the template with the actual user name, bind DN, and user DN during each LDAP search.
</span></span></span><span class=line><span class=cl><span class=c>                    scope - scope of the LDAP search.
</span></span></span><span class=line><span class=cl><span class=c>                            Accepted values are: &#39;base&#39;, &#39;one_level&#39;, &#39;children&#39;, &#39;subtree&#39; (the default).
</span></span></span><span class=line><span class=cl><span class=c>                    search_filter - template used to construct the search filter for the LDAP search.
</span></span></span><span class=line><span class=cl><span class=c>                            The resulting filter will be constructed by replacing all &#39;{user_name}&#39;, &#39;{bind_dn}&#39;, &#39;{user_dn}&#39;, and
</span></span></span><span class=line><span class=cl><span class=c>                             &#39;{base_dn}&#39; substrings of the template with the actual user name, bind DN, user DN, and base DN during
</span></span></span><span class=line><span class=cl><span class=c>                             each LDAP search.
</span></span></span><span class=line><span class=cl><span class=c>                            Note, that the special characters must be escaped properly in XML.
</span></span></span><span class=line><span class=cl><span class=c>                    attribute - attribute name whose values will be returned by the LDAP search. &#39;cn&#39;, by default.
</span></span></span><span class=line><span class=cl><span class=c>                    prefix - prefix, that will be expected to be in front of each string in the original list of strings returned by
</span></span></span><span class=line><span class=cl><span class=c>                             the LDAP search. Prefix will be removed from the original strings and resulting strings will be treated
</span></span></span><span class=line><span class=cl><span class=c>                             as local role names. Empty, by default.
</span></span></span><span class=line><span class=cl><span class=c>             Example:
</span></span></span><span class=line><span class=cl><span class=c>                &lt;ldap&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;server&gt;my_ldap_server&lt;/server&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;roles&gt;
</span></span></span><span class=line><span class=cl><span class=c>                        &lt;my_local_role1 /&gt;
</span></span></span><span class=line><span class=cl><span class=c>                        &lt;my_local_role2 /&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;/roles&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;role_mapping&gt;
</span></span></span><span class=line><span class=cl><span class=c>                        &lt;base_dn&gt;ou=groups,dc=example,dc=com&lt;/base_dn&gt;
</span></span></span><span class=line><span class=cl><span class=c>                        &lt;scope&gt;subtree&lt;/scope&gt;
</span></span></span><span class=line><span class=cl><span class=c>                        &lt;search_filter&gt;(&amp;amp;(objectClass=groupOfNames)(member={bind_dn}))&lt;/search_filter&gt;
</span></span></span><span class=line><span class=cl><span class=c>                        &lt;attribute&gt;cn&lt;/attribute&gt;
</span></span></span><span class=line><span class=cl><span class=c>                        &lt;prefix&gt;clickhouse_&lt;/prefix&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;/role_mapping&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;/ldap&gt;
</span></span></span><span class=line><span class=cl><span class=c>             Example (typical Active Directory with role mapping that relies on the detected user DN):
</span></span></span><span class=line><span class=cl><span class=c>                &lt;ldap&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;server&gt;my_ad_server&lt;/server&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;role_mapping&gt;
</span></span></span><span class=line><span class=cl><span class=c>                        &lt;base_dn&gt;CN=Users,DC=example,DC=com&lt;/base_dn&gt;
</span></span></span><span class=line><span class=cl><span class=c>                        &lt;attribute&gt;CN&lt;/attribute&gt;
</span></span></span><span class=line><span class=cl><span class=c>                        &lt;scope&gt;subtree&lt;/scope&gt;
</span></span></span><span class=line><span class=cl><span class=c>                        &lt;search_filter&gt;(&amp;amp;(objectClass=group)(member={user_dn}))&lt;/search_filter&gt;
</span></span></span><span class=line><span class=cl><span class=c>                        &lt;prefix&gt;clickhouse_&lt;/prefix&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;/role_mapping&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;/ldap&gt;
</span></span></span><span class=line><span class=cl><span class=c>        --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/user_directories&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Default profile of settings. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;default_profile&gt;</span>default<span class=nt>&lt;/default_profile&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Comma-separated list of prefixes for user-defined settings. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;custom_settings_prefixes&gt;&lt;/custom_settings_prefixes&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- System profile of settings. This settings are used by internal processes (Distributed DDL worker and so on). --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;system_profile&gt;default&lt;/system_profile&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Buffer profile of settings.
</span></span></span><span class=line><span class=cl><span class=c>         This settings are used by Buffer storage to flush data to the underlying table.
</span></span></span><span class=line><span class=cl><span class=c>         Default: used from system_profile directive.
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;buffer_profile&gt;default&lt;/buffer_profile&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Default database. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;default_database&gt;</span>default<span class=nt>&lt;/default_database&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Server time zone could be set here.
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>         Time zone is used when converting between String and DateTime types,
</span></span></span><span class=line><span class=cl><span class=c>          when printing DateTime in text formats and parsing DateTime from text,
</span></span></span><span class=line><span class=cl><span class=c>          it is used in date and time related functions, if specific time zone was not passed as an argument.
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>         Time zone is specified as identifier from IANA time zone database, like UTC or Africa/Abidjan.
</span></span></span><span class=line><span class=cl><span class=c>         If not specified, system time zone at server startup is used.
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>         Please note, that server could display time zone alias instead of specified name.
</span></span></span><span class=line><span class=cl><span class=c>         Example: W-SU is an alias for Europe/Moscow and Zulu is an alias for UTC.
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;timezone&gt;Europe/Moscow&lt;/timezone&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- You can specify umask here (see &#34;man umask&#34;). Server will apply it on startup.
</span></span></span><span class=line><span class=cl><span class=c>         Number is always parsed as octal. Default umask is 027 (other users cannot read logs, data files, etc; group can only read).
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;umask&gt;022&lt;/umask&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Perform mlockall after startup to lower first queries latency
</span></span></span><span class=line><span class=cl><span class=c>          and to prevent clickhouse executable from being paged out under high IO load.
</span></span></span><span class=line><span class=cl><span class=c>         Enabling this option is recommended but will lead to increased startup time for up to a few seconds.
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;mlock_executable&gt;</span>true<span class=nt>&lt;/mlock_executable&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Reallocate memory for machine code (&#34;text&#34;) using huge pages. Highly experimental. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;remap_executable&gt;</span>false<span class=nt>&lt;/remap_executable&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cp>&lt;![CDATA[
</span></span></span><span class=line><span class=cl><span class=cp>         Uncomment below in order to use JDBC table engine and function.
</span></span></span><span class=line><span class=cl><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>         To install and run JDBC bridge in background:
</span></span></span><span class=line><span class=cl><span class=cp>         * [Debian/Ubuntu]
</span></span></span><span class=line><span class=cl><span class=cp>           export MVN_URL=https://repo1.maven.org/maven2/ru/yandex/clickhouse/clickhouse-jdbc-bridge
</span></span></span><span class=line><span class=cl><span class=cp>           export PKG_VER=$(curl -sL $MVN_URL/maven-metadata.xml | grep &#39;&lt;release&gt;&#39; | sed -e &#39;s|.*&gt;\(.*\)&lt;.*|\1|&#39;)
</span></span></span><span class=line><span class=cl><span class=cp>           wget https://github.com/ClickHouse/clickhouse-jdbc-bridge/releases/download/v$PKG_VER/clickhouse-jdbc-bridge_$PKG_VER-1_all.deb
</span></span></span><span class=line><span class=cl><span class=cp>           apt install --no-install-recommends -f ./clickhouse-jdbc-bridge_$PKG_VER-1_all.deb
</span></span></span><span class=line><span class=cl><span class=cp>           clickhouse-jdbc-bridge &amp;
</span></span></span><span class=line><span class=cl><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>         * [CentOS/RHEL]
</span></span></span><span class=line><span class=cl><span class=cp>           export MVN_URL=https://repo1.maven.org/maven2/ru/yandex/clickhouse/clickhouse-jdbc-bridge
</span></span></span><span class=line><span class=cl><span class=cp>           export PKG_VER=$(curl -sL $MVN_URL/maven-metadata.xml | grep &#39;&lt;release&gt;&#39; | sed -e &#39;s|.*&gt;\(.*\)&lt;.*|\1|&#39;)
</span></span></span><span class=line><span class=cl><span class=cp>           wget https://github.com/ClickHouse/clickhouse-jdbc-bridge/releases/download/v$PKG_VER/clickhouse-jdbc-bridge-$PKG_VER-1.noarch.rpm
</span></span></span><span class=line><span class=cl><span class=cp>           yum localinstall -y clickhouse-jdbc-bridge-$PKG_VER-1.noarch.rpm
</span></span></span><span class=line><span class=cl><span class=cp>           clickhouse-jdbc-bridge &amp;
</span></span></span><span class=line><span class=cl><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>         Please refer to https://github.com/ClickHouse/clickhouse-jdbc-bridge#usage for more information.
</span></span></span><span class=line><span class=cl><span class=cp>    ]]&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>    &lt;jdbc_bridge&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;host&gt;127.0.0.1&lt;/host&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;port&gt;9019&lt;/port&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;/jdbc_bridge&gt;
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Configuration of clusters that could be used in Distributed tables.
</span></span></span><span class=line><span class=cl><span class=c>         https://clickhouse.com/docs/en/operations/table_engines/distributed/
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;remote_servers&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;default_cluster&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;shard&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;weight&gt;</span>1<span class=nt>&lt;/weight&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;internal_replication&gt;</span>false<span class=nt>&lt;/internal_replication&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;replica&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;host&gt;</span>ck1<span class=nt>&lt;/host&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;port&gt;</span>9000<span class=nt>&lt;/port&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;/replica&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/shard&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;shard&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;weight&gt;</span>1<span class=nt>&lt;/weight&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;internal_replication&gt;</span>false<span class=nt>&lt;/internal_replication&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;replica&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;host&gt;</span>ck2<span class=nt>&lt;/host&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;port&gt;</span>9000<span class=nt>&lt;/port&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;/replica&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/shard&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;shard&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;weight&gt;</span>1<span class=nt>&lt;/weight&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;internal_replication&gt;</span>false<span class=nt>&lt;/internal_replication&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;replica&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;host&gt;</span>ck3<span class=nt>&lt;/host&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;port&gt;</span>9000<span class=nt>&lt;/port&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;/replica&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/shard&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/default_cluster&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/remote_servers&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;macros&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;replica&gt;</span>ck1<span class=nt>&lt;/replica&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;shard&gt;</span>01<span class=nt>&lt;/shard&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;layer&gt;</span>01<span class=nt>&lt;/layer&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/macros&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- The list of hosts allowed to use in URL-related storage engines and table functions.
</span></span></span><span class=line><span class=cl><span class=c>        If this section is not present in configuration, all hosts are allowed.
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--&lt;remote_url_allow_hosts&gt;--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Host should be specified exactly as in URL. The name is checked before DNS resolution.
</span></span></span><span class=line><span class=cl><span class=c>        Example: &#34;yandex.ru&#34;, &#34;yandex.ru.&#34; and &#34;www.yandex.ru&#34; are different hosts.
</span></span></span><span class=line><span class=cl><span class=c>                If port is explicitly specified in URL, the host:port is checked as a whole.
</span></span></span><span class=line><span class=cl><span class=c>                If host specified here without port, any port with this host allowed.
</span></span></span><span class=line><span class=cl><span class=c>                &#34;yandex.ru&#34; -&gt; &#34;yandex.ru:443&#34;, &#34;yandex.ru:80&#34; etc. is allowed, but &#34;yandex.ru:80&#34; -&gt; only &#34;yandex.ru:80&#34; is allowed.
</span></span></span><span class=line><span class=cl><span class=c>        If the host is specified as IP address, it is checked as specified in URL. Example: &#34;[2a02:6b8:a::a]&#34;.
</span></span></span><span class=line><span class=cl><span class=c>        If there are redirects and support for redirects is enabled, every redirect (the Location field) is checked.
</span></span></span><span class=line><span class=cl><span class=c>        Host should be specified using the host xml tag:
</span></span></span><span class=line><span class=cl><span class=c>                &lt;host&gt;yandex.ru&lt;/host&gt;
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Regular expression can be specified. RE2 engine is used for regexps.
</span></span></span><span class=line><span class=cl><span class=c>        Regexps are not aligned: don&#39;t forget to add ^ and $. Also don&#39;t forget to escape dot (.) metacharacter
</span></span></span><span class=line><span class=cl><span class=c>        (forgetting to do so is a common source of error).
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--&lt;/remote_url_allow_hosts&gt;--&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- If element has &#39;incl&#39; attribute, then for it&#39;s value will be used corresponding substitution from another file.
</span></span></span><span class=line><span class=cl><span class=c>         By default, path to file with substitutions is /etc/metrika.xml. It could be changed in config in &#39;include_from&#39; element.
</span></span></span><span class=line><span class=cl><span class=c>         Values for substitutions are specified in /clickhouse/name_of_substitution elements in that file.
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- ZooKeeper is used to store metadata about replicas, when using Replicated tables.
</span></span></span><span class=line><span class=cl><span class=c>         Optional. If you don&#39;t use replicated tables, you could omit that.
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>         See https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replication/
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;zookeeper&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;node&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;host&gt;</span>zookeeper1<span class=nt>&lt;/host&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;port&gt;</span>2181<span class=nt>&lt;/port&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/node&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/zookeeper&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Substitutions for parameters of replicated tables.
</span></span></span><span class=line><span class=cl><span class=c>          Optional. If you don&#39;t use replicated tables, you could omit that.
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>         See https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replication/#creating-replicated-tables
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>    &lt;macros&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;shard&gt;01&lt;/shard&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;replica&gt;example01-01-1&lt;/replica&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;/macros&gt;
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Reloading interval for embedded dictionaries, in seconds. Default: 3600. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;builtin_dictionaries_reload_interval&gt;</span>3600<span class=nt>&lt;/builtin_dictionaries_reload_interval&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Maximum session timeout, in seconds. Default: 3600. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;max_session_timeout&gt;</span>3600<span class=nt>&lt;/max_session_timeout&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Default session timeout, in seconds. Default: 60. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;default_session_timeout&gt;</span>60<span class=nt>&lt;/default_session_timeout&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Sending data to Graphite for monitoring. Several sections can be defined. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>        interval - send every X second
</span></span></span><span class=line><span class=cl><span class=c>        root_path - prefix for keys
</span></span></span><span class=line><span class=cl><span class=c>        hostname_in_path - append hostname to root_path (default = true)
</span></span></span><span class=line><span class=cl><span class=c>        metrics - send data from table system.metrics
</span></span></span><span class=line><span class=cl><span class=c>        events - send data from table system.events
</span></span></span><span class=line><span class=cl><span class=c>        asynchronous_metrics - send data from table system.asynchronous_metrics
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>    &lt;graphite&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;host&gt;localhost&lt;/host&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;port&gt;42000&lt;/port&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;timeout&gt;0.1&lt;/timeout&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;interval&gt;60&lt;/interval&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;root_path&gt;one_min&lt;/root_path&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;hostname_in_path&gt;true&lt;/hostname_in_path&gt;
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>        &lt;metrics&gt;true&lt;/metrics&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;events&gt;true&lt;/events&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;events_cumulative&gt;false&lt;/events_cumulative&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;asynchronous_metrics&gt;true&lt;/asynchronous_metrics&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;/graphite&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;graphite&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;host&gt;localhost&lt;/host&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;port&gt;42000&lt;/port&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;timeout&gt;0.1&lt;/timeout&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;interval&gt;1&lt;/interval&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;root_path&gt;one_sec&lt;/root_path&gt;
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>        &lt;metrics&gt;true&lt;/metrics&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;events&gt;true&lt;/events&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;events_cumulative&gt;false&lt;/events_cumulative&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;asynchronous_metrics&gt;false&lt;/asynchronous_metrics&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;/graphite&gt;
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Serve endpoint for Prometheus monitoring. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>        endpoint - mertics path (relative to root, statring with &#34;/&#34;)
</span></span></span><span class=line><span class=cl><span class=c>        port - port to setup server. If not defined or 0 than http_port used
</span></span></span><span class=line><span class=cl><span class=c>        metrics - send data from table system.metrics
</span></span></span><span class=line><span class=cl><span class=c>        events - send data from table system.events
</span></span></span><span class=line><span class=cl><span class=c>        asynchronous_metrics - send data from table system.asynchronous_metrics
</span></span></span><span class=line><span class=cl><span class=c>        status_info - send data from different component from CH, ex: Dictionaries status
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>    &lt;prometheus&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;endpoint&gt;/metrics&lt;/endpoint&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;port&gt;9363&lt;/port&gt;
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>        &lt;metrics&gt;true&lt;/metrics&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;events&gt;true&lt;/events&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;asynchronous_metrics&gt;true&lt;/asynchronous_metrics&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;status_info&gt;true&lt;/status_info&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;/prometheus&gt;
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Query log. Used only for queries with setting log_queries = 1. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;query_log&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- What table to insert data. If table is not exist, it will be created.
</span></span></span><span class=line><span class=cl><span class=c>             When query log structure is changed after system update,
</span></span></span><span class=line><span class=cl><span class=c>              then old table will be renamed and new table will be created automatically.
</span></span></span><span class=line><span class=cl><span class=c>        --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;database&gt;</span>system<span class=nt>&lt;/database&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;table&gt;</span>query_log<span class=nt>&lt;/table&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>            PARTITION BY expr: https://clickhouse.com/docs/en/table_engines/mergetree-family/custom_partitioning_key/
</span></span></span><span class=line><span class=cl><span class=c>            Example:
</span></span></span><span class=line><span class=cl><span class=c>                event_date
</span></span></span><span class=line><span class=cl><span class=c>                toMonday(event_date)
</span></span></span><span class=line><span class=cl><span class=c>                toYYYYMM(event_date)
</span></span></span><span class=line><span class=cl><span class=c>                toStartOfHour(event_time)
</span></span></span><span class=line><span class=cl><span class=c>        --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;partition_by&gt;</span>toYYYYMM(event_date)<span class=nt>&lt;/partition_by&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>            Table TTL specification: https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree/#mergetree-table-ttl
</span></span></span><span class=line><span class=cl><span class=c>            Example:
</span></span></span><span class=line><span class=cl><span class=c>                event_date + INTERVAL 1 WEEK
</span></span></span><span class=line><span class=cl><span class=c>                event_date + INTERVAL 7 DAY DELETE
</span></span></span><span class=line><span class=cl><span class=c>                event_date + INTERVAL 2 WEEK TO DISK &#39;bbb&#39;
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>        &lt;ttl&gt;event_date + INTERVAL 30 DAY DELETE&lt;/ttl&gt;
</span></span></span><span class=line><span class=cl><span class=c>        --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Instead of partition_by, you can provide full engine expression (starting with ENGINE = ) with parameters,
</span></span></span><span class=line><span class=cl><span class=c>             Example: &lt;engine&gt;ENGINE = MergeTree PARTITION BY toYYYYMM(event_date) ORDER BY (event_date, event_time) SETTINGS index_granularity = 1024&lt;/engine&gt;
</span></span></span><span class=line><span class=cl><span class=c>          --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Interval of flushing data. --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;flush_interval_milliseconds&gt;</span>7500<span class=nt>&lt;/flush_interval_milliseconds&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/query_log&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Trace log. Stores stack traces collected by query profilers.
</span></span></span><span class=line><span class=cl><span class=c>         See query_profiler_real_time_period_ns and query_profiler_cpu_time_period_ns settings. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;trace_log&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;database&gt;</span>system<span class=nt>&lt;/database&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;table&gt;</span>trace_log<span class=nt>&lt;/table&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;partition_by&gt;</span>toYYYYMM(event_date)<span class=nt>&lt;/partition_by&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;flush_interval_milliseconds&gt;</span>7500<span class=nt>&lt;/flush_interval_milliseconds&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/trace_log&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Query thread log. Has information about all threads participated in query execution.
</span></span></span><span class=line><span class=cl><span class=c>         Used only for queries with setting log_query_threads = 1. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;query_thread_log&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;database&gt;</span>system<span class=nt>&lt;/database&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;table&gt;</span>query_thread_log<span class=nt>&lt;/table&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;partition_by&gt;</span>toYYYYMM(event_date)<span class=nt>&lt;/partition_by&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;flush_interval_milliseconds&gt;</span>7500<span class=nt>&lt;/flush_interval_milliseconds&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/query_thread_log&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Query views log. Has information about all dependent views associated with a query.
</span></span></span><span class=line><span class=cl><span class=c>         Used only for queries with setting log_query_views = 1. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;query_views_log&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;database&gt;</span>system<span class=nt>&lt;/database&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;table&gt;</span>query_views_log<span class=nt>&lt;/table&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;partition_by&gt;</span>toYYYYMM(event_date)<span class=nt>&lt;/partition_by&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;flush_interval_milliseconds&gt;</span>7500<span class=nt>&lt;/flush_interval_milliseconds&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/query_views_log&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Uncomment if use part log.
</span></span></span><span class=line><span class=cl><span class=c>         Part log contains information about all actions with parts in MergeTree tables (creation, deletion, merges, downloads).--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;part_log&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;database&gt;</span>system<span class=nt>&lt;/database&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;table&gt;</span>part_log<span class=nt>&lt;/table&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;partition_by&gt;</span>toYYYYMM(event_date)<span class=nt>&lt;/partition_by&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;flush_interval_milliseconds&gt;</span>7500<span class=nt>&lt;/flush_interval_milliseconds&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/part_log&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Uncomment to write text log into table.
</span></span></span><span class=line><span class=cl><span class=c>         Text log contains all information from usual server log but stores it in structured and efficient way.
</span></span></span><span class=line><span class=cl><span class=c>         The level of the messages that goes to the table can be limited (&lt;level&gt;), if not specified all messages will go to the table.
</span></span></span><span class=line><span class=cl><span class=c>    &lt;text_log&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;database&gt;system&lt;/database&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;table&gt;text_log&lt;/table&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;flush_interval_milliseconds&gt;7500&lt;/flush_interval_milliseconds&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;level&gt;&lt;/level&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;/text_log&gt;
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Metric log contains rows with current values of ProfileEvents, CurrentMetrics collected with &#34;collect_interval_milliseconds&#34; interval. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;metric_log&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;database&gt;</span>system<span class=nt>&lt;/database&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;table&gt;</span>metric_log<span class=nt>&lt;/table&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;flush_interval_milliseconds&gt;</span>7500<span class=nt>&lt;/flush_interval_milliseconds&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;collect_interval_milliseconds&gt;</span>1000<span class=nt>&lt;/collect_interval_milliseconds&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/metric_log&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>        Asynchronous metric log contains values of metrics from
</span></span></span><span class=line><span class=cl><span class=c>        system.asynchronous_metrics.
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;asynchronous_metric_log&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;database&gt;</span>system<span class=nt>&lt;/database&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;table&gt;</span>asynchronous_metric_log<span class=nt>&lt;/table&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>            Asynchronous metrics are updated once a minute, so there is
</span></span></span><span class=line><span class=cl><span class=c>            no need to flush more often.
</span></span></span><span class=line><span class=cl><span class=c>        --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;flush_interval_milliseconds&gt;</span>7000<span class=nt>&lt;/flush_interval_milliseconds&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/asynchronous_metric_log&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>        OpenTelemetry log contains OpenTelemetry trace spans.
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;opentelemetry_span_log&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>            The default table creation code is insufficient, this &lt;engine&gt; spec
</span></span></span><span class=line><span class=cl><span class=c>            is a workaround. There is no &#39;event_time&#39; for this log, but two times,
</span></span></span><span class=line><span class=cl><span class=c>            start and finish. It is sorted by finish time, to avoid inserting
</span></span></span><span class=line><span class=cl><span class=c>            data too far away in the past (probably we can sometimes insert a span
</span></span></span><span class=line><span class=cl><span class=c>            that is seconds earlier than the last span in the table, due to a race
</span></span></span><span class=line><span class=cl><span class=c>            between several spans inserted in parallel). This gives the spans a
</span></span></span><span class=line><span class=cl><span class=c>            global order that we can use to e.g. retry insertion into some external
</span></span></span><span class=line><span class=cl><span class=c>            system.
</span></span></span><span class=line><span class=cl><span class=c>        --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;engine&gt;</span>
</span></span><span class=line><span class=cl>            engine MergeTree
</span></span><span class=line><span class=cl>            partition by toYYYYMM(finish_date)
</span></span><span class=line><span class=cl>            order by (finish_date, finish_time_us, trace_id)
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/engine&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;database&gt;</span>system<span class=nt>&lt;/database&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;table&gt;</span>opentelemetry_span_log<span class=nt>&lt;/table&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;flush_interval_milliseconds&gt;</span>7500<span class=nt>&lt;/flush_interval_milliseconds&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/opentelemetry_span_log&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Crash log. Stores stack traces for fatal errors.
</span></span></span><span class=line><span class=cl><span class=c>         This table is normally empty. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;crash_log&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;database&gt;</span>system<span class=nt>&lt;/database&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;table&gt;</span>crash_log<span class=nt>&lt;/table&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;partition_by/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;flush_interval_milliseconds&gt;</span>1000<span class=nt>&lt;/flush_interval_milliseconds&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/crash_log&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Session log. Stores user log in (successful or not) and log out events. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;session_log&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;database&gt;</span>system<span class=nt>&lt;/database&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;table&gt;</span>session_log<span class=nt>&lt;/table&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;partition_by&gt;</span>toYYYYMM(event_date)<span class=nt>&lt;/partition_by&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;flush_interval_milliseconds&gt;</span>7500<span class=nt>&lt;/flush_interval_milliseconds&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/session_log&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Parameters for embedded dictionaries, used in Yandex.Metrica.
</span></span></span><span class=line><span class=cl><span class=c>         See https://clickhouse.com/docs/en/dicts/internal_dicts/
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Path to file with region hierarchy. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;path_to_regions_hierarchy_file&gt;/opt/geo/regions_hierarchy.txt&lt;/path_to_regions_hierarchy_file&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Path to directory with files containing names of regions --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;path_to_regions_names_files&gt;/opt/geo/&lt;/path_to_regions_names_files&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;top_level_domains_path&gt;/var/lib/clickhouse/top_level_domains/&lt;/top_level_domains_path&gt; --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Custom TLD lists.
</span></span></span><span class=line><span class=cl><span class=c>         Format: &lt;name&gt;/path/to/file&lt;/name&gt;
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>         Changes will not be applied w/o server restart.
</span></span></span><span class=line><span class=cl><span class=c>         Path to the list is under top_level_domains_path (see above).
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;top_level_domains_lists&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>        &lt;public_suffix_list&gt;/path/to/public_suffix_list.dat&lt;/public_suffix_list&gt;
</span></span></span><span class=line><span class=cl><span class=c>        --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/top_level_domains_lists&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Configuration of external dictionaries. See:
</span></span></span><span class=line><span class=cl><span class=c>         https://clickhouse.com/docs/en/sql-reference/dictionaries/external-dictionaries/external-dicts
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dictionaries_config&gt;</span>*_dictionary.xml<span class=nt>&lt;/dictionaries_config&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Configuration of user defined executable functions --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;user_defined_executable_functions_config&gt;</span>*_function.xml<span class=nt>&lt;/user_defined_executable_functions_config&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Uncomment if you want data to be compressed 30-100% better.
</span></span></span><span class=line><span class=cl><span class=c>         Don&#39;t do that if you just started using ClickHouse.
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>    &lt;compression&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;!- - Set of variants. Checked in order. Last matching case wins. If nothing matches, lz4 will be used. - -&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;case&gt;
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>            &lt;!- - Conditions. All must be satisfied. Some conditions may be omitted. - -&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;min_part_size&gt;10000000000&lt;/min_part_size&gt;        &lt;!- - Min part size in bytes. - -&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;min_part_size_ratio&gt;0.01&lt;/min_part_size_ratio&gt;   &lt;!- - Min size of part relative to whole table size. - -&gt;
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>            &lt;!- - What compression method to use. - -&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;method&gt;zstd&lt;/method&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;/case&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;/compression&gt;
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Configuration of encryption. The server executes a command to
</span></span></span><span class=line><span class=cl><span class=c>         obtain an encryption key at startup if such a command is
</span></span></span><span class=line><span class=cl><span class=c>         defined, or encryption codecs will be disabled otherwise. The
</span></span></span><span class=line><span class=cl><span class=c>         command is executed through /bin/sh and is expected to write
</span></span></span><span class=line><span class=cl><span class=c>         a Base64-encoded key to the stdout. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;encryption_codecs&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- aes_128_gcm_siv --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Example of getting hex key from env --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- the code should use this key and throw an exception if its length is not 16 bytes --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!--key_hex from_env=&#34;...&#34;&gt;&lt;/key_hex --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Example of multiple hex keys. They can be imported from env or be written down in config--&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- the code should use these keys and throw an exception if their length is not 16 bytes --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- key_hex id=&#34;0&#34;&gt;...&lt;/key_hex --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- key_hex id=&#34;1&#34; from_env=&#34;..&#34;&gt;&lt;/key_hex --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- key_hex id=&#34;2&#34;&gt;...&lt;/key_hex --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- current_key_id&gt;2&lt;/current_key_id --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Example of getting hex key from config --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- the code should use this key and throw an exception if its length is not 16 bytes --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- key&gt;...&lt;/key --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- example of adding nonce --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- nonce&gt;...&lt;/nonce --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- /aes_128_gcm_siv --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/encryption_codecs&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Allow to execute distributed DDL queries (CREATE, DROP, ALTER, RENAME) on cluster.
</span></span></span><span class=line><span class=cl><span class=c>         Works only if ZooKeeper is enabled. Comment it if such functionality isn&#39;t required. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;distributed_ddl&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Path in ZooKeeper to queue with DDL queries --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;path&gt;</span>/clickhouse/task_queue/ddl<span class=nt>&lt;/path&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Settings from this profile will be used to execute DDL queries --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- &lt;profile&gt;default&lt;/profile&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Controls how much ON CLUSTER queries can be run simultaneously. --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- &lt;pool_size&gt;1&lt;/pool_size&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>             Cleanup settings (active tasks will not be removed)
</span></span></span><span class=line><span class=cl><span class=c>        --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Controls task TTL (default 1 week) --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- &lt;task_max_lifetime&gt;604800&lt;/task_max_lifetime&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Controls how often cleanup should be performed (in seconds) --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- &lt;cleanup_delay_period&gt;60&lt;/cleanup_delay_period&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Controls how many tasks could be in the queue --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- &lt;max_tasks_in_queue&gt;1000&lt;/max_tasks_in_queue&gt; --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/distributed_ddl&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Settings to fine tune MergeTree tables. See documentation in source code, in MergeTreeSettings.h --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>    &lt;merge_tree&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;max_suspicious_broken_parts&gt;5&lt;/max_suspicious_broken_parts&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;/merge_tree&gt;
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Protection from accidental DROP.
</span></span></span><span class=line><span class=cl><span class=c>         If size of a MergeTree table is greater than max_table_size_to_drop (in bytes) than table could not be dropped with any DROP query.
</span></span></span><span class=line><span class=cl><span class=c>         If you want do delete one table and don&#39;t want to change clickhouse-server config, you could create special file &lt;clickhouse-path&gt;/flags/force_drop_table and make DROP once.
</span></span></span><span class=line><span class=cl><span class=c>         By default max_table_size_to_drop is 50GB; max_table_size_to_drop=0 allows to DROP any tables.
</span></span></span><span class=line><span class=cl><span class=c>         The same for max_partition_size_to_drop.
</span></span></span><span class=line><span class=cl><span class=c>         Uncomment to disable protection.
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;max_table_size_to_drop&gt;0&lt;/max_table_size_to_drop&gt; --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;max_partition_size_to_drop&gt;0&lt;/max_partition_size_to_drop&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Example of parameters for GraphiteMergeTree table engine --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;graphite_rollup_example&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;pattern&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;regexp&gt;</span>click_cost<span class=nt>&lt;/regexp&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;function&gt;</span>any<span class=nt>&lt;/function&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;retention&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;age&gt;</span>0<span class=nt>&lt;/age&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;precision&gt;</span>3600<span class=nt>&lt;/precision&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/retention&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;retention&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;age&gt;</span>86400<span class=nt>&lt;/age&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;precision&gt;</span>60<span class=nt>&lt;/precision&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/retention&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/pattern&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;default&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;function&gt;</span>max<span class=nt>&lt;/function&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;retention&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;age&gt;</span>0<span class=nt>&lt;/age&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;precision&gt;</span>60<span class=nt>&lt;/precision&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/retention&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;retention&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;age&gt;</span>3600<span class=nt>&lt;/age&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;precision&gt;</span>300<span class=nt>&lt;/precision&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/retention&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;retention&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;age&gt;</span>86400<span class=nt>&lt;/age&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;precision&gt;</span>3600<span class=nt>&lt;/precision&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/retention&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/default&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/graphite_rollup_example&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Directory in &lt;clickhouse-path&gt; containing schema files for various input formats.
</span></span></span><span class=line><span class=cl><span class=c>         The directory will be created if it doesn&#39;t exist.
</span></span></span><span class=line><span class=cl><span class=c>      --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;format_schema_path&gt;</span>/var/lib/clickhouse/format_schemas/<span class=nt>&lt;/format_schema_path&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Default query masking rules, matching lines would be replaced with something else in the logs
</span></span></span><span class=line><span class=cl><span class=c>        (both text logs and system.query_log).
</span></span></span><span class=line><span class=cl><span class=c>        name - name for the rule (optional)
</span></span></span><span class=line><span class=cl><span class=c>        regexp - RE2 compatible regular expression (mandatory)
</span></span></span><span class=line><span class=cl><span class=c>        replace - substitution string for sensitive data (optional, by default - six asterisks)
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;query_masking_rules&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;rule&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;name&gt;</span>hide encrypt/decrypt arguments<span class=nt>&lt;/name&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;regexp&gt;</span>((?:aes_)?(?:encrypt|decrypt)(?:_mysql)?)\s*\(\s*(?:&#39;(?:\\&#39;|.)+&#39;|.*?)\s*\)<span class=nt>&lt;/regexp&gt;</span>
</span></span><span class=line><span class=cl>            <span class=c>&lt;!-- or more secure, but also more invasive:
</span></span></span><span class=line><span class=cl><span class=c>                (aes_\w+)\s*\(.*\)
</span></span></span><span class=line><span class=cl><span class=c>            --&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;replace&gt;</span>\1(???)<span class=nt>&lt;/replace&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/rule&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/query_masking_rules&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Uncomment to use custom http handlers.
</span></span></span><span class=line><span class=cl><span class=c>        rules are checked from top to bottom, first match runs the handler
</span></span></span><span class=line><span class=cl><span class=c>            url - to match request URL, you can use &#39;regex:&#39; prefix to use regex match(optional)
</span></span></span><span class=line><span class=cl><span class=c>            methods - to match request method, you can use commas to separate multiple method matches(optional)
</span></span></span><span class=line><span class=cl><span class=c>            headers - to match request headers, match each child element(child element name is header name), you can use &#39;regex:&#39; prefix to use regex match(optional)
</span></span></span><span class=line><span class=cl><span class=c>        handler is request handler
</span></span></span><span class=line><span class=cl><span class=c>            type - supported types: static, dynamic_query_handler, predefined_query_handler
</span></span></span><span class=line><span class=cl><span class=c>            query - use with predefined_query_handler type, executes query when the handler is called
</span></span></span><span class=line><span class=cl><span class=c>            query_param_name - use with dynamic_query_handler type, extracts and executes the value corresponding to the &lt;query_param_name&gt; value in HTTP request params
</span></span></span><span class=line><span class=cl><span class=c>            status - use with static type, response status code
</span></span></span><span class=line><span class=cl><span class=c>            content_type - use with static type, response content-type
</span></span></span><span class=line><span class=cl><span class=c>            response_content - use with static type, Response content sent to client, when using the prefix &#39;file://&#39; or &#39;config://&#39;, find the content from the file or configuration send to client.
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>    &lt;http_handlers&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;rule&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;url&gt;/&lt;/url&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;methods&gt;POST,GET&lt;/methods&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;headers&gt;&lt;pragma&gt;no-cache&lt;/pragma&gt;&lt;/headers&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;handler&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;type&gt;dynamic_query_handler&lt;/type&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;query_param_name&gt;query&lt;/query_param_name&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;/handler&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;/rule&gt;
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>        &lt;rule&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;url&gt;/predefined_query&lt;/url&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;methods&gt;POST,GET&lt;/methods&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;handler&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;type&gt;predefined_query_handler&lt;/type&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;query&gt;SELECT * FROM system.settings&lt;/query&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;/handler&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;/rule&gt;
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>        &lt;rule&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;handler&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;type&gt;static&lt;/type&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;status&gt;200&lt;/status&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;content_type&gt;text/plain; charset=UTF-8&lt;/content_type&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;response_content&gt;config://http_server_default_response&lt;/response_content&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;/handler&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;/rule&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;/http_handlers&gt;
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;send_crash_reports&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Changing &lt;enabled&gt; to true allows sending crash reports to --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- the ClickHouse core developers team via Sentry https://sentry.io --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Doing so at least in pre-production environments is highly appreciated --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;enabled&gt;</span>false<span class=nt>&lt;/enabled&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Change &lt;anonymize&gt; to true if you don&#39;t feel comfortable attaching the server hostname to the crash report --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;anonymize&gt;</span>false<span class=nt>&lt;/anonymize&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Default endpoint s hould be changed to different Sentry DSN only if you have --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- some in-house engineers or hired consultants who&#39;re going to debug ClickHouse issues for you --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;endpoint&gt;&lt;/endpoint&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/send_crash_reports&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Uncomment to disable ClickHouse internal DNS caching. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- &lt;disable_internal_dns_cache&gt;1&lt;/disable_internal_dns_cache&gt; --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- You can also configure rocksdb like this: --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>    &lt;rocksdb&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;options&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;max_background_jobs&gt;8&lt;/max_background_jobs&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;/options&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;column_family_options&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;num_levels&gt;2&lt;/num_levels&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;/column_family_options&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;tables&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;table&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;name&gt;TABLE&lt;/name&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;options&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;max_background_jobs&gt;8&lt;/max_background_jobs&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;/options&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;column_family_options&gt;
</span></span></span><span class=line><span class=cl><span class=c>                    &lt;num_levels&gt;2&lt;/num_levels&gt;
</span></span></span><span class=line><span class=cl><span class=c>                &lt;/column_family_options&gt;
</span></span></span><span class=line><span class=cl><span class=c>            &lt;/table&gt;
</span></span></span><span class=line><span class=cl><span class=c>        &lt;/tables&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;/rocksdb&gt;
</span></span></span><span class=line><span class=cl><span class=c>    --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;timezone&gt;</span>Asia/Shanghai<span class=nt>&lt;/timezone&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/clickhouse&gt;</span>
</span></span></code></pre></div><h3 id=启动命令>启动命令<a hidden class=anchor aria-hidden=true href=#启动命令>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up -d
</span></span></code></pre></div><h3 id=todo>TODO<a hidden class=anchor aria-hidden=true href=#todo>#</a></h3><p>现在配置的 zookeeper 还是单机部署的，有空看看部署个zookeeper集群怎么配置</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.lvcshu.com/tags/clickhouse/>Clickhouse</a></li><li><a href=https://blog.lvcshu.com/tags/%E7%AC%94%E8%AE%B0/>笔记</a></li><li><a href=https://blog.lvcshu.com/tags/docker/>Docker</a></li><li><a href=https://blog.lvcshu.com/tags/docker-compose/>Docker-Compose</a></li></ul><nav class=paginav><a class=prev href=https://blog.lvcshu.com/2022/10/05/git-commit-sign-by-ssh-key/><span class=title>« Prev</span><br><span>使用 ssh 密钥签名 git commit</span>
</a><a class=next href=https://blog.lvcshu.com/2022/07/29/%E7%91%9E%E5%A3%AB%E8%BD%AE/><span class=title>Next »</span><br><span>Go 实现瑞士轮排列算法</span></a></nav><div id=disqus_thread></div><script>(function(){var e=document,t=e.createElement("script");t.src="https://johnpoints-blog-hexo.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.lvcshu.com/>johnpoint's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script async src=https://umami.uipo.cc/script.js data-website-id=7319ce07-a672-4d99-bf07-9ebb227d449d></script></body></html>